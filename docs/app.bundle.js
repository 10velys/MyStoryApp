/*! For license information please see app.bundle.js.LICENSE.txt */
(()=>{"use strict";var t={147:(t,e,n)=>{function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function a(t,e,n){return(e=function(t){var e=function(t){if("object"!=r(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(){s=function(){return e};var t,e={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function p(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{p({},"")}catch(t){p=function(t,e,n){return t[e]=n}}function f(t,e,n,r){var o=e&&e.prototype instanceof b?e:b,a=Object.create(o.prototype),s=new I(r||[]);return i(a,"_invoke",{value:O(t,n,s)}),a}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var d="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function w(){}function x(){}var k={};p(k,c,(function(){return this}));var _=Object.getPrototypeOf,L=_&&_(_(B([])));L&&L!==n&&o.call(L,c)&&(k=L);var E=x.prototype=b.prototype=Object.create(k);function S(t){["next","throw","return"].forEach((function(e){p(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function n(i,a,s,c){var u=h(t[i],t,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==r(p)&&o.call(p,"__await")?e.resolve(p.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):e.resolve(p).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,c)}))}c(u.arg)}var a;i(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return a=a?a.then(o,o):o()}})}function O(e,n,r){var o=d;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=T(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=y;var u=h(e,n,r);if("normal"===u.type){if(o=r.done?v:m,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=v,r.method="throw",r.arg=u.arg)}}}function T(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=h(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function B(e){if(e||""===e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(o.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(r(e)+" is not iterable")}return w.prototype=x,i(E,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:w,configurable:!0}),w.displayName=p(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,p(t,l,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},S(P.prototype),p(P.prototype,u,(function(){return this})),e.AsyncIterator=P,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new P(f(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(E),p(E,l,"Generator"),p(E,c,(function(){return this})),p(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=B,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),j(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;j(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:B(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function c(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function u(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){c(i,r,o,a,s,"next",t)}function s(t){c(i,r,o,a,s,"throw",t)}a(void 0)}))}}n.d(e,{A:()=>j});var l="stories",p=function(){return new Promise((function(t,e){if(window.indexedDB){var n=window.indexedDB.open("story-app-db",3);n.onerror=function(){e(new Error("Error membuka database"))},n.onsuccess=function(e){t(e.target.result)},n.onupgradeneeded=function(t){var e=t.target.result;e.objectStoreNames.contains(l)||e.createObjectStore(l,{keyPath:"id"}),e.objectStoreNames.contains("pendingStories")||e.createObjectStore("pendingStories",{keyPath:"id",autoIncrement:!0}),e.objectStoreNames.contains("offlineAssets")||e.createObjectStore("offlineAssets",{keyPath:"url"}),e.objectStoreNames.contains("offlineData")||e.createObjectStore("offlineData",{keyPath:"key"}),e.objectStoreNames.contains("bookmarks")||e.createObjectStore("bookmarks",{keyPath:"id"}).createIndex("bookmarkedAt","bookmarkedAt",{unique:!1})}}else e(new Error("Browser tidak mendukung IndexedDB"))}))},f=function(){var t=u(s().mark((function t(){var e,n,r=arguments;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:l,t.next=3,p();case 3:return n=t.sent,t.abrupt("return",new Promise((function(t,r){var o=n.transaction(e,"readonly").objectStore(e).getAll();o.onsuccess=function(){t(o.result)},o.onerror=function(){r(new Error("Gagal mengambil data dari IndexedDB"))}})));case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),h=function(){var t=u(s().mark((function t(e){var n,r,o=arguments;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:l,t.next=3,p();case 3:return r=t.sent,t.abrupt("return",new Promise((function(t,o){var i=r.transaction(n,"readonly").objectStore(n).get(e);i.onsuccess=function(){t(i.result)},i.onerror=function(){o(new Error("Gagal mengambil item dengan id ".concat(e," dari IndexedDB")))}})));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),d=function(){var t=u(s().mark((function t(e){var n,r,o=arguments;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:l,t.next=3,p();case 3:return r=t.sent,t.abrupt("return",new Promise((function(t,o){var i=r.transaction(n,"readwrite").objectStore(n).put(e);i.onsuccess=function(){t()},i.onerror=function(){o(new Error("Gagal menyimpan item ke IndexedDB"))}})));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),m=function(){var t=u(s().mark((function t(e){var n,r,o,i,a=arguments;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:l,t.next=3,p();case 3:return r=t.sent,o=r.transaction(n,"readwrite"),i=o.objectStore(n),t.abrupt("return",Promise.all(e.map((function(t){return new Promise((function(e,n){var r=i.put(t);r.onsuccess=function(){return e()},r.onerror=function(){return n(new Error("Gagal menyimpan item ke IndexedDB"))}}))}))));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),y=function(){var t=u(s().mark((function t(e){var n,r,o=arguments;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:l,t.next=3,p();case 3:return r=t.sent,t.abrupt("return",new Promise((function(t,o){var i=r.transaction(n,"readwrite").objectStore(n).delete(e);i.onsuccess=function(){t()},i.onerror=function(){o(new Error("Gagal menghapus item dengan id ".concat(e," dari IndexedDB")))}})));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),v=function(){var t=u(s().mark((function t(){var e,n,r=arguments;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:l,t.next=3,p();case 3:return n=t.sent,t.abrupt("return",new Promise((function(t,r){var o=n.transaction(e,"readwrite").objectStore(e).clear();o.onsuccess=function(){t()},o.onerror=function(){r(new Error("Gagal menghapus data dari IndexedDB"))}})));case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),g=function(){var t=u(s().mark((function t(e){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d(e,"pendingStories"));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),b=function(){var t=u(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",f("pendingStories"));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),w=function(){var t=u(s().mark((function t(e){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",y(e,"pendingStories"));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),x=function(){var t=u(s().mark((function t(e,n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d({url:e,data:n,timestamp:Date.now()},"offlineAssets"));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),k=function(){var t=u(s().mark((function t(e){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",h(e,"offlineAssets"));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),_=function(){var t=u(s().mark((function t(e,n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",d({key:e,data:n,timestamp:Date.now()},"offlineData"));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),L=function(){var t=u(s().mark((function t(e){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h(e,"offlineData");case 3:return n=t.sent,t.abrupt("return",n?n.data:null);case 7:return t.prev=7,t.t0=t.catch(0),console.error("Error getting offline data for key ".concat(e,":"),t.t0),t.abrupt("return",null);case 11:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}(),E=function(){var t=u(s().mark((function t(){var e;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,L("cachedStories");case 2:if(!((e=t.sent)&&e.length>0)){t.next=5;break}return t.abrupt("return",e);case 5:return t.abrupt("return",[{id:"offline-story-1",name:"Offline Mode",description:"Anda sedang dalam mode offline. Cerita ini tersimpan di penyimpanan lokal.",photoUrl:"/favicon.png",createdAt:(new Date).toISOString(),lat:-6.2,lon:106.8},{id:"offline-story-2",name:"Dicoding Story App",description:"Aplikasi ini dapat diakses secara offline. Koneksi internet diperlukan untuk melihat cerita terbaru.",photoUrl:"/favicon.png",createdAt:new Date(Date.now()-864e5).toISOString(),lat:-6.9,lon:107.6}]);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),S=function(){var t=u(s().mark((function t(e){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e||!Array.isArray(e)){t.next=3;break}return t.next=3,_("cachedStories",e);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),P=function(){var t=u(s().mark((function t(e){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i(i({},e),{},{bookmarkedAt:(new Date).toISOString()}),t.abrupt("return",d(n,"bookmarks"));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),O=function(){var t=u(s().mark((function t(e){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",y(e,"bookmarks"));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),T=function(){var t=u(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",f("bookmarks"));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),A=function(){var t=u(s().mark((function t(e){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h(e,"bookmarks");case 3:return n=t.sent,t.abrupt("return",!!n);case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}();const j={openDB:p,getAll:f,get:h,put:d,saveAll:m,remove:y,deleteAll:v,addPendingStory:g,getPendingStories:b,removePendingStory:w,saveOfflineAsset:x,getOfflineAsset:k,saveOfflineData:_,getOfflineData:L,getDummyStories:E,cacheStories:S,addBookmark:P,removeBookmark:O,getAllBookmarks:T,isBookmarked:A}},255:(t,e,n)=>{n.d(e,{A:()=>r});const r={BASE_URL:"https://story-api.dicoding.dev/v1",WEB_PUSH_VAPID_PUBLIC_KEY:"BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk",DEFAULT_LANGUAGE:"id-ID",AUTH_KEY:"story_app_auth",CACHE_NAME:"story-app-cache-v1"}},778:(t,e,n)=>{n.r(e),n.d(e,{addStory:()=>w,addStoryGuest:()=>k,getAllStories:()=>y,getDetailStory:()=>g,login:()=>d,register:()=>f,subscribeNotification:()=>A,syncPendingStories:()=>L,testNotification:()=>N,unsubscribeNotification:()=>I});var r=n(255),o=n(147);function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function a(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return s(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function c(){c=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function p(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{p({},"")}catch(t){p=function(t,e,n){return t[e]=n}}function f(t,e,n,r){var i=e&&e.prototype instanceof b?e:b,a=Object.create(i.prototype),s=new I(r||[]);return o(a,"_invoke",{value:O(t,n,s)}),a}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var d="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function w(){}function x(){}var k={};p(k,s,(function(){return this}));var _=Object.getPrototypeOf,L=_&&_(_(B([])));L&&L!==n&&r.call(L,s)&&(k=L);var E=x.prototype=b.prototype=Object.create(k);function S(t){["next","throw","return"].forEach((function(e){p(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function n(o,a,s,c){var u=h(t[o],t,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==i(p)&&r.call(p,"__await")?e.resolve(p.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):e.resolve(p).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return a=a?a.then(o,o):o()}})}function O(e,n,r){var o=d;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=T(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=y;var u=h(e,n,r);if("normal"===u.type){if(o=r.done?v:m,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=v,r.method="throw",r.arg=u.arg)}}}function T(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=h(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function B(e){if(e||""===e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(i(e)+" is not iterable")}return w.prototype=x,o(E,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=p(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,p(t,l,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},S(P.prototype),p(P.prototype,u,(function(){return this})),e.AsyncIterator=P,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new P(f(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(E),p(E,l,"Generator"),p(E,s,(function(){return this})),p(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=B,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),j(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;j(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:B(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function u(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function l(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){u(i,r,o,a,s,"next",t)}function s(t){u(i,r,o,a,s,"throw",t)}a(void 0)}))}}var p={REGISTER:"".concat(r.A.BASE_URL,"/register"),LOGIN:"".concat(r.A.BASE_URL,"/login"),GET_ALL_STORIES:"".concat(r.A.BASE_URL,"/stories"),GET_DETAIL_STORY:function(t){return"".concat(r.A.BASE_URL,"/stories/").concat(t)},ADD_STORY:"".concat(r.A.BASE_URL,"/stories"),ADD_STORY_GUEST:"".concat(r.A.BASE_URL,"/stories/guest"),SUBSCRIBE_NOTIFICATION:"".concat(r.A.BASE_URL,"/notifications/subscribe"),UNSUBSCRIBE_NOTIFICATION:"".concat(r.A.BASE_URL,"/notifications/unsubscribe"),TEST_NOTIFICATION:"".concat(r.A.BASE_URL,"/notifications/test")};function f(t){return h.apply(this,arguments)}function h(){return(h=l(c().mark((function t(e){var n,r,o,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.name,r=e.email,o=e.password,t.prev=1,t.next=4,fetch(p.REGISTER,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,email:r,password:o})});case 4:return i=t.sent,t.next=7,i.json();case 7:return t.abrupt("return",t.sent);case 10:return t.prev=10,t.t0=t.catch(1),console.error("Network error during registration:",t.t0),t.abrupt("return",{error:!0,message:"Failed to register. Please check your connection and try again."});case 14:case"end":return t.stop()}}),t,null,[[1,10]])})))).apply(this,arguments)}function d(t){return m.apply(this,arguments)}function m(){return(m=l(c().mark((function t(e){var n,r,o,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.email,r=e.password,t.prev=1,t.next=4,fetch(p.LOGIN,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:r})});case 4:return o=t.sent,t.next=7,o.json();case 7:if(!(i=t.sent).error)try{localStorage.setItem("auth_data",JSON.stringify(i.loginResult))}catch(t){console.error("Failed to save auth data to localStorage",t)}return t.abrupt("return",i);case 12:return t.prev=12,t.t0=t.catch(1),console.error("Network error during login:",t.t0),t.abrupt("return",{error:!0,message:"Failed to login. Please check your connection and try again."});case 16:case"end":return t.stop()}}),t,null,[[1,12]])})))).apply(this,arguments)}function y(t){return v.apply(this,arguments)}function v(){return(v=l(c().mark((function t(e){var n,r,i,a,s,u,l,f,h,d,m,y,v,g;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.page,r=void 0===n?1:n,i=e.size,a=void 0===i?10:i,s=e.location,u=void 0===s?0:s,l=e.token,f=void 0===l?"":l,t.prev=1,d="".concat(p.GET_ALL_STORIES,"?page=").concat(r,"&size=").concat(a,"&location=").concat(u),m={},f&&(m.Authorization="Bearer ".concat(f)),t.next=7,fetch(d,{headers:m});case 7:return y=t.sent,t.next=10,y.json();case 10:if(v=t.sent,console.log("[API] Fetched ".concat((null===(h=v.listStory)||void 0===h?void 0:h.length)||0," stories from page ").concat(r)),!v.error){t.next=15;break}return console.error("[API] Error fetching stories:",v.message),t.abrupt("return",v);case 15:if(!(!v.error&&v.listStory&&v.listStory.length>0)){t.next=27;break}if(t.prev=16,1!==r){t.next=20;break}return t.next=20,o.A.deleteAll();case 20:return t.next=22,o.A.saveAll(v.listStory);case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(16),console.error("Failed to cache stories:",t.t0);case 27:return t.abrupt("return",v);case 30:if(t.prev=30,t.t1=t.catch(1),console.error("Network error when fetching stories:",t.t1),navigator.onLine){t.next=45;break}return t.prev=34,t.next=37,o.A.getAll();case 37:if(!((g=t.sent)&&g.length>0)){t.next=40;break}return t.abrupt("return",{error:!1,message:"Using cached data (offline mode)",listStory:g,fromCache:!0});case 40:t.next=45;break;case 42:t.prev=42,t.t2=t.catch(34),console.error("Failed to get cached stories:",t.t2);case 45:return t.abrupt("return",{error:!0,message:"Failed to fetch stories. Please check your connection and try again."});case 46:case"end":return t.stop()}}),t,null,[[1,30],[16,24],[34,42]])})))).apply(this,arguments)}function g(t){return b.apply(this,arguments)}function b(){return(b=l(c().mark((function t(e){var n,r,i,a,s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.id,r=e.token,t.prev=1,t.next=4,fetch(p.GET_DETAIL_STORY(n),{headers:{Authorization:"Bearer ".concat(r)}});case 4:return i=t.sent,t.next=7,i.json();case 7:if((a=t.sent).error||!a.story){t.next=17;break}return t.prev=9,t.next=12,o.A.put(a.story);case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(9),console.error("Failed to cache story detail:",t.t0);case 17:return t.abrupt("return",a);case 20:if(t.prev=20,t.t1=t.catch(1),console.error("Network error when fetching story detail:",t.t1),navigator.onLine){t.next=35;break}return t.prev=24,t.next=27,o.A.get(n);case 27:if(!(s=t.sent)){t.next=30;break}return t.abrupt("return",{error:!1,message:"Using cached data (offline mode)",story:s,fromCache:!0});case 30:t.next=35;break;case 32:t.prev=32,t.t2=t.catch(24),console.error("Failed to get cached story:",t.t2);case 35:return t.abrupt("return",{error:!0,message:"Failed to fetch story detail. Please check your connection and try again."});case 36:case"end":return t.stop()}}),t,null,[[1,20],[9,14],[24,32]])})))).apply(this,arguments)}function w(t){return x.apply(this,arguments)}function x(){return(x=l(c().mark((function t(e){var n,r,i,a,s,u,l,f,h,d,m;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.description,r=e.photo,i=e.lat,a=void 0===i?null:i,s=e.lon,u=void 0===s?null:s,l=e.token,t.prev=1,(f=new FormData).append("description",n),f.append("photo",r),null!==a&&null!==u&&(f.append("lat",a),f.append("lon",u)),t.next=8,fetch(p.ADD_STORY,{method:"POST",headers:{Authorization:"Bearer ".concat(l)},body:f});case 8:return h=t.sent,t.next=11,h.json();case 11:return d=t.sent,t.abrupt("return",d);case 15:if(t.prev=15,t.t0=t.catch(1),console.error("Network error when adding story:",t.t0),navigator.onLine){t.next=37;break}return t.prev=19,t.t1="pending-".concat(Date.now()),t.t2=n,t.next=24,S(r);case 24:return t.t3=t.sent,t.t4=a,t.t5=u,t.t6=(new Date).toISOString(),m={id:t.t1,description:t.t2,photoData:t.t3,lat:t.t4,lon:t.t5,createdAt:t.t6,isPending:!0},t.next=31,o.A.addPendingStory(m);case 31:return t.abrupt("return",{error:!1,message:"Story saved offline and will be uploaded when you're back online",isPending:!0,story:m});case 34:t.prev=34,t.t7=t.catch(19),console.error("Failed to save pending story:",t.t7);case 37:return t.abrupt("return",{error:!0,message:"Failed to add story. Please check your connection and try again."});case 38:case"end":return t.stop()}}),t,null,[[1,15],[19,34]])})))).apply(this,arguments)}function k(t){return _.apply(this,arguments)}function _(){return(_=l(c().mark((function t(e){var n,r,i,a,s,u,l,f,h,d;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.description,r=e.photo,i=e.lat,a=void 0===i?null:i,s=e.lon,u=void 0===s?null:s,t.prev=1,(l=new FormData).append("description",n),l.append("photo",r),null!==a&&null!==u&&(l.append("lat",a),l.append("lon",u)),t.next=8,fetch(p.ADD_STORY_GUEST,{method:"POST",body:l});case 8:return f=t.sent,t.next=11,f.json();case 11:return h=t.sent,t.abrupt("return",h);case 15:if(t.prev=15,t.t0=t.catch(1),console.error("Network error when adding guest story:",t.t0),navigator.onLine){t.next=37;break}return t.prev=19,t.t1="pending-guest-".concat(Date.now()),t.t2=n,t.next=24,S(r);case 24:return t.t3=t.sent,t.t4=a,t.t5=u,t.t6=(new Date).toISOString(),d={id:t.t1,description:t.t2,photoData:t.t3,lat:t.t4,lon:t.t5,createdAt:t.t6,isPending:!0,isGuest:!0},t.next=31,o.A.addPendingStory(d);case 31:return t.abrupt("return",{error:!1,message:"Story saved offline and will be uploaded when you're back online",isPending:!0,story:d});case 34:t.prev=34,t.t7=t.catch(19),console.error("Failed to save pending guest story:",t.t7);case 37:return t.abrupt("return",{error:!0,message:"Failed to add story. Please check your connection and try again."});case 38:case"end":return t.stop()}}),t,null,[[1,15],[19,34]])})))).apply(this,arguments)}function L(t){return E.apply(this,arguments)}function E(){return(E=l(c().mark((function t(e){var n,r,i,s,u,l;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(navigator.onLine){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,o.A.getPendingStories();case 5:if((n=t.sent)&&0!==n.length){t.next=8;break}return t.abrupt("return");case 8:r=a(n),t.prev=9,r.s();case 11:if((i=r.n()).done){t.next=34;break}return s=i.value,t.prev=13,t.next=16,O(s.photoData);case 16:if(u=t.sent,l=new File([u],"photo.jpg",{type:"image/jpeg"}),!s.isGuest){t.next=23;break}return t.next=21,k({description:s.description,photo:l,lat:s.lat,lon:s.lon});case 21:t.next=25;break;case 23:return t.next=25,w({description:s.description,photo:l,lat:s.lat,lon:s.lon,token:e});case 25:return t.next=27,o.A.removePendingStory(s.id);case 27:t.next=32;break;case 29:t.prev=29,t.t0=t.catch(13),console.error("Failed to sync story ".concat(s.id,":"),t.t0);case 32:t.next=11;break;case 34:t.next=39;break;case 36:t.prev=36,t.t1=t.catch(9),r.e(t.t1);case 39:return t.prev=39,r.f(),t.finish(39);case 42:t.next=47;break;case 44:t.prev=44,t.t2=t.catch(2),console.error("Error syncing pending stories:",t.t2);case 47:case"end":return t.stop()}}),t,null,[[2,44],[9,36,39,42],[13,29]])})))).apply(this,arguments)}function S(t){return P.apply(this,arguments)}function P(){return(P=l(c().mark((function t(e){return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){var r=new FileReader;r.onload=function(){return t(r.result)},r.onerror=function(t){return n(t)},r.readAsDataURL(e)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function O(t){return T.apply(this,arguments)}function T(){return(T=l(c().mark((function t(e){var n,r,o,i,a,s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=e.split(";base64,"),r=n[0].split(":")[1],o=window.atob(n[1]),i=o.length,a=new Uint8Array(i),s=0;s<i;++s)a[s]=o.charCodeAt(s);return t.abrupt("return",new Blob([a],{type:r}));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function A(t){return j.apply(this,arguments)}function j(){return(j=l(c().mark((function t(e){var n,r,o,i,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.endpoint,r=e.keys,o=e.token,t.prev=1,t.next=4,fetch(p.SUBSCRIBE_NOTIFICATION,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({endpoint:n,keys:r})});case 4:return i=t.sent,t.next=7,i.json();case 7:if(a=t.sent,i.ok){t.next=10;break}throw new Error(a.message||"Failed to subscribe");case 10:return t.abrupt("return",a);case 13:return t.prev=13,t.t0=t.catch(1),console.error("Error subscribing to notifications:",t.t0),t.abrupt("return",{error:!0,message:t.t0.message||"Failed to subscribe to notifications"});case 17:case"end":return t.stop()}}),t,null,[[1,13]])})))).apply(this,arguments)}function I(t){return B.apply(this,arguments)}function B(){return(B=l(c().mark((function t(e){var n,r,o,i;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.endpoint,r=e.token,t.prev=1,t.next=4,fetch(p.UNSUBSCRIBE_NOTIFICATION,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({endpoint:n})});case 4:return o=t.sent,t.next=7,o.json();case 7:if(i=t.sent,o.ok){t.next=10;break}throw new Error(i.message||"Failed to unsubscribe");case 10:return t.abrupt("return",i);case 13:return t.prev=13,t.t0=t.catch(1),console.error("Error unsubscribing from notifications:",t.t0),t.abrupt("return",{error:!0,message:t.t0.message||"Failed to unsubscribe from notifications"});case 17:case"end":return t.stop()}}),t,null,[[1,13]])})))).apply(this,arguments)}function N(t){return C.apply(this,arguments)}function C(){return(C=l(c().mark((function t(e){var n,r,o;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.token,t.prev=1,console.log("Sending test notification with token:",n),t.next=5,fetch(p.TEST_NOTIFICATION,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({message:"Test notification from Story App"})});case 5:return r=t.sent,t.next=8,r.json();case 8:if(o=t.sent,console.log("Test notification response:",o),r.ok){t.next=12;break}throw new Error(o.message||"Test notification request failed");case 12:return t.abrupt("return",o);case 15:return t.prev=15,t.t0=t.catch(1),console.error("Error sending test notification:",t.t0),t.abrupt("return",{error:!0,message:t.t0.message||"Failed to send test notification"});case 19:case"end":return t.stop()}}),t,null,[[1,15]])})))).apply(this,arguments)}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r=function(){var t=window.location.hash.slice(1),e=o(t);if(console.log("[URL Parser] getActiveRoute - Original URL:",t),console.log("[URL Parser] getActiveRoute - Splited:",e),"story"===e.resource&&e.id)return console.log("[URL Parser] getActiveRoute - Returning story route with ID:",e.id),"/story/:id";var n=e.resource?"/".concat(e.resource.toLowerCase()):"/";return console.log("[URL Parser] getActiveRoute - Returning route:",n),n},o=function(t){var e=t.split("/");return{resource:e[1]||null,id:e[2]||null,verb:e[3]||null}};function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function a(){a=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},c=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function p(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{p({},"")}catch(t){p=function(t,e,n){return t[e]=n}}function f(t,e,n,r){var i=e&&e.prototype instanceof b?e:b,a=Object.create(i.prototype),s=new I(r||[]);return o(a,"_invoke",{value:O(t,n,s)}),a}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=f;var d="suspendedStart",m="suspendedYield",y="executing",v="completed",g={};function b(){}function w(){}function x(){}var k={};p(k,c,(function(){return this}));var _=Object.getPrototypeOf,L=_&&_(_(B([])));L&&L!==n&&r.call(L,c)&&(k=L);var E=x.prototype=b.prototype=Object.create(k);function S(t){["next","throw","return"].forEach((function(e){p(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function n(o,a,s,c){var u=h(t[o],t,a);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==i(p)&&r.call(p,"__await")?e.resolve(p.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):e.resolve(p).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return a=a?a.then(o,o):o()}})}function O(e,n,r){var o=d;return function(i,a){if(o===y)throw Error("Generator is already running");if(o===v){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=T(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=y;var u=h(e,n,r);if("normal"===u.type){if(o=r.done?v:m,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=v,r.method="throw",r.arg=u.arg)}}}function T(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=h(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function B(e){if(e||""===e){var n=e[c];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(i(e)+" is not iterable")}return w.prototype=x,o(E,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=p(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,p(t,l,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},S(P.prototype),p(P.prototype,u,(function(){return this})),e.AsyncIterator=P,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new P(f(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(E),p(E,l,"Generator"),p(E,c,(function(){return this})),p(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=B,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),j(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;j(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:B(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function s(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){s(i,r,o,a,c,"next",t)}function c(t){s(i,r,o,a,c,"throw",t)}a(void 0)}))}}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,l(r.key),r)}}function l(t){var e=function(t){if("object"!=i(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==i(e)?e:e+""}const p=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.styles="\n      .about-page {\n        max-width: 1000px;\n        margin: 0 auto;\n        padding: 2rem;\n        font-family: 'Inter', 'Roboto', sans-serif;\n        color: #2d3748;\n        line-height: 1.6;\n      }\n\n      .page-header {\n        text-align: center;\n        margin-bottom: 3rem;\n        padding-bottom: 2rem;\n        border-bottom: 1px solid #e2e8f0;\n      }\n\n      .app-icon {\n        width: 64px;\n        height: 64px;\n        background-color: #4a5568;\n        border-radius: 12px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin: 0 auto 1.5rem;\n      }\n\n      .app-icon i {\n        font-size: 1.8rem;\n        color: white;\n      }\n\n      .about-page h1 {\n        font-size: 2.5rem;\n        font-weight: 600;\n        color: #1a202c;\n        margin-bottom: 0.5rem;\n      }\n\n      .page-subtitle {\n        font-size: 1.1rem;\n        color: #718096;\n        margin: 0;\n      }\n\n      .content-section {\n        margin-bottom: 3rem;\n      }\n\n      .section-title {\n        font-size: 1.5rem;\n        font-weight: 600;\n        color: #2d3748;\n        margin-bottom: 1.5rem;\n        padding-bottom: 0.5rem;\n        border-bottom: 2px solid #e2e8f0;\n      }\n\n      .section-content {\n        background: #f7fafc;\n        padding: 2rem;\n        border-radius: 8px;\n        border-left: 4px solid #4a5568;\n      }\n\n      .about-page p {\n        margin-bottom: 1rem;\n        color: #4a5568;\n        font-size: 1rem;\n      }\n\n      .features-list {\n        list-style: none;\n        padding: 0;\n        margin: 0;\n      }\n\n      .feature-item {\n        display: flex;\n        align-items: flex-start;\n        margin-bottom: 1rem;\n        padding: 1rem;\n        background: white;\n        border-radius: 6px;\n        border: 1px solid #e2e8f0;\n      }\n\n      .feature-icon {\n        flex-shrink: 0;\n        width: 32px;\n        height: 32px;\n        background-color: #edf2f7;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin-right: 1rem;\n      }\n\n      .feature-icon i {\n        font-size: 0.9rem;\n        color: #4a5568;\n      }\n\n      .feature-text {\n        flex: 1;\n        font-size: 0.95rem;\n        color: #4a5568;\n        margin: 0;\n      }\n\n      .tech-stack {\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));\n        gap: 0.75rem;\n        margin-top: 1rem;\n      }\n\n      .tech-item {\n        background: white;\n        padding: 0.75rem 1rem;\n        border-radius: 6px;\n        border: 1px solid #e2e8f0;\n        text-align: center;\n        font-size: 0.9rem;\n        color: #4a5568;\n        font-weight: 500;\n      }\n\n      .layout-grid {\n        display: grid;\n        grid-template-columns: 1fr;\n        gap: 3rem;\n      }\n\n      @media (min-width: 768px) {\n        .layout-grid {\n          grid-template-columns: 2fr 1fr;\n        }\n      }\n\n      .main-content {\n        /* Konten utama */\n      }\n\n      .sidebar-content {\n        background: #f7fafc;\n        padding: 2rem;\n        border-radius: 8px;\n        border: 1px solid #e2e8f0;\n        height: fit-content;\n      }\n\n      .sidebar-title {\n        font-size: 1.25rem;\n        font-weight: 600;\n        color: #2d3748;\n        margin-bottom: 1rem;\n        text-align: center;\n      }\n\n      .developer-info {\n        text-align: center;\n      }\n\n      .developer-avatar {\n        width: 60px;\n        height: 60px;\n        background-color: #edf2f7;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin: 0 auto 1rem;\n      }\n\n      .developer-avatar i {\n        font-size: 1.5rem;\n        color: #4a5568;\n      }\n\n      .info-list {\n        list-style: none;\n        padding: 0;\n        margin: 1.5rem 0 0;\n      }\n\n      .info-list li {\n        padding: 0.5rem 0;\n        border-bottom: 1px solid #e2e8f0;\n        font-size: 0.9rem;\n        color: #4a5568;\n      }\n\n      .info-list li:last-child {\n        border-bottom: none;\n      }\n\n      .info-label {\n        font-weight: 600;\n        color: #2d3748;\n      }\n\n      @media (max-width: 768px) {\n        .about-page {\n          padding: 1rem;\n        }\n\n        .about-page h1 {\n          font-size: 2rem;\n        }\n\n        .section-content {\n          padding: 1.5rem;\n        }\n\n        .layout-grid {\n          gap: 2rem;\n        }\n\n        .tech-stack {\n          grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));\n        }\n      }\n    "},e=[{key:"render",value:(r=c(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return","\n      <style>".concat(this.styles,'</style>\n      <section class="container about-page app-shell-content">\n        \n       \n\n        <div class="layout-grid">\n          <div class="main-content">\n            \n            <div class="content-section">\n              <h2 class="section-title">Tentang Aplikasi</h2>\n              <div class="section-content">\n                <p>Story App adalah platform untuk berbagi cerita, pengalaman, dan momen bersama komunitas Dicoding. Aplikasi ini memungkinkan pengguna untuk membuat, berbagi, dan menjelajahi cerita dari berbagai lokasi.</p>\n                <p>Dengan fokus pada kemudahan penggunaan dan pengalaman pengguna yang optimal, Story App dibangun menggunakan teknologi web modern dan mengikuti best practices dalam pengembangan aplikasi web.</p>\n              </div>\n            </div>\n\n            <div class="content-section">\n              <h2 class="section-title">Fitur Utama</h2>\n              <div class="section-content">\n                <ul class="features-list">\n                  <li class="feature-item">\n                    <div class="feature-icon">\n                      <i class="fas fa-camera"></i>\n                    </div>\n                    <p class="feature-text">Ambil foto langsung dari kamera untuk cerita Anda</p>\n                  </li>\n                  <li class="feature-item">\n                    <div class="feature-icon">\n                      <i class="fas fa-map-marker-alt"></i>\n                    </div>\n                    <p class="feature-text">Tambahkan lokasi pada setiap cerita yang dibagikan</p>\n                  </li>\n                  <li class="feature-item">\n                    <div class="feature-icon">\n                      <i class="fas fa-globe"></i>\n                    </div>\n                    <p class="feature-text">Jelajahi cerita dari pengguna lain di peta interaktif</p>\n                  </li>\n                  <li class="feature-item">\n                    <div class="feature-icon">\n                      <i class="fas fa-bookmark"></i>\n                    </div>\n                    <p class="feature-text">Simpan cerita favorit untuk dibaca kemudian</p>\n                  </li>\n                  <li class="feature-item">\n                    <div class="feature-icon">\n                      <i class="fas fa-bell"></i>\n                    </div>\n                    <p class="feature-text">Dapatkan notifikasi untuk cerita baru dari komunitas</p>\n                  </li>\n                  <li class="feature-item">\n                    <div class="feature-icon">\n                      <i class="fas fa-mobile-alt"></i>\n                    </div>\n                    <p class="feature-text">Akses aplikasi dari berbagai perangkat dengan responsif</p>\n                  </li>\n                </ul>\n              </div>\n            </div>\n\n            <div class="content-section">\n              <h2 class="section-title">Teknologi</h2>\n              <div class="section-content">\n                <p>Aplikasi ini dibangun menggunakan teknologi web modern untuk memberikan performa dan pengalaman terbaik:</p>\n                <div class="tech-stack">\n                  <div class="tech-item">JavaScript ES6+</div>\n                  <div class="tech-item">SPA Architecture</div>\n                  <div class="tech-item">MVP Pattern</div>\n                  <div class="tech-item">Camera API</div>\n                  <div class="tech-item">Geolocation API</div>\n                  <div class="tech-item">Maps Integration</div>\n                  <div class="tech-item">Web Push API</div>\n                  <div class="tech-item">Service Worker</div>\n                  <div class="tech-item">Progressive Web App</div>\n                  <div class="tech-item">Responsive Design</div>\n                  <div class="tech-item">Webpack</div>\n                  <div class="tech-item">Local Storage</div>\n                </div>\n              </div>\n            </div>\n\n          </div>\n\n          <div class="sidebar-content">\n            <h3 class="sidebar-title">Informasi Developer</h3>\n            <div class="developer-info">\n              <div class="developer-avatar">\n                <i class="fas fa-user-graduate"></i>\n              </div>\n              <p>Aplikasi ini dikembangkan sebagai bagian dari program pembelajaran Dicoding.</p>\n              \n              <ul class="info-list">\n                <li><span class="info-label">Developed by:</span> Vania Rahma Dewi</li>\n                <li><span class="info-label">Tipe:</span> Submission Project</li>\n                <li><span class="info-label">Platform:</span> Dicoding Academy</li>\n                <li><span class="info-label">Kelas:</span> Front-End & Back-End</li>\n                <li><span class="info-label">Arsitektur:</span> Single Page Application</li>\n                <li><span class="info-label">Pattern:</span> Model-View-Presenter</li>\n                <li><span class="info-label">Status:</span> Progressive Web App</li>\n              </ul>\n            </div>\n          </div>\n\n        </div>\n      </section>\n    '));case 1:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=c(a().mark((function t(){var e,n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:document.title="About - Story App",document.querySelector('link[href*="font-awesome"]')||((e=document.createElement("link")).rel="stylesheet",e.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css",document.head.appendChild(e)),document.querySelector('link[href*="Inter"]')||((n=document.createElement("link")).rel="stylesheet",n.href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap",document.head.appendChild(n));case 3:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){console.log("[AboutPage] Destroy called")}}],e&&u(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();var f=n(778),h=n(255),d={setAuth:function(t){console.log("Setting auth data:",t),localStorage.setItem(h.A.AUTH_KEY,JSON.stringify(t)),this.updateAuthButton()},getAuth:function(){return JSON.parse(localStorage.getItem(h.A.AUTH_KEY)||"{}")},clearAuth:function(){console.log("Clearing auth data"),localStorage.removeItem(h.A.AUTH_KEY),this.updateAuthButton()},destroyAuth:function(){this.clearAuth()},isUserSignedIn:function(){var t=this.getAuth(),e=Boolean(t.token);return console.log("User signed in:",e),e},updateAuthButton:function(){var t=this,e=(document.getElementById("login-nav-item"),document.querySelector('a[href="#/login"]'));if(e){var n=this.isUserSignedIn();if(console.log("Updating auth button. User logged in:",n),n){e.innerHTML='<i class="fas fa-sign-out-alt"></i> Logout';var r=e.cloneNode(!0);e.parentNode.replaceChild(r,e),r.addEventListener("click",(function(e){return e.preventDefault(),e.stopPropagation(),t.clearAuth(),setTimeout((function(){window.location.hash="#/login"}),50),!1}))}else{e.innerHTML='<i class="fas fa-sign-in-alt"></i> Login';var o=e.cloneNode(!0);e.parentNode.replaceChild(o,e),o.href="#/login"}}else console.log("Login button not found")},clearAuthOnStartup:function(){""!==window.location.hash&&"#/"!==window.location.hash&&"#"!==window.location.hash||(console.log("Clearing auth state on initial load to ensure login page is shown first"),this.clearAuth())},initAuthState:function(){var t=this;document.addEventListener("DOMContentLoaded",(function(){console.log("DOM loaded, updating auth button"),t.updateAuthButton()})),window.addEventListener("hashchange",(function(){console.log("Hash changed, updating auth button"),t.updateAuthButton()}))}};d.initAuthState();const m=d;function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function v(){v=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof b?e:b,a=Object.create(i.prototype),s=new I(r||[]);return o(a,"_invoke",{value:O(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",g={};function b(){}function w(){}function x(){}var k={};u(k,a,(function(){return this}));var _=Object.getPrototypeOf,L=_&&_(_(B([])));L&&L!==n&&r.call(L,a)&&(k=L);var E=x.prototype=b.prototype=Object.create(k);function S(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==y(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=T(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function T(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function B(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(y(e)+" is not iterable")}return w.prototype=x,o(E,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=u(x,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,u(t,c,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},S(P.prototype),u(P.prototype,s,(function(){return this})),e.AsyncIterator=P,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new P(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},S(E),u(E,c,"Generator"),u(E,a,(function(){return this})),u(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=B,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),j(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;j(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:B(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},e}function g(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,w(r.key),r)}}function w(t){var e=function(t){if("object"!=y(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==y(e)?e:e+""}function x(t,e){return t.get(k(t,e))}function k(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var _=new WeakMap,E=function(){return t=function t(e){var n,r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}(this,_,void 0),r=e,(n=_).set(k(n,this),r)},e=[{key:"init",value:function(){return this}},{key:"destroy",value:function(){}},{key:"login",value:(n=v().mark((function t(e,n){var r;return v().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return x(_,this).setSubmitButtonState(!0,"Signing in..."),t.next=3,(0,f.login)({email:e,password:n});case 3:(r=t.sent).error?(x(_,this).showAlert("Login failed: ".concat(r.message)),x(_,this).setSubmitButtonState(!1,"Sign In")):(m.setAuth({token:r.loginResult.token,name:r.loginResult.name,userId:r.loginResult.userId}),window.location.hash="#/home",window.location.reload());case 5:case"end":return t.stop()}}),t,this)})),r=function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(t){g(i,r,o,a,s,"next",t)}function s(t){g(i,r,o,a,s,"throw",t)}a(void 0)}))},function(t,e){return r.apply(this,arguments)})},{key:"validateInput",value:function(t,e){return t&&e?!!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(x(_,this).showAlert("Please enter a valid email address"),!1):(x(_,this).showAlert("Please fill in all fields"),!1)}}],e&&b(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function P(){P=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new I(r||[]);return o(a,"_invoke",{value:O(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(B([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==S(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=T(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function T(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function B(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(S(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=B,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),j(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;j(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:B(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function O(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function T(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){O(i,r,o,a,s,"next",t)}function s(t){O(i,r,o,a,s,"throw",t)}a(void 0)}))}}function A(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,j(r.key),r)}}function j(t){var e=function(t){if("object"!=S(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==S(e)?e:e+""}const I=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.presenter=new E(this),this.model={email:"",password:"",errorMessage:""},this.isLoading=!1},e=[{key:"render",value:(r=T(P().mark((function t(){return P().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <style>\n        ::view-transition-old(root),\n        ::view-transition-new(root) {\n          animation-duration: 0.5s;\n        }\n\n        #login-container {\n          view-transition-name: login-container;\n        }\n\n        ::view-transition-old(login-container) {\n          animation: 300ms cubic-bezier(0.4, 0, 0.2, 1) both fade-out;\n        }\n\n        ::view-transition-new(login-container) {\n          animation: 300ms cubic-bezier(0.4, 0, 0.2, 1) both fade-in;\n        }\n\n        #login-form-container {\n          view-transition-name: login-form;\n        }\n\n        ::view-transition-old(login-form) {\n          animation: 300ms cubic-bezier(0.4, 0, 0.2, 1) both slide-out;\n        }\n\n        ::view-transition-new(login-form) {\n          animation: 300ms cubic-bezier(0.4, 0, 0.2, 1) both slide-in;\n        }\n\n        @keyframes fade-in {\n          from {\n            opacity: 0;\n          }\n          to {\n            opacity: 1;\n          }\n        }\n\n        @keyframes fade-out {\n          from {\n            opacity: 1;\n          }\n          to {\n            opacity: 0;\n          }\n        }\n\n        @keyframes slide-in {\n          from {\n            transform: translateY(30px);\n            opacity: 0;\n          }\n          to {\n            transform: translateY(0);\n            opacity: 1;\n          }\n        }\n\n        @keyframes slide-out {\n          from {\n            transform: translateY(0);\n            opacity: 1;\n          }\n          to {\n            transform: translateY(-30px);\n            opacity: 0;\n          }\n        }\n\n        .form-actions {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          text-align: center;\n          margin-top: 20px;\n        }\n\n        .btn-primary {\n          width: 100%;\n          max-width: 200px;\n          padding: 10px 0;\n          margin-bottom: 15px;\n        }\n\n        .auth-redirect {\n          margin-top: 10px;\n          text-align: center;\n        }\n      </style>\n      <section class="container auth-page app-shell-content" id="login-container">\n        <div class="auth-form-container" id="login-form-container">\n          <h1>Login to Story App</h1>\n         \n          <form id="login-form">\n            <div class="form-group">\n              <label for="email">Email</label>\n              <input type="email" id="email" required>\n            </div>\n           \n            <div class="form-group">\n              <label for="password">Password</label>\n              <input type="password" id="password" required>\n            </div>\n           \n            <div id="error-container" class="error-message"></div>\n           \n            <div class="form-actions">\n              <button type="submit" id="login-button" class="btn btn-primary">Login</button>\n              <div class="auth-redirect">\n                Don\'t have an account? <a href="#/register" class="route-link">Register</a> or\n                <a href="#/" class="route-link">continue as guest</a>\n              </div>\n            </div>\n          </form>\n        </div>\n      </section>\n    ');case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=T(P().mark((function t(){return P().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.presenter.init(),this._initLoginForm(),this._initTransitionLinks();case 3:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"_initLoginForm",value:function(){var t=this,e=document.getElementById("login-form"),n=document.getElementById("email"),r=document.getElementById("password");n.addEventListener("input",(function(){t.model.email=n.value})),r.addEventListener("input",(function(){t.model.password=r.value})),e.addEventListener("submit",function(){var e=T(P().mark((function e(n){var r,o;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),!t.isLoading){e.next=3;break}return e.abrupt("return");case 3:if(r=t.model.email,o=t.model.password,!t.presenter.validateInput(r,o)){e.next=8;break}return e.next=8,t.presenter.login(r,o);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"_initTransitionLinks",value:function(){document.querySelectorAll(".route-link").forEach((function(t){t.addEventListener("click",function(){var e=T(P().mark((function e(n){var r,o;return P().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),r=t.getAttribute("href"),!document.startViewTransition){e.next=7;break}return o=document.startViewTransition((function(){window.location.hash=r})),e.next=6,o.ready;case 6:return e.abrupt("return");case 7:window.location.hash=r;case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))}},{key:"setSubmitButtonState",value:function(t,e){this.isLoading=t;var n=document.getElementById("login-button");n&&(n.disabled=t,n.textContent=e||(t?"Logging in...":"Login"))}},{key:"showAlert",value:function(t){var e=document.getElementById("error-container");e&&(e.textContent=t,e.style.display="block")}},{key:"navigateToHome",value:function(){if("caches"in window){var t=m.getAuth();if(t)try{localStorage.setItem("cached_user",JSON.stringify(t))}catch(t){console.error("Failed to cache user data:",t)}}console.log("Login berhasil - Navigating to home page"),window.location.hash="#/home"}},{key:"isLoginPage",value:function(){return Boolean(document.getElementById("login-form"))}}],e&&A(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function N(){N=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(j([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==B(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(B(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function C(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function F(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){C(i,r,o,a,s,"next",t)}function s(t){C(i,r,o,a,s,"throw",t)}a(void 0)}))}}function M(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,G(r.key),r)}}function G(t){var e=function(t){if("object"!=B(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==B(e)?e:e+""}const D=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._model={name:"",email:"",password:"",confirmPassword:"",errorMessage:""},this._isLoading=!1,this.handleSubmit=this.handleSubmit.bind(this)},e=[{key:"render",value:(o=F(N().mark((function t(){return N().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <style>\n        /* Styling untuk form actions dan tombol register */\n        .form-actions {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          text-align: center;\n          margin-top: 20px;\n        }\n\n        .btn-primary {\n          width: 100%;\n          max-width: 200px;\n          padding: 10px 0;\n          margin-bottom: 15px;\n        }\n\n        .auth-redirect {\n          margin-top: 10px;\n          text-align: center;\n        }\n      </style>\n      <section class="container auth-page">\n        <div class="auth-form-container">\n          <h1>Create an Account</h1>\n          \n          <form id="register-form" class="auth-form">\n            <div class="form-group">\n              <label for="name">Name</label>\n              <input type="text" id="name" name="name" required autocomplete="name">\n            </div>\n            \n            <div class="form-group">\n              <label for="email">Email</label>\n              <input type="email" id="email" name="email" required autocomplete="email">\n            </div>\n            \n            <div class="form-group">\n              <label for="password">Password</label>\n              <input type="password" id="password" name="password" required autocomplete="new-password" minlength="8">\n              <p class="helper-text">Password must be at least 8 characters long</p>\n            </div>\n            \n            <div class="form-group">\n              <label for="confirm-password">Confirm Password</label>\n              <input type="password" id="confirm-password" name="confirm-password" required autocomplete="new-password" minlength="8">\n            </div>\n            \n            <div id="error-container" class="error-message"></div>\n            \n            <div class="form-actions">\n              <button type="submit" id="register-button" class="btn btn-primary">Register</button>\n              <p class="auth-redirect">\n                Already have an account? <a href="#/login">Login</a> or \n                <a href="#/">continue as guest</a>\n              </p>\n            </div>\n          </form>\n        </div>\n      </section>\n    ');case 1:case"end":return t.stop()}}),t)}))),function(){return o.apply(this,arguments)})},{key:"afterRender",value:(r=F(N().mark((function t(){return N().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.init(),this._initRegisterForm();case 2:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"init",value:function(){return this}},{key:"isLoading",get:function(){return this._isLoading},set:function(t){this._isLoading=t,this.updateLoadingState(this._isLoading)}},{key:"setName",value:function(t){this._model.name=t}},{key:"setEmail",value:function(t){this._model.email=t}},{key:"setPassword",value:function(t){this._model.password=t}},{key:"setConfirmPassword",value:function(t){this._model.confirmPassword=t}},{key:"_initRegisterForm",value:function(){var t=this,e=document.getElementById("register-form"),n=document.getElementById("name"),r=document.getElementById("email"),o=document.getElementById("password"),i=document.getElementById("confirm-password");n.addEventListener("input",(function(){t.setName(n.value)})),r.addEventListener("input",(function(){t.setEmail(r.value)})),o.addEventListener("input",(function(){t.setPassword(o.value)})),i.addEventListener("input",(function(){t.setConfirmPassword(i.value)})),e.addEventListener("submit",(function(e){t.handleSubmit(e)}))}},{key:"validateForm",value:function(){var t=this._model,e=t.name,n=t.email,r=t.password,o=t.confirmPassword;return this.clearError(),e.trim().length<2?(this._model.errorMessage="Name must be at least 2 characters long.",this.showError(this._model.errorMessage),!1):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)?r.length<8?(this._model.errorMessage="Password must be at least 8 characters long.",this.showError(this._model.errorMessage),!1):r===o||(this._model.errorMessage="Passwords do not match.",this.showError(this._model.errorMessage),!1):(this._model.errorMessage="Please enter a valid email address.",this.showError(this._model.errorMessage),!1)}},{key:"handleSubmit",value:(n=F(N().mark((function t(e){var n,r,o,i,a;return N().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),!this._isLoading){t.next=3;break}return t.abrupt("return");case 3:if(this.validateForm()){t.next=5;break}return t.abrupt("return");case 5:return t.prev=5,this.isLoading=!0,n=this._model,r=n.name,o=n.email,i=n.password,t.next=10,(0,f.register)({name:r,email:o,password:i});case 10:(a=t.sent).error?(this._model.errorMessage=a.message||"Registration failed. Please try again.",this.showError(this._model.errorMessage)):(this.showSuccessMessage(),this.navigateToLogin()),t.next=19;break;case 14:t.prev=14,t.t0=t.catch(5),console.error("Registration error:",t.t0),this._model.errorMessage="An error occurred during registration. Please try again.",this.showError(this._model.errorMessage);case 19:return t.prev=19,this.isLoading=!1,t.finish(19);case 22:case"end":return t.stop()}}),t,this,[[5,14,19,22]])}))),function(t){return n.apply(this,arguments)})},{key:"navigateToLogin",value:function(){window.location.hash="#/login"}},{key:"updateLoadingState",value:function(t){var e=document.getElementById("register-button");t?(e.disabled=!0,e.textContent="Registering..."):(e.disabled=!1,e.textContent="Register")}},{key:"showError",value:function(t){var e=document.getElementById("error-container");e&&(e.textContent=t,e.style.display="block")}},{key:"clearError",value:function(){var t=document.getElementById("error-container");t&&(t.textContent="",t.style.display="none")}},{key:"showSuccessMessage",value:function(){alert("Registration successful! Please login with your new account.")}},{key:"destroy",value:function(){}}],e&&M(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o}();function z(t){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z(t)}function H(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function R(t,e,n){return(e=function(t){var e=function(t){if("object"!=z(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==z(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function U(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en-US",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Date(t).toLocaleDateString(e,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?H(Object(n),!0).forEach((function(e){R(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({year:"numeric",month:"long",day:"numeric"},n))}function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function V(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function W(t,e,n){return(e=$(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function J(){J=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(j([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Y(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(Y(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function K(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function Z(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){K(i,r,o,a,s,"next",t)}function s(t){K(i,r,o,a,s,"throw",t)}a(void 0)}))}}function X(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$(r.key),r)}}function $(t){var e=function(t){if("object"!=Y(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Y(e)?e:e+""}const Q=function(){return t=function t(e){var n=e.mapContainer,r=e.latitude,o=void 0===r?-6.2088:r,i=e.longitude,a=void 0===i?106.8456:i,s=e.isInteractive,c=void 0===s||s,u=e.defaultZoom,l=void 0===u?5:u;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._mapContainer=n,this._map=null,this._markers=[],this._latitude=o,this._longitude=a,this._selectedLocation=null,this._locationSelectedCallback=null,this._isInteractive=c,this._mapInitialized=!1,this._resizeObserver=null,this._defaultZoom=l,this._basemapLayers={},this._currentBasemap=null,this._worldBounds=null,this._clickEnabled=!0,this._addTransitionStyles()},e=[{key:"_addTransitionStyles",value:function(){if(!document.getElementById("storymap-transition-styles")){var t=document.createElement("style");t.id="storymap-transition-styles",t.textContent='\n      /* Animasi transisi untuk peta */\n      @keyframes map-fade-in {\n        from { opacity: 0; transform: scale(0.95); }\n        to { opacity: 1; transform: scale(1); }\n      }\n      \n      @keyframes map-slide-up {\n        from { transform: translateY(20px); opacity: 0; }\n        to { transform: translateY(0); opacity: 1; }\n      }\n      \n      /* Fallback animasi untuk browser tanpa View Transition API */\n      .leaflet-container {\n        animation: map-fade-in 0.5s ease-out;\n      }\n      \n      /* Style khusus untuk marker dengan efek muncul bertahap */\n      .leaflet-marker-icon {\n        transition: transform 0.3s ease-out, opacity 0.3s ease-out;\n        animation: map-slide-up 0.5s ease-out backwards;\n      }\n      \n      /* Animasi hover marker */\n      .leaflet-marker-icon:hover {\n        transform: translateY(-2px);\n      }\n      \n      /* Popup dengan animasi dan style yang lebih baik */\n      .leaflet-popup {\n        animation: map-slide-up 0.3s ease-out;\n      }\n      \n      .custom-popup .leaflet-popup-content-wrapper {\n        border-radius: 10px;\n        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);\n        overflow: hidden;\n      }\n      \n      .custom-popup .leaflet-popup-content {\n        margin: 0;\n        padding: 0;\n      }\n      \n      .map-popup {\n        padding: 15px;\n      }\n      \n      .map-popup h3 {\n        margin-top: 0;\n        margin-bottom: 10px;\n        color: #0084ff;\n        font-size: 16px;\n      }\n      \n      .map-popup img {\n        border-radius: 8px;\n        margin: 10px 0;\n        max-width: 100%;\n        transition: transform 0.3s ease;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n      }\n      \n      .map-popup img:hover {\n        transform: scale(1.03);\n      }\n      \n      .map-popup p {\n        margin: 8px 0;\n        font-size: 14px;\n        line-height: 1.4;\n      }\n      \n      .map-popup .location-name {\n        font-size: 12px;\n        color: #666;\n        display: flex;\n        align-items: center;\n        margin-top: 8px;\n      }\n      \n      .map-popup .location-name:before {\n        content: \'\';\n        display: inline-block;\n        width: 12px;\n        height: 12px;\n        background-image: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="%23666" d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg>\');\n        background-size: contain;\n        background-repeat: no-repeat;\n        margin-right: 5px;\n      }\n      \n      .map-popup .view-story-link {\n        display: inline-block;\n        padding: 8px 15px;\n        background-color: #0084ff;\n        color: white;\n        text-decoration: none;\n        border-radius: 4px;\n        margin-top: 10px;\n        font-weight: bold;\n        transition: background-color 0.3s, transform 0.2s;\n      }\n      \n      .map-popup .view-story-link:hover {\n        background-color: #006dce;\n        transform: translateY(-2px);\n      }\n      \n      /* View Transition API specific styles */\n      @supports (view-transition-name: none) {\n        /* Set view transition names for map components */\n        .leaflet-container {\n          view-transition-name: story-map;\n        }\n        \n        .leaflet-marker-icon {\n          view-transition-name: map-marker;\n        }\n        \n        .leaflet-popup {\n          view-transition-name: map-popup;\n        }\n        \n        /* View Transition animations for smooth page changes */\n        ::view-transition-old(story-map) {\n          animation: 0.5s ease-out fade-out both;\n        }\n        \n        ::view-transition-new(story-map) {\n          animation: 0.5s ease-out fade-in both;\n        }\n        \n        /* Custom transition animations */\n        @keyframes fade-out {\n          from { opacity: 1; }\n          to { opacity: 0; }\n        }\n        \n        @keyframes fade-in {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n      }\n      \n      /* Transisi tambahan untuk status hover pada marker */\n      .animated-marker {\n        transition: transform 0.3s ease;\n      }\n      \n      .animated-marker:hover {\n        transform: scale(1.1) translateY(-2px);\n      }\n      \n      /* Error state dengan transisi */\n      .map-error {\n        animation: map-fade-in 0.5s ease-out;\n        transition: all 0.3s ease;\n      }\n\n      /* Simple marker styles */\n      .simple-marker {\n        background-color: #dc3545;\n        border: 2px solid white;\n        border-radius: 50%;\n        width: 20px;\n        height: 20px;\n        box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n      }\n\n      .simple-marker:hover {\n        transform: scale(1.2);\n        background-color: #c82333;\n      }\n    ',document.head.appendChild(t)}}},{key:"init",value:(i=Z(J().mark((function t(){var e=this;return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this._mapContainer.style.height="500px",this._mapContainer.style.width="100%",this._mapContainer.style.overflow="hidden","startViewTransition"in document&&(this._mapContainer.style.viewTransitionName="story-map-container"),"undefined"!=typeof L){t.next=8;break}return t.next=8,this._loadLeaflet();case 8:return t.next=10,new Promise((function(t){return setTimeout(t,100)}));case 10:return this._worldBounds=[[-90,-180],[90,180]],this._map=L.map(this._mapContainer,{dragging:this._isInteractive,touchZoom:this._isInteractive,scrollWheelZoom:this._isInteractive,doubleClickZoom:this._isInteractive,boxZoom:this._isInteractive,tap:this._isInteractive,keyboard:this._isInteractive,zoomControl:this._isInteractive,attributionControl:!1,maxBoundsViscosity:1,maxBounds:this._worldBounds,minZoom:2,worldCopyJump:!0}).setView([this._latitude,this._longitude],this._defaultZoom),this._setupBasemapLayers(),L.control.attribution({position:"bottomright"}).addTo(this._map),this._isInteractive&&(L.control.zoom({position:"bottomright",zoomInTitle:"Zoom In",zoomOutTitle:"Zoom Out"}).addTo(this._map),L.control.layers(this._basemapLayers,null,{position:"topright",collapsed:!0}).addTo(this._map)),this._isInteractive&&this._map.on("click",(function(t){if(e._clickEnabled){var n=t.latlng,r=n.lat,o=n.lng;"startViewTransition"in document?document.startViewTransition((function(){e._handleMapClick(r,o)})):e._handleMapClick(r,o)}})),this._map.on("resize",(function(){e._preventEmptyTiles()})),this._map.on("moveend",(function(){e._preventEmptyTiles()})),this._map.on("zoomend",(function(){e._preventEmptyTiles()})),this._setupResizeObserver(),this._scheduleMapUpdate(),this._mapInitialized=!0,t.abrupt("return",!0);case 25:return t.prev=25,t.t0=t.catch(0),console.error("Error initializing map:",t.t0),this._showMapError(),t.abrupt("return",!1);case 30:case"end":return t.stop()}}),t,this,[[0,25]])}))),function(){return i.apply(this,arguments)})},{key:"_preventEmptyTiles",value:function(){if(this._map){var t=this._map.getBounds(),e=this._map.getZoom(),n=this._map.getCenter();if(e<2&&this._map.setZoom(2),!this._worldBounds[0][0]<=t.getSouth()&&!this._worldBounds[1][0]>=t.getNorth()&&!this._worldBounds[0][1]<=t.getWest()&&!this._worldBounds[1][1]>=t.getEast()){var r=n.lat,o=n.lng;n.lat>85&&(r=85),n.lat<-85&&(r=-85),o=(o+180)%360-180,r===n.lat&&o===n.lng||this._map.setView([r,o],e,{animate:!1})}}}},{key:"_setupBasemapLayers",value:function(){this._basemapLayers.OpenStreetMap=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',noWrap:!1,bounds:[[-90,-180],[90,180]]}).addTo(this._map),this._currentBasemap=this._basemapLayers.OpenStreetMap,this._basemapLayers["OSM Humanitarian"]=L.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Tiles style by <a href="https://www.hotosm.org/">HOT</a>',noWrap:!1,bounds:[[-90,-180],[90,180]]}),this._basemapLayers.Satellite=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",noWrap:!1,bounds:[[-90,-180],[90,180]]}),this._basemapLayers["Carto Voyager"]=L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",noWrap:!1,bounds:[[-90,-180],[90,180]]})}},{key:"_setupResizeObserver",value:function(){var t=this;"ResizeObserver"in window&&(this._resizeObserver=new ResizeObserver((function(e){var n,r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return q(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?q(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(e);try{for(r.s();!(n=r.n()).done;)n.value.target===t._mapContainer&&t._map&&("startViewTransition"in document?document.startViewTransition((function(){t._map.invalidateSize(),t._preventEmptyTiles()})):(t._map.invalidateSize(),t._preventEmptyTiles()))}catch(t){r.e(t)}finally{r.f()}})),this._resizeObserver.observe(this._mapContainer))}},{key:"_scheduleMapUpdate",value:function(){var t=this;[100,300,500,1e3,2e3].forEach((function(e){setTimeout((function(){t._map&&null!==t._mapContainer.offsetParent&&(t._map.invalidateSize({animate:!1,pan:!1}),t._preventEmptyTiles())}),e)})),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&t._map&&setTimeout((function(){t._map.invalidateSize(),t._preventEmptyTiles()}),300)}))}},{key:"_loadLeaflet",value:(o=Z(J().mark((function t(){return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){var n=document.createElement("link");n.rel="stylesheet",n.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(n);var r=document.createElement("script");r.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",r.onload=function(){console.log("Leaflet loaded successfully"),t()},r.onerror=function(){console.error("Failed to load Leaflet"),e(new Error("Failed to load Leaflet"))},document.head.appendChild(r)})));case 1:case"end":return t.stop()}}),t)}))),function(){return o.apply(this,arguments)})},{key:"_showMapError",value:function(){this._mapContainer.innerHTML='\n      <div class="map-error">\n        <p>Maaf, kami tidak dapat memuat peta. Silakan periksa koneksi internet Anda atau coba lagi nanti.</p>\n      </div>\n    ',this._mapContainer.style.height="200px",this._mapContainer.style.display="flex",this._mapContainer.style.alignItems="center",this._mapContainer.style.justifyContent="center",this._mapContainer.style.textAlign="center",this._mapContainer.style.background="#f0f0f0",this._mapContainer.style.border="1px solid #ddd",this._mapContainer.style.borderRadius="8px",this._mapContainer.style.padding="20px"}},{key:"_handleMapClick",value:function(t,e){this._selectedLocation={latitude:t,longitude:e},this._locationSelectedCallback&&this._locationSelectedCallback(this._selectedLocation)}},{key:"setLocationSelectedCallback",value:function(t){this._locationSelectedCallback=t}},{key:"enableMapClick",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._clickEnabled=t}},{key:"changeBasemap",value:function(t){var e=this;this._map&&this._basemapLayers[t]&&("startViewTransition"in document?document.startViewTransition((function(){e._currentBasemap&&e._map.removeLayer(e._currentBasemap),e._map.addLayer(e._basemapLayers[t]),e._currentBasemap=e._basemapLayers[t]})):(this._currentBasemap&&this._map.removeLayer(this._currentBasemap),this._map.addLayer(this._basemapLayers[t]),this._currentBasemap=this._basemapLayers[t]))}},{key:"_createSimpleIcon",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#dc3545";return L.divIcon({html:'<div style="\n        background-color: '.concat(t,';\n        border: 2px solid white;\n        border-radius: 50%;\n        width: 20px;\n        height: 20px;\n        box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n        position: relative;\n        transform: translate(-50%, -50%);\n      "></div>'),className:"simple-marker",iconSize:[20,20],iconAnchor:[10,10],popupAnchor:[0,-10]})}},{key:"addMarker",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!this._map)return null;var i=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?V(Object(n),!0).forEach((function(e){W(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({draggable:!1,icon:this._createSimpleIcon(o.color)},o);window.location.hash.includes("#/add")||(i.draggable=!1);var a=L.marker([t,e],i);return a.on("add",(function(){this._icon&&(this._icon.classList.add("animated-marker"),"startViewTransition"in document&&(this._icon.style.viewTransitionName="marker-".concat(t,"-").concat(e)))})),r&&(a.bindPopup(r,{maxWidth:300,minWidth:200,className:"custom-popup"}),o.openPopup&&setTimeout((function(){a.openPopup()}),300)),a.addTo(this._map),this._markers.push(a),i.draggable&&this._isInteractive&&a.on("dragend",(function(t){var e=t.target.getLatLng(),r=e.lat,o=e.lng;n._selectedLocation={latitude:r,longitude:o},n._locationSelectedCallback&&("startViewTransition"in document?document.startViewTransition((function(){n._locationSelectedCallback(n._selectedLocation)})):n._locationSelectedCallback(n._selectedLocation))})),a}},{key:"removeMarker",value:function(t){var e=this;if(this._map&&t)if("startViewTransition"in document)document.startViewTransition((function(){e._map.removeLayer(t);var n=e._markers.indexOf(t);-1!==n&&e._markers.splice(n,1)}));else{this._map.removeLayer(t);var n=this._markers.indexOf(t);-1!==n&&this._markers.splice(n,1)}}},{key:"_clearMarkers",value:function(){var t=this;"startViewTransition"in document&&this._markers.length>0?document.startViewTransition((function(){t._markers.forEach((function(e){t._map&&t._map.removeLayer(e)})),t._markers=[]})):(this._markers.forEach((function(e){t._map&&t._map.removeLayer(e)})),this._markers=[])}},{key:"removeAllMarkers",value:function(){this._clearMarkers()}},{key:"showStoryLocations",value:(r=Z(J().mark((function t(e){var n,r=this;return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=function(){if(r.removeAllMarkers(),r._map&&e&&0!==e.length){var t=e.filter((function(t){return t.lat&&t.lon}));if(0!==t.length){for(var n=[],o=function(e){var o=t[e],i=r.getAddressFromCoordinates(o.lat,o.lon).then((function(t){return o._address=t,t})).catch((function(t){return console.error("Error fetching address:",t),o._address="Lokasi tidak diketahui","Lokasi tidak diketahui"}));n.push(i);var a=o.location?o.location:"Memuat lokasi...",s='\n          <div class="map-popup">\n            <h3>'.concat(o.name,"</h3>\n            <p>").concat(o.description.substring(0,100)).concat(o.description.length>100?"...":"",'</p>\n            <img src="').concat(o.photoUrl,'" alt="').concat(o.name,'\'s story" width="150">\n            <p class="location-name location-').concat(o.id,'">').concat(a,'</p>\n            <p><a href="#/story/').concat(o.id,'" class="view-story-link">Lihat Detail</a></p>\n          </div>\n        ');setTimeout((function(){var t=["#dc3545","#0084ff","#28a745","#ffc107","#6f42c1"],n=t[e%t.length];r.addMarker(o.lat,o.lon,s,{openPopup:!1,color:n})}),50*e)},i=0;i<t.length;i++)o(i);Promise.all(n).then((function(){r._markers.forEach((function(e,n){if(n<t.length){var r=t[n],o=r.location||r._address||"Lokasi tidak diketahui",i=e.getPopup();if(i){var a=i.getElement();if(a){var s=a.querySelector(".location-".concat(r.id));s&&(s.textContent=o)}}var c='\n              <div class="map-popup">\n                <h3>'.concat(r.name,"</h3>\n                <p>").concat(r.description.substring(0,100)).concat(r.description.length>100?"...":"",'</p>\n                <img src="').concat(r.photoUrl,'" alt="').concat(r.name,'\'s story" width="150">\n                <p class="location-name">').concat(o,'</p>\n                <p><a href="#/story/').concat(r.id,'" class="view-story-link">Lihat Detail</a></p>\n              </div>\n            ');e.bindPopup(c,{maxWidth:300,minWidth:200,className:"custom-popup"})}})),r.enableMapClick(!1),setTimeout((function(){r._map&&r._markers.length>0&&("startViewTransition"in document?document.startViewTransition((function(){r._fitBoundsToMarkers(t)})):r._fitBoundsToMarkers(t))}),500)}))}}},"startViewTransition"in document?document.startViewTransition((function(){n()})):n();case 2:case"end":return t.stop()}}),t)}))),function(t){return r.apply(this,arguments)})},{key:"_fitBoundsToMarkers",value:function(t){if(1===this._markers.length){var e=this._markers[0].getLatLng();this._map.setView([e.lat,e.lng],10)}else{var n=L.latLngBounds();t.forEach((function(t){n.extend([t.lat,t.lon])})),this._map.fitBounds(n,{padding:[100,100],maxZoom:12,animate:!0})}this._map.invalidateSize(),this._preventEmptyTiles()}},{key:"getSelectedLocation",value:function(){return this._selectedLocation}},{key:"centerOn",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;this._map&&("startViewTransition"in document?document.startViewTransition((function(){n._map.setView([t,e],r),setTimeout((function(){n._map&&(n._map.invalidateSize(),n._preventEmptyTiles())}),300)})):(this._map.setView([t,e],r),setTimeout((function(){n._map&&(n._map.invalidateSize(),n._preventEmptyTiles())}),300)))}},{key:"fixMapBlanks",value:function(){var t=this;this._map&&("startViewTransition"in document?document.startViewTransition((function(){[100,300,500,1e3].forEach((function(e){setTimeout((function(){t._map&&(t._map.invalidateSize({animate:!1,pan:!1}),t._preventEmptyTiles())}),e)}))})):[100,300,500,1e3].forEach((function(e){setTimeout((function(){t._map&&(t._map.invalidateSize({animate:!1,pan:!1}),t._preventEmptyTiles())}),e)})))}},{key:"zoomOut",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;this._map&&("startViewTransition"in document?document.startViewTransition((function(){t._handleZoomOut(e)})):this._handleZoomOut(e))}},{key:"_handleZoomOut",value:function(t){var e=this;if(this._markers.length>0){var n=L.latLngBounds();this._markers.forEach((function(t){n.extend(t.getLatLng())})),this._map.fitBounds(n,{padding:[150,150],maxZoom:t,animate:!0})}else this._map.setView([this._latitude,this._longitude],t);setTimeout((function(){e._map.invalidateSize(),e._preventEmptyTiles()}),300)}},{key:"getAddressFromCoordinates",value:(n=Z(J().mark((function t(e,n){var r,o,i,a;return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(e,"&lon=").concat(n,"&zoom=18&addressdetails=1&accept-language=id"));case 3:if((r=t.sent).ok){t.next=6;break}throw new Error("Gagal mendapatkan informasi lokasi");case 6:return t.next=8,r.json();case 8:return o=t.sent,i=o.display_name||"Lokasi tidak diketahui",o.address&&(a=[],o.address.road&&a.push(o.address.road),o.address.suburb&&a.push(o.address.suburb),(o.address.city||o.address.town||o.address.village)&&a.push(o.address.city||o.address.town||o.address.village),o.address.state&&a.push(o.address.state),o.address.country&&a.push(o.address.country),a.length>0&&(i=a.join(", "))),console.log("Address for ".concat(e,", ").concat(n,": ").concat(i)),t.abrupt("return",i);case 15:return t.prev=15,t.t0=t.catch(0),console.error("Error getting address:",t.t0),t.abrupt("return","Lokasi tidak diketahui");case 19:case"end":return t.stop()}}),t,null,[[0,15]])}))),function(t,e){return n.apply(this,arguments)})},{key:"destroy",value:function(){this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),this._map&&(this._map.remove(),this._map=null),this._markers=[],this._mapInitialized=!1,this._basemapLayers={},this._currentBasemap=null,this._worldBounds=null}},{key:"prepareForTransition",value:function(){if(this._map){var t=this._map.getContainer();if(t&&t.classList.add("map-exit-transition"),"startViewTransition"in document){var e=document.querySelector(".leaflet-container");e&&(e.style.viewTransitionName="story-map-exit")}}}}],e&&X(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o,i}();function tt(t){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tt(t)}function et(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function nt(){nt=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(j([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==tt(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(tt(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function rt(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function ot(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){rt(i,r,o,a,s,"next",t)}function s(t){rt(i,r,o,a,s,"throw",t)}a(void 0)}))}}function it(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,at(r.key),r)}}function at(t){var e=function(t){if("object"!=tt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=tt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==tt(e)?e:e+""}const st=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subscription=null,this.isSubscribed=!1,this.swRegistration=null},e=[{key:"init",value:(c=ot(nt().mark((function t(){return nt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("serviceWorker"in navigator){t.next=3;break}return console.warn("Service Worker not supported"),t.abrupt("return",!1);case 3:if("PushManager"in window){t.next=6;break}return console.warn("Push messaging not supported"),t.abrupt("return",!1);case 6:if(t.prev=6,navigator.serviceWorker.controller){t.next=11;break}return t.next=10,new Promise((function(t){navigator.serviceWorker.addEventListener("controllerchange",(function(){return t()})),navigator.serviceWorker.register("/service-worker.js").catch((function(t){console.error("Service worker registration failed:",t)}))}));case 10:console.log("[NotificationHelper] Service worker controller is ready");case 11:return t.next=13,navigator.serviceWorker.ready;case 13:return this.swRegistration=t.sent,console.log("[NotificationHelper] Service worker is ready"),t.next=17,this.swRegistration.pushManager.getSubscription();case 17:return this.subscription=t.sent,this.isSubscribed=!(null===this.subscription),console.log("[NotificationHelper] Initialized - isSubscribed:",this.isSubscribed),this.updateUI(),this._setupNavigationListener(),t.abrupt("return",!0);case 25:return t.prev=25,t.t0=t.catch(6),console.error("Error initializing notifications:",t.t0),t.abrupt("return",!1);case 29:case"end":return t.stop()}}),t,this,[[6,25]])}))),function(){return c.apply(this,arguments)})},{key:"_setupNavigationListener",value:function(){navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",(function(t){if(console.log("[NotificationHelper] Message from service worker:",t.data),t.data&&"NAVIGATE"===t.data.type){var e=t.data.hash,n=t.data.storyId;console.log("[NotificationHelper] Navigation request - hash:",e,"storyId:",n),e&&(console.log("[NotificationHelper] Navigating to:",e),window.location.hash=e,window.appInstance&&window.appInstance.renderPage&&setTimeout((function(){window.appInstance.renderPage()}),100))}}))}},{key:"subscribeUser",value:(s=ot(nt().mark((function t(){var e,n,r,o;return nt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("[NotificationHelper] Starting subscription process"),this.swRegistration){t.next=5;break}return console.error("Service Worker not ready"),alert("Service Worker belum siap. Silakan refresh halaman."),t.abrupt("return",!1);case 5:return t.prev=5,t.next=8,this.requestNotificationPermission();case 8:if("granted"===t.sent){t.next=13;break}return console.warn("Notification permission denied"),alert("Permission untuk notifikasi diperlukan untuk fitur ini"),t.abrupt("return",!1);case 13:return console.log("[NotificationHelper] Permission granted, subscribing..."),e=this.urlB64ToUint8Array(h.A.WEB_PUSH_VAPID_PUBLIC_KEY),console.log("[NotificationHelper] Using application server key:",h.A.WEB_PUSH_VAPID_PUBLIC_KEY),t.next=18,this.swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e});case 18:if(this.subscription=t.sent,console.log("[NotificationHelper] Push subscription created:",JSON.stringify({endpoint:this.subscription.endpoint,keys:{p256dh:this.arrayBufferToBase64(this.subscription.getKey("p256dh")),auth:this.arrayBufferToBase64(this.subscription.getKey("auth"))}},null,2)),!(n=this.getAuthData())||!n.token){t.next=43;break}return console.log("[NotificationHelper] Sending subscription to server..."),r={endpoint:this.subscription.endpoint,keys:{p256dh:this.arrayBufferToBase64(this.subscription.getKey("p256dh")),auth:this.arrayBufferToBase64(this.subscription.getKey("auth"))}},console.log("[NotificationHelper] Subscription data being sent:",JSON.stringify(r,null,2)),t.next=27,(0,f.subscribeNotification)({endpoint:this.subscription.endpoint,keys:{p256dh:this.arrayBufferToBase64(this.subscription.getKey("p256dh")),auth:this.arrayBufferToBase64(this.subscription.getKey("auth"))},token:n.token});case 27:if(o=t.sent,console.log("[NotificationHelper] Server response:",o),!o.error){t.next=38;break}return console.error("Failed to subscribe on server:",o.message),t.next=33,this.subscription.unsubscribe();case 33:return this.subscription=null,this.isSubscribed=!1,alert("Gagal mendaftar notifikasi di server. Silakan coba lagi."),this.updateUI(),t.abrupt("return",!1);case 38:this.isSubscribed=!0,console.log("Successfully subscribed to notifications"),alert("Berhasil mendaftar notifikasi! Anda akan mendapat pemberitahuan untuk story baru."),t.next=46;break;case 43:return console.error("[NotificationHelper] No auth token available"),alert("Tidak ada token autentikasi. Silakan login ulang."),t.abrupt("return",!1);case 46:return this.updateUI(),t.abrupt("return",!0);case 50:return t.prev=50,t.t0=t.catch(5),console.error("Failed to subscribe user:",t.t0),this.isSubscribed=!1,this.subscription=null,this.updateUI(),alert("Gagal mendaftar notifikasi. Pastikan browser mendukung notifikasi."),t.abrupt("return",!1);case 58:case"end":return t.stop()}}),t,this,[[5,50]])}))),function(){return s.apply(this,arguments)})},{key:"unsubscribeUser",value:(a=ot(nt().mark((function t(){var e,n;return nt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("[NotificationHelper] Starting unsubscribe process"),this.subscription){t.next=4;break}return console.log("No subscription to unsubscribe"),t.abrupt("return",!0);case 4:if(t.prev=4,!(e=this.getAuthData())||!e.token){t.next=13;break}return console.log("[NotificationHelper] Unsubscribing from server..."),t.next=10,(0,f.unsubscribeNotification)({endpoint:this.subscription.endpoint,token:e.token});case 10:n=t.sent,console.log("[NotificationHelper] Unsubscribe server response:",n),n.error&&console.warn("Failed to unsubscribe on server, but proceeding with local unsubscribe");case 13:return t.next=15,this.subscription.unsubscribe();case 15:return this.subscription=null,this.isSubscribed=!1,console.log("Successfully unsubscribed from notifications"),alert("Berhasil berhenti berlangganan notifikasi."),this.updateUI(),t.abrupt("return",!0);case 23:return t.prev=23,t.t0=t.catch(4),console.error("Error unsubscribing:",t.t0),this.subscription=null,this.isSubscribed=!1,this.updateUI(),alert("Gagal berhenti berlangganan. Coba lagi nanti."),t.abrupt("return",!1);case 31:case"end":return t.stop()}}),t,this,[[4,23]])}))),function(){return a.apply(this,arguments)})},{key:"requestNotificationPermission",value:(i=ot(nt().mark((function t(){var e;return nt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("Notification"in window){t.next=3;break}return console.warn("[NotificationHelper] Notifications not supported"),t.abrupt("return","denied");case 3:if("granted"!==Notification.permission){t.next=6;break}return console.log("[NotificationHelper] Notification permission already granted"),t.abrupt("return","granted");case 6:if("denied"!==Notification.permission){t.next=9;break}return console.log("[NotificationHelper] Notification permission denied"),t.abrupt("return","denied");case 9:return console.log("[NotificationHelper] Requesting notification permission..."),t.next=12,Notification.requestPermission();case 12:return e=t.sent,console.log("[NotificationHelper] Permission result:",e),t.abrupt("return",e);case 15:case"end":return t.stop()}}),t)}))),function(){return i.apply(this,arguments)})},{key:"updateUI",value:function(){var t=document.getElementById("subscribe-notification-btn"),e=document.getElementById("subscribe-nav-item");if(console.log("[NotificationHelper] Updating UI - button:",!!t,"navItem:",!!e),t&&e){var n=this.getAuthData(),r=this.isPushSupported()&&n;console.log("[NotificationHelper] Should show notification button:",r,"isSubscribed:",this.isSubscribed),r?(e.style.display="block",this.isSubscribed?(t.innerHTML='<i class="fas fa-bell-slash"></i> Unsubscribe',t.title="Unsubscribe dari notifikasi"):(t.innerHTML='<i class="fas fa-bell"></i> Subscribe',t.title="Subscribe untuk notifikasi story baru")):e.style.display="none"}else console.warn("[NotificationHelper] Subscribe button or nav item not found")}},{key:"isPushSupported",value:function(){var t="serviceWorker"in navigator&&"PushManager"in window;return console.log("[NotificationHelper] Push supported:",t),t}},{key:"urlB64ToUint8Array",value:function(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(e),r=new Uint8Array(n.length),o=0;o<n.length;++o)r[o]=n.charCodeAt(o);return r}},{key:"arrayBufferToBase64",value:function(t){var e,n="",r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return et(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?et(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}(new Uint8Array(t));try{for(r.s();!(e=r.n()).done;){var o=e.value;n+=String.fromCharCode(o)}}catch(t){r.e(t)}finally{r.f()}return window.btoa(n)}},{key:"getAuthData",value:function(){var t=localStorage.getItem(h.A.AUTH_KEY),e=t?JSON.parse(t):null;return console.log("[NotificationHelper] Auth data available:",!!e),e}},{key:"toggleSubscription",value:(o=ot(nt().mark((function t(){return nt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("[NotificationHelper] Toggle subscription - current state:",this.isSubscribed),!this.isSubscribed){t.next=6;break}return t.next=4,this.unsubscribeUser();case 4:t.next=8;break;case 6:return t.next=8,this.subscribeUser();case 8:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"handleNewStory",value:(r=ot(nt().mark((function t(e){return nt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("[NotificationHelper] Handling new story:",e),this.isSubscribed&&this.swRegistration){t.next=4;break}return console.log("[NotificationHelper] Not subscribed or no service worker, skipping notification"),t.abrupt("return");case 4:return t.prev=4,t.next=7,this.sendTestNotification(e);case 7:t.next=12;break;case 9:t.prev=9,t.t0=t.catch(4),console.error("[NotificationHelper] Error handling new story:",t.t0);case 12:case"end":return t.stop()}}),t,this,[[4,9]])}))),function(t){return r.apply(this,arguments)})},{key:"sendTestNotification",value:(n=ot(nt().mark((function t(e){var n,r,o,i;return nt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("[NotificationHelper] === DETAILED STORY DEBUG ==="),console.log("[NotificationHelper] Raw story object:",e),console.log("[NotificationHelper] Story keys:",Object.keys(e)),console.log("[NotificationHelper] Story.id:",e.id),console.log("[NotificationHelper] Story.id type:",tt(e.id)),console.log("[NotificationHelper] Story.id stringified:",JSON.stringify(e.id)),this.swRegistration){t.next=9;break}return console.error("[NotificationHelper] Service Worker not available"),t.abrupt("return");case 9:if(e.id){t.next=13;break}return console.error("[NotificationHelper] Story ID is missing or undefined"),console.log("[NotificationHelper] Available story properties:",Object.keys(e)),t.abrupt("return");case 13:if(t.prev=13,n="Story Baru!",r=e.description||"Ada story baru yang ditambahkan",e.description&&e.description.length>100&&(r=e.description.substring(0,100)+"..."),e.name&&(r="".concat(e.name,": ").concat(r)),o=e.id?String(e.id):null,console.log("[NotificationHelper] Final storyId string:",o),o){t.next=23;break}return console.error("[NotificationHelper] Cannot convert story ID to string"),t.abrupt("return");case 23:i={title:n,body:r,description:e.description,author:e.name,storyId:o,photoUrl:e.photoUrl},console.log("[NotificationHelper] Complete notification data:",JSON.stringify(i,null,2)),this.swRegistration.active?(console.log("[NotificationHelper] Sending message to active service worker"),this.swRegistration.active.postMessage({type:"SIMULATE_PUSH",data:i}),console.log("[NotificationHelper] Message sent to service worker successfully")):(console.error("[NotificationHelper] No active service worker found"),console.log("[NotificationHelper] Service worker state:",this.swRegistration.installing?"installing":this.swRegistration.waiting?"waiting":"none")),t.next=31;break;case 28:t.prev=28,t.t0=t.catch(13),console.error("[NotificationHelper] Error sending test notification:",t.t0);case 31:case"end":return t.stop()}}),t,this,[[13,28]])}))),function(t){return n.apply(this,arguments)})}],e&&it(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o,i,a,s,c}());function ct(t){return function(t){if(Array.isArray(t))return lt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||ut(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ut(t,e){if(t){if("string"==typeof t)return lt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lt(t,e):void 0}}function lt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function pt(){pt=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(j([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==ft(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(ft(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function ft(t){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ft(t)}function ht(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function dt(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){ht(i,r,o,a,s,"next",t)}function s(t){ht(i,r,o,a,s,"throw",t)}a(void 0)}))}}function mt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,yt(r.key),r)}}function yt(t){var e=function(t){if("object"!=ft(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ft(e)?e:e+""}const vt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._map=null,this._storiesContainer=null,this._isLoadingMore=!1,this._observer=null,this._model={stories:[],isLoggedIn:m.isUserSignedIn()},this._storyIds=new Set,this._currentPage=1,this._isLoading=!1,this._lastStoriesCount=0,this._lastStoryCheck=null,this._handleHashChange=this._handleHashChange.bind(this),this.handleLoadMoreClick=this.handleLoadMoreClick.bind(this),this._checkForNewStories=this._checkForNewStories.bind(this)},e=[{key:"init",value:function(){return this._setupEventListeners(),this._loadStories(),this._startNewStoryCheck(),this}},{key:"_startNewStoryCheck",value:function(){this._newStoryInterval&&clearInterval(this._newStoryInterval),this._newStoryInterval=setInterval(this._checkForNewStories,1e4)}},{key:"_checkForNewStories",value:(s=dt(pt().mark((function t(){var e,n,r,o,i,a;return pt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._model.isLoggedIn&&m.isUserSignedIn()){t.next=2;break}return t.abrupt("return");case 2:if(st.isSubscribed){t.next=4;break}return t.abrupt("return");case 4:if(t.prev=4,n=null===(e=m.getAuth())||void 0===e?void 0:e.token){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,(0,f.getAllStories)({page:1,size:1,location:1,token:n});case 10:if(!(!(r=t.sent).error&&r.listStory&&r.listStory.length>0)){t.next=28;break}if(o=r.listStory[0],this._lastStoryCheck){t.next=16;break}return this._lastStoryCheck=o.createdAt,t.abrupt("return");case 16:if(i=new Date(o.createdAt).getTime(),a=new Date(this._lastStoryCheck).getTime(),!(i>a)||this._storyIds.has(o.id)){t.next=28;break}return console.log("[HomePage] ===== NEW STORY DETECTED ====="),console.log("[HomePage] New story object:",o),console.log("[HomePage] Story ID:",o.id),console.log("[HomePage] Story ID type:",ft(o.id)),console.log("[HomePage] All story keys:",Object.keys(o)),console.log("[HomePage] ===== END DEBUG ====="),this._lastStoryCheck=o.createdAt,t.next=28,st.handleNewStory(o);case 28:t.next=33;break;case 30:t.prev=30,t.t0=t.catch(4),console.error("[HomePage] Error checking for new stories:",t.t0);case 33:case"end":return t.stop()}}),t,this,[[4,30]])}))),function(){return s.apply(this,arguments)})},{key:"render",value:(a=dt(pt().mark((function t(){var e;return pt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._applyStyles(),e=this.getIsLoggedIn(),t.abrupt("return",'\n      <section class="container home-page" style="view-transition-name: page">\n        <h1 class="visually-hidden">Story App Home Page</h1>\n        \n        <div class="page-wrapper">\n          <div class="header-actions" style="view-transition-name: header-actions">\n            '.concat(e?'\n              <a href="#/add" class="btn btn-primary add-story-btn" aria-label="Add new story" data-transition="true">\n                <i class="fas fa-plus"></i> Add Story\n              </a>\n            ':'\n              <a href="#/login" class="btn btn-primary add-story-btn" aria-label="Login to add stories" data-transition="true">\n                <i class="fas fa-sign-in-alt"></i> Login\n              </a>\n            ','\n          </div>\n          \n          <div class="view-container">\n            <div id="map-container" class="map-container" style="view-transition-name: map-container">\n              <div id="stories-map" class="stories-map"></div>\n            </div>\n            \n            <div id="list-view" class="stories-list" style="view-transition-name: list-view">\n              <div class="story-items" id="stories-container">\n                <div class="loading-indicator">Loading stories...</div>\n              </div>\n              <div class="pagination" id="pagination" style="view-transition-name: pagination">\n                <button id="load-more" class="btn btn-secondary">Load More</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n    '));case 3:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"_applyStyles",value:function(){var t=document.createElement("style");t.textContent='\n      .header-actions {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 1rem;\n        flex-wrap: wrap;\n        gap: 0.5rem;\n      }\n\n      .add-story-btn {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        height: 38px;\n      }\n\n      .map-container {\n        width: 100%;\n        margin-bottom: 30px;\n        border-radius: 12px;\n        overflow: hidden;\n        box-shadow: 0 3px 8px rgba(0,0,0,0.1);\n      }\n\n      .stories-map {\n        width: 100%;\n        height: 300px;\n        position: relative;\n      }\n\n      @media screen and (min-width: 768px) {\n        .stories-map {\n          height: 400px;\n        }\n      }\n\n      @media screen and (min-width: 1200px) {\n        .stories-map {\n          height: 450px;\n        }\n      }\n\n      .story-link-container {\n        display: block;\n        width: 100%;\n        height: 100%;\n        position: relative;\n        overflow: hidden;\n      }\n\n      .story-link-container:hover img {\n        transform: scale(1.05);\n      }\n\n      .story-link {\n        text-decoration: none;\n        color: #333;\n        transition: color 0.3s ease;\n      }\n\n      .story-link:hover {\n        color: #0084ff;\n      }\n\n      @media screen and (max-width: 576px) {\n        .header-actions {\n          display: flex;\n          flex-direction: row; \n          justify-content: space-between; \n          align-items: center;\n          width: 100%;\n        }\n        \n        .add-story-btn {\n          flex: 0 1 auto; \n          min-width: 110px; \n          height: 38px;\n        }\n      }\n\n      @media screen and (max-width: 414px) {\n        .header-actions {\n          gap: 8px; \n        }\n        \n        .add-story-btn {\n          font-size: 14px; \n          padding: 0.375rem 0.75rem; \n        }\n        \n        .story-items {\n          grid-template-columns: 1fr; \n        }\n      }\n\n      @media screen and (min-width: 415px) and (max-width: 768px) {\n        .story-items {\n          grid-template-columns: repeat(2, 1fr); \n        }\n      }\n\n      .story-items {\n        min-height: 200px;\n        position: relative;\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n        gap: 20px;\n        align-items: start;\n        width: 100%; \n        margin: 0 auto; \n        padding: 10px 5px; \n        overflow-y: visible; \n        overflow-x: clip; \n        z-index: 1; \n        margin-top: 10px;\n        margin-bottom: 20px;\n        contain: layout paint; \n      }\n\n      .story-card {\n        position: relative;\n        border-radius: 8px;\n        overflow: hidden;\n        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);\n        margin-bottom: 10px;\n        transition: transform 0.25s ease-out, box-shadow 0.25s ease-out;\n        transform: translate3d(0, 0, 0); \n        height: 100%;\n        contain: content; \n        will-change: transform; \n      }\n\n      .story-card:hover {\n        transform: translate3d(0, -5px, 0);\n        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.12);\n      }\n\n      .story-item,\n      .story-card {\n        background-color: #fff;\n        border-radius: 12px;\n        box-shadow: 0 3px 8px rgba(0,0,0,0.1);\n        overflow: hidden;\n        transition: transform 0.25s ease-out, box-shadow 0.25s ease-out;\n        cursor: pointer;\n        opacity: 1;\n        height: 100%;\n        display: flex;\n        flex-direction: column;\n        backface-visibility: hidden;\n        transform: translate3d(0, 0, 0);\n        contain: content; \n        position: relative;\n        z-index: 1;\n      }\n\n      .story-item:hover,\n      .story-card:hover {\n        transform: translate3d(0, -8px, 0);\n        box-shadow: 0 12px 20px rgba(0,0,0,0.12);\n        z-index: 5;\n      }\n\n      .story-image {\n        width: 100%;\n        height: 200px;\n        overflow: hidden;\n        background-color: #f2f2f2;\n        position: relative;\n        contain: strict; \n      }\n\n      .story-image::before {\n        content: "";\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: linear-gradient(rgba(0,0,0,0.05), rgba(0,0,0,0.1));\n        z-index: 1;\n        pointer-events: none;\n      }\n\n      .story-image img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n        transition: transform 0.4s ease-out;\n        transform: translate3d(0, 0, 0);\n        will-change: transform;\n      }\n\n      .story-item:hover .story-image img,\n      .story-card:hover .story-image img {\n        transform: scale(1.05) translate3d(0, 0, 0);\n      }\n\n      .story-image img.loading {\n        opacity: 0;\n      }\n\n      .story-image img.loaded {\n        opacity: 1;\n        transition: opacity 0.4s ease-out;\n      }\n\n      .story-content {\n        padding: 15px;\n        flex: 1;\n        display: flex;\n        flex-direction: column;\n      }\n\n      .story-content h2 {\n        margin: 0 0 8px;\n        font-size: 1.2rem;\n      }\n\n      .story-content h2 a {\n        color: #333;\n        text-decoration: none;\n        transition: color 0.25s ease;\n      }\n\n      .story-content h2 a:hover {\n        color: #0084ff;\n      }\n\n      .story-date {\n        font-size: 0.85rem;\n        color: #666;\n        margin: 0 0 10px;\n      }\n\n      .story-description {\n        margin: 0 0 10px;\n        font-size: 0.95rem;\n        color: #444;\n        line-height: 1.5;\n      }\n\n      .story-location {\n        display: flex;\n        align-items: center;\n        font-size: 0.85rem;\n        color: #666;\n      }\n\n      .story-location i {\n        color: #0084ff;\n        margin-right: 5px;\n      }\n\n      .loading-indicator {\n        text-align: center;\n        padding: 20px;\n        color: #666;\n        animation: pulse 1.5s infinite ease-out;\n        contain: strict; \n      }\n\n      @keyframes pulse {\n        0% { opacity: 0.6; }\n        50% { opacity: 1; }\n        100% { opacity: 0.6; }\n      }\n\n      .empty-state {\n        text-align: center;\n        padding: 40px 20px;\n        background-color: #f9f9f9;\n        border-radius: 10px;\n        margin: 20px 0;\n        transform: translate3d(0, 0, 0);\n        transition: all 0.3s ease-out;\n      }\n\n      .error-state {\n        text-align: center;\n        padding: 40px 20px;\n        background-color: #fff8f8;\n        border-radius: 10px;\n        margin: 20px 0;\n        border-left: 4px solid #d9534f;\n        transform: translate3d(0, 0, 0);\n        transition: all 0.3s ease-out;\n      }\n\n      .page-wrapper {\n        width: 100%;\n        max-width: 1200px;\n        margin: 0 auto;\n        padding: 15px;\n        position: relative;\n        isolation: isolate;\n        overflow: visible;\n      }\n\n      .container.home-page {\n        padding: 0;\n        max-width: 100%;\n        width: 100%;\n        transform: translate3d(0, 0, 0);\n        overflow: visible;\n      }\n\n      .view-container {\n        width: 100%;\n        max-width: 100%;\n        margin: 0 auto;\n        padding-bottom: 30px;\n        min-height: auto;\n        position: relative;\n        overflow-x: visible;\n        transform: translate3d(0, 0, 0);\n        padding-top: 10px;\n        contain: layout paint; \n      }\n\n      .story-item.fade-in,\n      .story-card.fade-in {\n        animation: fadeIn 0.5s ease-out forwards;\n        contain: layout paint; \n      }\n\n      @keyframes fadeIn {\n        from { \n          opacity: 0; \n          transform: translate3d(0, 15px, 0); \n        }\n        to { \n          opacity: 1; \n          transform: translate3d(0, 0, 0); \n        }\n      }\n\n      .stories-list {\n        padding: 20px 0;\n        width: 100%;\n        box-sizing: border-box;\n        transform: translate3d(0, 0, 0);\n        margin-top: 15px;\n        margin-bottom: 15px;\n        position: relative;\n        z-index: 1;\n        min-height: 200px;\n        contain: content; \n      }\n\n      .location-indicator {\n        display: flex;\n        align-items: center;\n        gap: 5px;\n        color: #666;\n        margin-top: 8px;\n        font-size: 0.9em;\n      }\n\n      .error-message {\n        color: #d93025;\n        padding: 8px 0;\n        font-size: 0.9em;\n        display: none;\n      }\n\n      .pagination {\n        display: flex;\n        justify-content: center;\n        margin-top: 20px;\n        margin-bottom: 20px;\n        position: relative;\n        z-index: 2;\n      }\n\n      .btn-loading {\n        position: relative;\n        color: transparent !important;\n      }\n\n      .btn-loading::after {\n        content: "";\n        position: absolute;\n        width: 16px;\n        height: 16px;\n        top: calc(50% - 8px);\n        left: calc(50% - 8px);\n        border: 2px solid rgba(255, 255, 255, 0.5);\n        border-radius: 50%;\n        border-top-color: white;\n        animation: spin 0.8s linear infinite;\n        will-change: transform;\n      }\n\n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n\n      ::view-transition-old(root),\n      ::view-transition-new(root) {\n        animation-duration: 0.5s;\n        animation-timing-function: ease-out;\n        contain: layout paint; \n      }\n\n      ::view-transition-old(page) {\n        animation: 300ms ease-out both fade-out;\n        contain: layout paint; \n      }\n\n      ::view-transition-new(page) {\n        animation: 350ms ease-out 50ms both fade-in;\n        contain: layout paint; \n      }\n\n      ::view-transition-old(story-*) {\n        animation: 300ms ease-out both slide-out;\n        contain: layout paint; \n      }\n\n      ::view-transition-new(story-*) {\n        animation: 350ms ease-out 50ms both slide-in;\n        contain: layout paint; \n      }\n\n      @keyframes fade-out {\n        from { opacity: 1; transform: translate3d(0, 0, 0); }\n        to { opacity: 0; transform: translate3d(0, 0, 0); }\n      }\n\n      @keyframes fade-in {\n        from { opacity: 0; transform: translate3d(0, 0, 0); }\n        to { opacity: 1; transform: translate3d(0, 0, 0); }\n      }\n\n      @keyframes slide-out {\n        from { opacity: 1; transform: translate3d(0, 0, 0); }\n        to { opacity: 0; transform: translate3d(0, 20px, 0); }\n      }\n\n      @keyframes slide-in {\n        from { opacity: 0; transform: translate3d(0, 20px, 0); }\n        to { opacity: 1; transform: translate3d(0, 0, 0); }\n      }\n\n      .new-story-badge {\n        position: fixed;\n        top: 80px;\n        right: 20px;\n        background-color: #0084ff;\n        color: white;\n        padding: 10px 15px;\n        border-radius: 25px;\n        font-size: 14px;\n        box-shadow: 0 4px 12px rgba(0, 132, 255, 0.3);\n        z-index: 1000;\n        cursor: pointer;\n        animation: slideInFromRight 0.3s ease-out;\n      }\n\n      @keyframes slideInFromRight {\n        from {\n          transform: translateX(100%);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(0);\n          opacity: 1;\n        }\n      }\n\n      .new-story-badge:hover {\n        background-color: #0056b3;\n        transform: scale(1.05);\n        transition: all 0.2s ease;\n      }\n    ',document.getElementById("home-page-custom-style")||(t.id="home-page-custom-style",document.head.appendChild(t))}},{key:"afterRender",value:(i=dt(pt().mark((function t(){return pt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("[HomePage] afterRender called"),this._initializeElements(),this._ensureMapRenders();case 3:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"_initializeElements",value:function(){var t=this;this._waitForElementsToRender().then((function(){t._storiesContainer=document.getElementById("stories-container"),t._setupLoadMore(),t._initMap(),t._setupLazyLoading(),t._setupTransitions();var e=t.getStories();e&&e.length>0&&(console.log("[HomePage] Showing ".concat(e.length," story locations after initialization")),setTimeout((function(){t._map&&t._map.showStoryLocations(e)}),50))}))}},{key:"_waitForElementsToRender",value:function(){return new Promise((function(t){requestAnimationFrame((function(){var e=function(){var n=document.getElementById("stories-container"),r=document.getElementById("load-more"),o=document.getElementById("stories-map");n&&r&&o?(console.log("[HomePage] All required DOM elements found"),t()):(console.log("[HomePage] Waiting for DOM elements..."),setTimeout(e,50))};e()}))}))}},{key:"_setupEventListeners",value:function(){window.removeEventListener("hashchange",this._handleHashChange),window.addEventListener("hashchange",this._handleHashChange)}},{key:"_handleHashChange",value:function(t){var e=window.location.hash,n=new URL(t.oldURL).hash;"#/home"!==e&&"#/"!==e||"#/home"===n||"#/"===n||(this._reset(),this._loadStories())}},{key:"_setupTransitions",value:function(){console.log("[HomePage] Setting up transitions (simplified version)"),document.querySelectorAll('[data-transition="true"]').forEach((function(t){t.getAttribute("href").startsWith("#/story/")||t.addEventListener("click",(function(e){if(document.startViewTransition){e.preventDefault();var n=t.getAttribute("href");document.startViewTransition((function(){window.location.hash=n}))}}))})),document.querySelectorAll(".story-item").forEach((function(t){t.style.cursor="pointer",t.querySelectorAll(".story-link-container").forEach((function(t){t.style.display="block",t.style.height="100%"}))}))}},{key:"_setupLazyLoading",value:function(){var t=this;this._observer=new IntersectionObserver((function(e){e.forEach((function(e){if(e.isIntersecting){var n=e.target.querySelector("img");n&&n.dataset.src&&(t._loadImage(n,n.dataset.src),t._observer.unobserve(e.target))}}))}),{root:null,rootMargin:"0px",threshold:.1}),this._applyLazyLoadingToItems()}},{key:"_applyLazyLoadingToItems",value:function(){var t=this;this._observer&&document.querySelectorAll(".story-item").forEach((function(e){t._observer.observe(e)}))}},{key:"_loadImage",value:function(t,e){var n=this;t.classList.add("loading");var r=new Image;r.onload=function(){t.src=e,t.classList.remove("loading"),t.classList.add("loaded"),n._recalculateContainerSize()},r.onerror=function(){t.src="/path/to/placeholder-image.jpg",t.classList.remove("loading"),t.classList.add("loaded")},r.src=e}},{key:"_initMap",value:function(){var t=this,e=document.getElementById("stories-map");e?(this._map=new Q({mapContainer:e}),this._map.init().then((function(){console.log("[HomePage] Map initialized successfully");var e=t.getStories();e&&e.length>0?(console.log("[HomePage] Showing ".concat(e.length," story locations after map init")),t._map.showStoryLocations(e)):console.log("[HomePage] No stories available yet to show on map")})).catch((function(t){console.error("[HomePage] Error initializing map:",t)}))):console.error("[HomePage] Map container not found")}},{key:"_ensureMapRenders",value:function(){}},{key:"_recalculateContainerSize",value:function(){if(this._storiesContainer){this._storiesContainer.offsetHeight;var t=document.querySelector(".view-container");if(t){var e=this._storiesContainer.scrollHeight,n=Math.max(500,e+150);t.style.minHeight="".concat(n,"px")}this._storiesContainer.style.width="100%"}}},{key:"_reset",value:function(){this._model.stories=[],this._storyIds.clear(),this._currentPage=1,this._isLoading=!1,this._lastStoriesCount=0,this._lastStoryCheck=null}},{key:"_loadStories",value:(o=dt(pt().mark((function t(){var e,n,r,o;return pt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this._isLoading){t.next=3;break}return t.abrupt("return");case 3:return this._isLoading=!0,this.updateLoadingState(!0),e=this._model.isLoggedIn&&m.getAuth()?m.getAuth().token:"",t.prev=7,t.next=10,(0,f.getAllStories)({page:this._currentPage,size:10,location:1,token:e});case 10:(n=t.sent).error?this.renderError("Failed to load stories. Please try again later."):(r=this._filterDuplicateStories(n.listStory),this._model.stories=[].concat(ct(this._model.stories),ct(r)),this._cacheStories(this._model.stories),this.renderStories(this._model.stories,n.fromCache),this._model.stories.length>0&&!this._lastStoryCheck&&(this._lastStoryCheck=this._model.stories[0].createdAt),this._map&&this._map.showStoryLocations(this._model.stories),this.updatePaginationState(n.listStory.length<10)),t.next=27;break;case 14:if(t.prev=14,t.t0=t.catch(7),console.error("Failed to fetch stories:",t.t0),navigator.onLine){t.next=26;break}return t.next=20,this._loadCachedStories();case 20:if(!((o=t.sent)&&o.length>0)){t.next=26;break}return this._model.stories=o,this.renderStories(o,!0),this.updatePaginationState(!0),t.abrupt("return");case 26:this.renderError("An error occurred while loading stories.");case 27:return t.prev=27,this._isLoading=!1,this.updateLoadingState(!1),t.finish(27);case 31:t.next=39;break;case 33:t.prev=33,t.t1=t.catch(0),console.error("Error in _loadStories:",t.t1),this.renderError("An error occurred while loading stories."),this._isLoading=!1,this.updateLoadingState(!1);case 39:case"end":return t.stop()}}),t,this,[[0,33],[7,14,27,31]])}))),function(){return o.apply(this,arguments)})},{key:"_cacheStories",value:(r=dt(pt().mark((function t(e){return pt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{localStorage.setItem("cached_stories",JSON.stringify(e))}catch(t){console.error("Failed to cache stories:",t)}case 1:case"end":return t.stop()}}),t)}))),function(t){return r.apply(this,arguments)})},{key:"_loadCachedStories",value:(n=dt(pt().mark((function t(){var e;return pt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e=localStorage.getItem("cached_stories"),t.abrupt("return",e?JSON.parse(e):[]);case 5:return t.prev=5,t.t0=t.catch(0),console.error("Failed to load cached stories:",t.t0),t.abrupt("return",[]);case 9:case"end":return t.stop()}}),t,null,[[0,5]])}))),function(){return n.apply(this,arguments)})},{key:"renderStories",value:function(t){var e=this;if(this._storiesContainer=document.getElementById("stories-container"),this._storiesContainer){var n=this.getIsLoggedIn();if(0!==t.length){t.length<=10&&(this._storiesContainer.innerHTML="");var r=document.createDocumentFragment(),o=new Set(Array.from(this._storiesContainer.querySelectorAll(".story-item")).map((function(t){return t.dataset.id})));t.forEach((function(t){if(!o.has(t.id)){var n=e._createStoryElement(t);r.appendChild(n)}})),this._storiesContainer.appendChild(r),setTimeout((function(){Array.from(e._storiesContainer.querySelectorAll(".story-item:not(.fade-in)")).forEach((function(t,e){setTimeout((function(){t.classList.add("fade-in")}),100*e)}))}),50),this._applyLazyLoadingToItems(),this._setupTransitions(),this._map&&this._map.showStoryLocations(t)}else this._storiesContainer.innerHTML='\n        <div class="empty-state">\n          <p>No stories available. Be the first to share a story!</p>\n          '.concat(n?'<a href="#/add" class="btn btn-primary" data-transition="true">Add Story</a>':'<a href="#/login" class="btn btn-primary" data-transition="true">Login to Share</a>',"\n        </div>\n      ")}else console.error("[HomePage] Stories container not found")}},{key:"_filterDuplicateStories",value:function(t){var e,n=[],r=function(t){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=ut(t))){e&&(t=e);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,a=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){a=!0,o=t},f:function(){try{i||null==e.return||e.return()}finally{if(a)throw o}}}}(t);try{for(r.s();!(e=r.n()).done;){var o=e.value;this._storyIds.has(o.id)||(this._storyIds.add(o.id),n.push(o))}}catch(t){r.e(t)}finally{r.f()}return n}},{key:"handleLoadMoreClick",value:function(){this._isLoading||(this._currentPage+=1,this._loadStories())}},{key:"_createStoryElement",value:function(t){var e=document.createElement("article");e.className="story-item",e.dataset.id=t.id;var n=t.name||"Anonymous",r=t.photoUrl||"",o=t.description||"",i=t.createdAt||(new Date).toISOString(),a=t.lat&&t.lon;return e.innerHTML='\n      <div class="story-image">\n        <a href="#/story/'.concat(t.id,'">\n          <img data-src="').concat(r,'" alt="').concat(n,'\'s story photo" src="data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 1 1\'%3E%3C/svg%3E">\n        </a>\n      </div>\n      <div class="story-content">\n        <h2><a href="#/story/').concat(t.id,'">').concat(n,'\'s Story</a></h2>\n        <p class="story-date">').concat(U(i,h.A.DEFAULT_LANGUAGE),'</p>\n        <p class="story-description">').concat(o.substring(0,100)).concat(o.length>100?"...":"","</p>\n        ").concat(a?'\n          <div class="story-location">\n            <i class="fas fa-map-marker-alt"></i> \n            <span>Location available</span>\n          </div>\n        ':"","\n      </div>\n    "),e}},{key:"_setupLoadMore",value:function(){var t=this,e=document.getElementById("load-more");if(e){var n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",(function(){if(!t._isLoading){t._isLoading=!0,n.disabled=!0,n.textContent="",n.classList.add("btn-loading");var e=t._storiesContainer.scrollHeight;t._storiesContainer.style.minHeight="".concat(e,"px"),t.handleLoadMoreClick()}}))}else console.error("[HomePage] Load more button not found during setup")}},{key:"updatePaginationState",value:function(t){var e=document.getElementById("load-more");e?(t?(e.disabled=!0,e.textContent="No More Stories",e.classList.remove("btn-loading")):(e.disabled=!1,e.textContent="Load More",e.classList.remove("btn-loading")),this._isLoading=!1,this._recalculateContainerSize()):console.error("[HomePage] Load more button not found")}},{key:"updateLoadingState",value:function(t){var e=this,n=document.getElementById("load-more");n?t?(n.disabled=!0,n.textContent="",n.classList.add("btn-loading")):(n.disabled=!1,n.textContent="Load More",n.classList.remove("btn-loading"),this._isLoading=!1,setTimeout((function(){return e._recalculateContainerSize()}),100)):console.error("[HomePage] Load more button not found")}},{key:"renderError",value:function(t){if(this._storiesContainer=document.getElementById("stories-container"),this._storiesContainer){this._storiesContainer.innerHTML='\n      <div class="error-state">\n        <p>'.concat(t,'</p>\n        <button class="btn btn-secondary" id="retry-btn">Retry</button>\n      </div>\n    ');var e=document.getElementById("retry-btn");e?e.addEventListener("click",(function(){window.location.reload()})):console.error("[HomePage] Retry button not found after rendering error state")}else console.error("[HomePage] Stories container not found when rendering error")}},{key:"getMap",value:function(){return this._map}},{key:"getIsLoggedIn",value:function(){return this._model.isLoggedIn}},{key:"getStories",value:function(){return this._model.stories}},{key:"destroy",value:function(){console.log("[HomePage] Destroy called"),this._newStoryInterval&&(clearInterval(this._newStoryInterval),this._newStoryInterval=null),window.removeEventListener("hashchange",this._handleHashChange);var t=document.getElementById("home-page-custom-style");t&&t.remove(),this._map&&(this._map.destroy(),this._map=null),this._observer&&(this._observer.disconnect(),this._observer=null),this._storiesContainer=null,this._model.stories=[],this._storyIds.clear()}}],e&&mt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o,i,a,s}();function gt(t){return gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gt(t)}function bt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,wt(r.key),r)}}function wt(t){var e=function(t){if("object"!=gt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=gt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==gt(e)?e:e+""}function xt(t,e){return t.get(kt(t,e))}function kt(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}var _t=new WeakMap,Lt=function(){return t=function t(){var e,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e,n){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.set(t,n)}(this,_t,void 0),e=_t,n=new vt,e.set(kt(e,this),n)},(e=[{key:"init",value:function(){return xt(_t,this).init()}},{key:"destroy",value:function(){xt(_t,this)&&xt(_t,this).destroy()}}])&&bt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Et(t){return Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Et(t)}function St(){St=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(j([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Et(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(Et(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function Pt(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function Ot(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Pt(i,r,o,a,s,"next",t)}function s(t){Pt(i,r,o,a,s,"throw",t)}a(void 0)}))}}function Tt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,At(r.key),r)}}function At(t){var e=function(t){if("object"!=Et(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Et(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Et(e)?e:e+""}const jt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._view=e,this._selectedLocation=null,this._imageFile=null,this._isLoggedIn=m.isUserSignedIn()},e=[{key:"init",value:function(){this._resetState()}},{key:"_resetState",value:function(){this._selectedLocation=null,this._imageFile=null}},{key:"isLoggedIn",value:function(){return this._isLoggedIn}},{key:"setImageFile",value:function(t){this._imageFile=t,this._view.updateSubmitButtonState()}},{key:"getImageFile",value:function(){return this._imageFile}},{key:"setSelectedLocation",value:function(t){this._selectedLocation=t,this._view.updateSelectedLocationText(t),this._view.updateSubmitButtonState()}},{key:"getSelectedLocation",value:function(){return this._selectedLocation}},{key:"validateForm",value:function(t,e){return t.trim()?!!e||(this._view.showAlert("Please add an image for your story."),!1):(this._view.showAlert("Please enter a description for your story."),!1)}},{key:"submitStory",value:(r=Ot(St().mark((function t(e,n,r){var o,i,a,s,c,u,l,p,h;return St().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this._view.setSubmitButtonState(!0,"Sharing..."),!r||n){t.next=4;break}throw new Error("Failed to get photo from camera");case 4:if(r||this._imageFile){t.next=6;break}throw new Error("No image file selected");case 6:if(o=this._selectedLocation?this._selectedLocation.latitude:null,i=this._selectedLocation?this._selectedLocation.longitude:null,a=r?n:this._imageFile,c="Seseorang",!this._isLoggedIn){t.next=19;break}return u=m.getAuth(),l=u.token,c=u.name||"Seseorang",t.next=16,(0,f.addStory)({description:e,photo:a,lat:o,lon:i,token:l});case 16:s=t.sent,t.next=23;break;case 19:return t.next=21,(0,f.addStoryGuest)({description:e,photo:a,lat:o,lon:i});case 21:s=t.sent,c="Guest";case 23:return s.error||s.isPending||(this._view.showAlert("Story shared successfully!"),h=(null===(p=s.story)||void 0===p?void 0:p.id)||Date.now().toString(),this._triggerNotification(c,h)),s.error?(this._view.showAlert("Failed to share story: ".concat(s.message)),this._view.setSubmitButtonState(!1,"Share Story")):this._view.navigateToHome(),t.abrupt("return",s);case 28:throw t.prev=28,t.t0=t.catch(0),console.error("Error sharing story:",t.t0),this._view.showAlert("An error occurred while sharing your story. Please try again."),this._view.setSubmitButtonState(!1,"Share Story"),t.t0;case 34:case"end":return t.stop()}}),t,this,[[0,28]])}))),function(t,e,n){return r.apply(this,arguments)})},{key:"_triggerNotification",value:(n=Ot(St().mark((function t(e){var n,r,o,i=arguments;return St().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:null,t.prev=1,console.log("[AddStory] ===== TRIGGERING NOTIFICATION ====="),console.log("[AddStory] Author name:",e),console.log("[AddStory] Story ID:",n),!("serviceWorker"in navigator)){t.next=10;break}return t.next=8,navigator.serviceWorker.ready;case 8:(r=t.sent)&&r.active&&(o={type:"SIMULATE_PUSH",data:{title:"Story App",body:"".concat(e," menambahkan story baru"),author:e,storyId:n}},console.log("[AddStory] Message being sent:",JSON.stringify(o,null,2)),r.active.postMessage(o),console.log("[AddStory] ===== MESSAGE SENT SUCCESSFULLY ====="));case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(1),console.error("[AddStory] ===== NOTIFICATION ERROR =====",t.t0);case 15:case"end":return t.stop()}}),t,null,[[1,12]])}))),function(t){return n.apply(this,arguments)})}],e&&Tt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function It(t){return It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},It(t)}function Bt(){Bt=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(j([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==It(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(It(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function Nt(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function Ct(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Nt(i,r,o,a,s,"next",t)}function s(t){Nt(i,r,o,a,s,"throw",t)}a(void 0)}))}}function Ft(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Mt(r.key),r)}}function Mt(t){var e=function(t){if("object"!=It(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=It(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==It(e)?e:e+""}const Gt=function(){return t=function t(e){var n=e.videoElement,r=e.captureButton,o=e.switchCameraButton,i=void 0===o?null:o,a=e.photoOutput,s=e.errorCallback,c=void 0===s?function(){}:s,u=e.photoTakenCallback,l=void 0===u?function(){}:u;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._videoElement=n,this._captureButton=r,this._switchCameraButton=i,this._photoOutput=a,this._errorCallback=c,this._photoTakenCallback=l,this._stream=null,this._facingMode="user",this._photoBlob=null,this._setOptimalCameraDimensions(),this._setupNavigationListeners()},e=[{key:"_setOptimalCameraDimensions",value:function(){this._videoElement&&(this._videoElement.style.width="100%",this._videoElement.style.height="100%",this._videoElement.style.objectFit="cover",this._photoOutput&&(this._photoOutput.style.width="100%",this._photoOutput.style.height="100%",this._photoOutput.style.objectFit="cover"))}},{key:"_setupNavigationListeners",value:function(){var t=this;this._hashChangeHandler=function(){console.log("Hash changed, stopping camera"),window.location.hash.includes("/add")||t.stop()},window.addEventListener("hashchange",this._hashChangeHandler),this._beforeUnloadHandler=function(){console.log("Page unloading, stopping camera"),t.stop()},window.addEventListener("beforeunload",this._beforeUnloadHandler),this._visibilityChangeHandler=function(){"hidden"===document.visibilityState&&(console.log("Page hidden, stopping camera"),t.stop())},document.addEventListener("visibilitychange",this._visibilityChangeHandler)}},{key:"init",value:(o=Ct(Bt().mark((function t(){var e=this;return Bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.stop(),console.log("Initializing camera..."),this._videoElement&&(this._videoElement.style.display="block"),t.next=6,this._startStream();case 6:if(this._stream=t.sent,this._videoElement){t.next=9;break}throw new Error("Video element not found");case 9:return this._videoElement.srcObject=this._stream,t.next=12,new Promise((function(t){e._videoElement.onloadedmetadata=function(){e._videoElement.play().then((function(){console.log("Camera started successfully"),t()})).catch((function(n){console.error("Error playing video:",n),e._errorCallback("Error starting video playback"),t()}))},setTimeout(t,3e3)}));case 12:return this._initEvents(),t.abrupt("return",!0);case 16:return t.prev=16,t.t0=t.catch(0),console.error("Camera init error:",t.t0),this._errorCallback(t.t0.message||"Could not access the camera"),t.abrupt("return",!1);case 21:case"end":return t.stop()}}),t,this,[[0,16]])}))),function(){return o.apply(this,arguments)})},{key:"_startStream",value:(r=Ct(Bt().mark((function t(){var e,n;return Bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e={video:{facingMode:this._facingMode,width:{ideal:1280},height:{ideal:960},aspectRatio:{ideal:4/3}},audio:!1},t.next=4,navigator.mediaDevices.getUserMedia(e);case 4:case 13:return t.abrupt("return",t.sent);case 7:return t.prev=7,t.t0=t.catch(0),console.warn("Failed with ideal constraints, trying basic constraints",t.t0),n={video:{facingMode:this._facingMode},audio:!1},t.next=13,navigator.mediaDevices.getUserMedia(n);case 14:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(){return r.apply(this,arguments)})},{key:"_initEvents",value:function(){var t=this;this._captureButton.removeEventListener("click",this._takePhoto),this._captureButton.addEventListener("click",(function(){t._takePhoto()})),this._switchCameraButton&&(this._switchCameraButton.removeEventListener("click",this._switchCamera),this._switchCameraButton.addEventListener("click",(function(){t._switchCamera()})))}},{key:"_takePhoto",value:function(){var t=this;if(this._videoElement&&this._stream){var e=document.createElement("canvas"),n=this._videoElement;e.width=n.videoWidth,e.height=n.videoHeight,e.getContext("2d").drawImage(n,0,0,e.width,e.height);var r=e.toDataURL("image/jpeg");this._photoOutput.src=r,this._photoOutput.style.display="block",e.toBlob((function(e){t._photoBlob=e}),"image/jpeg",.8),this._videoElement.style.display="none",this._photoOutput.style.display="block",this._captureButton.textContent="Retake Photo",this._captureButton.dataset.mode="retake",this.stop(),this._photoTakenCallback&&"function"==typeof this._photoTakenCallback&&this._photoTakenCallback(),this._captureButton.addEventListener("click",this._handleRetake.bind(this),{once:!0})}else console.error("Cannot take photo: video or stream not available")}},{key:"_handleRetake",value:function(){this._videoElement.style.display="block",this._photoOutput.style.display="none",this._captureButton.textContent="Take Photo",this._captureButton.dataset.mode="capture",this._photoBlob=null,this.init()}},{key:"_switchCamera",value:(n=Ct(Bt().mark((function t(){return Bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._facingMode="user"===this._facingMode?"environment":"user",console.log("Switching camera to:",this._facingMode),this.stop(),t.prev=3,t.next=6,this._startStream();case 6:return this._stream=t.sent,this._videoElement.srcObject=this._stream,t.next=10,this._videoElement.play();case 10:t.next=29;break;case 12:return t.prev=12,t.t0=t.catch(3),console.error("Error switching camera:",t.t0),this._errorCallback("Could not switch camera"),this._facingMode="user"===this._facingMode?"environment":"user",t.prev=17,t.next=20,this._startStream();case 20:return this._stream=t.sent,this._videoElement.srcObject=this._stream,t.next=24,this._videoElement.play();case 24:t.next=29;break;case 26:t.prev=26,t.t1=t.catch(17),console.error("Failed to revert camera facing mode:",t.t1);case 29:case"end":return t.stop()}}),t,this,[[3,12],[17,26]])}))),function(){return n.apply(this,arguments)})},{key:"stop",value:function(){if(console.log("Stopping camera stream"),this._stream){var t=this._stream.getTracks();console.log("Stopping ".concat(t.length," tracks")),t.forEach((function(t){console.log("Stopping track: ".concat(t.kind)),t.stop()})),this._stream=null}this._videoElement&&this._videoElement.srcObject&&(this._videoElement.srcObject=null)}},{key:"getPhotoBlob",value:function(){return this._photoBlob}},{key:"hasPhoto",value:function(){return null!==this._photoBlob}},{key:"resize",value:function(){this._setOptimalCameraDimensions()}},{key:"cleanUp",value:function(){console.log("Cleaning up camera resources"),this.stop(),window.removeEventListener("hashchange",this._hashChangeHandler),window.removeEventListener("beforeunload",this._beforeUnloadHandler),document.removeEventListener("visibilitychange",this._visibilityChangeHandler),this._stream=null,this._photoBlob=null}},{key:"isActive",value:function(){return!!this._stream&&this._stream.active}}],e&&Ft(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o}();function Dt(t){return Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dt(t)}function zt(){zt=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(j([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Dt(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(Dt(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function Ht(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function Rt(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Ht(i,r,o,a,s,"next",t)}function s(t){Ht(i,r,o,a,s,"throw",t)}a(void 0)}))}}function Ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Yt(r.key),r)}}function Yt(t){var e=function(t){if("object"!=Dt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Dt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Dt(e)?e:e+""}const Vt=function(){return t=function t(){var e,n,r,o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=this,r=function(){console.log("[AddStoryPage] Hash changed"),window.location.hash.includes("/add")||o._camera&&(console.log("Stopping camera on hash change"),o._camera.stop(),o._camera.cleanUp(),o._camera=null)},(n=Yt(n="_onHashChange"))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,this._camera=null,this._map=null,this._marker=null,this._presenter=new jt(this),this._handleBackButtonClick=this._handleBackButtonClick.bind(this)},e=[{key:"render",value:(r=Rt(zt().mark((function t(){return zt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <style>\n        /* ===== Base styles ===== */\n        .add-story-page {\n          padding: 20px;\n          max-width: 1200px;\n          margin: 0 auto;\n        }\n        \n        .back-button {\n          display: inline-flex;\n          align-items: center;\n          padding: 8px 16px;\n          background-color: #f5f5f5;\n          border-radius: 20px;\n          color: #333;\n          text-decoration: none;\n          margin-bottom: 16px;\n          font-weight: 500;\n          transition: all 0.2s ease;\n          box-shadow: 0 2px 4px rgba(0,0,0,0.05);\n        }\n        \n        .back-button:hover {\n          background-color: #e8e8e8;\n          transform: translateY(-2px);\n          box-shadow: 0 4px 8px rgba(0,0,0,0.1);\n        }\n        \n        .back-button i {\n          margin-right: 8px;\n        }\n        \n        .add-story-page h1 {\n          font-size: 1.8rem;\n          margin-bottom: 20px;\n          color: #333;\n        }\n        \n        .add-story-form {\n          background-color: #fff;\n          border-radius: 12px;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n          padding: 24px;\n          margin-bottom: 40px;\n        }\n        \n        .form-group {\n          margin-bottom: 24px;\n        }\n        \n        .form-group label {\n          display: block;\n          font-weight: 600;\n          margin-bottom: 8px;\n          color: #333;\n          font-size: 1rem;\n        }\n        \n        .helper-text {\n          font-size: 0.85rem;\n          color: #666;\n          margin-top: 4px;\n          margin-bottom: 8px;\n        }\n        \n        textarea {\n          width: 100%;\n          padding: 12px;\n          border: 1px solid #ddd;\n          border-radius: 8px;\n          resize: vertical;\n          font-size: 1rem;\n          font-family: inherit;\n          transition: border-color 0.3s;\n        }\n        \n        textarea:focus {\n          border-color: #0084ff;\n          outline: none;\n          box-shadow: 0 0 0 2px rgba(0, 132, 255, 0.2);\n        }\n        \n        .location-actions {\n          margin-bottom: 10px;\n        }\n        \n        .location-info {\n          margin-top: 10px;\n          padding: 12px;\n          background-color: #f8f9fa;\n          border-radius: 8px;\n          font-size: 0.9rem;\n        }\n        \n        #selected-location {\n          margin: 0;\n          word-break: break-word;\n        }\n        \n        .map-marker-pulse {\n          display: block;\n          width: 22px;\n          height: 22px;\n          border-radius: 50%;\n          background: rgba(0, 132, 255, 0.6);\n          border: 2px solid white;\n          cursor: pointer;\n          box-shadow: 0 0 0 rgba(0, 132, 255, 0.4);\n          animation: pulse 2s infinite;\n        }\n        \n        @keyframes pulse {\n          0% {\n            box-shadow: 0 0 0 0 rgba(0, 132, 255, 0.4);\n          }\n          70% {\n            box-shadow: 0 0 0 10px rgba(0, 132, 255, 0);\n          }\n          100% {\n            box-shadow: 0 0 0 0 rgba(0, 132, 255, 0);\n          }\n        }\n        \n        .media-options {\n          display: flex;\n          margin-bottom: 15px;\n          flex-wrap: wrap;\n          gap: 10px;\n        }\n        \n        .media-option {\n          cursor: pointer;\n          padding: 10px 16px;\n          background-color: #f1f1f1;\n          border-radius: 8px;\n          font-weight: 600;\n          transition: all 0.3s;\n          flex: 1;\n          min-width: 120px;\n          text-align: center;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: 8px;\n        }\n        \n        .media-option:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        }\n        \n        .media-option.active {\n          background-color: #0084ff;\n          color: white;\n          transform: scale(1.02);\n          box-shadow: 0 3px 10px rgba(0,132,255,0.3);\n        }\n        \n        .camera-container {\n          position: relative;\n          margin-top: 15px;\n          border-radius: 12px;\n          overflow: hidden;\n          box-shadow: 0 3px 10px rgba(0,0,0,0.1);\n          background-color: #f8f8f8;\n        }\n        \n        #camera-preview, #photo-preview {\n          width: 100%;\n          max-height: 70vh;\n          object-fit: cover;\n          border-radius: 12px;\n          display: block;\n        }\n        \n        .camera-controls {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 10px;\n          padding: 15px;\n          background-color: rgba(0,0,0,0.03);\n          border-top: 1px solid rgba(0,0,0,0.05);\n        }\n        \n        .btn {\n          padding: 10px 16px;\n          border-radius: 8px;\n          font-weight: 600;\n          cursor: pointer;\n          transition: all 0.2s;\n          border: none;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: 8px;\n          flex: 1;\n          min-width: 120px;\n        }\n        \n        .btn-primary {\n          background-color: #0084ff;\n          color: white;\n        }\n        \n        .btn-primary:hover:not(:disabled) {\n          background-color: #0077e6;\n          transform: translateY(-2px);\n          box-shadow: 0 4px 10px rgba(0,132,255,0.3);\n        }\n        \n        .btn-primary:disabled {\n          background-color: #a6d0ff;\n          cursor: not-allowed;\n        }\n        \n        .btn-secondary {\n          background-color: #f1f1f1;\n          color: #333;\n        }\n        \n        .btn-secondary:hover {\n          background-color: #e5e5e5;\n          transform: translateY(-2px);\n          box-shadow: 0 3px 8px rgba(0,0,0,0.1);\n        }\n        \n        .image-upload-container {\n          margin-top: 15px;\n          display: none;\n          padding: 20px;\n          border-radius: 12px;\n          border: 2px dashed #ddd;\n          background-color: #f9f9f9;\n          text-align: center;\n        }\n        \n        .image-upload-preview {\n          max-width: 100%;\n          max-height: 70vh;\n          margin: 15px auto 0;\n          border-radius: 8px;\n          display: none;\n          box-shadow: 0 3px 10px rgba(0,0,0,0.1);\n        }\n        \n        .file-input-wrapper {\n          position: relative;\n          overflow: hidden;\n          display: inline-block;\n          margin-bottom: 10px;\n        }\n        \n        .file-input-wrapper input[type=file] {\n          font-size: 100px;\n          position: absolute;\n          left: 0;\n          top: 0;\n          opacity: 0;\n          cursor: pointer;\n          width: 100%;\n          height: 100%;\n        }\n        \n        .file-input-button {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: 8px;\n          padding: 12px 24px;\n          background-color: #0084ff;\n          color: white;\n          border-radius: 8px;\n          cursor: pointer;\n          font-weight: 600;\n          transition: all 0.2s;\n        }\n        \n        .file-input-button:hover {\n          background-color: #0077e6;\n          transform: translateY(-2px);\n          box-shadow: 0 4px 10px rgba(0,132,255,0.3);\n        }\n        \n        .image-upload-info {\n          margin-top: 10px;\n          font-size: 0.85rem;\n          color: #666;\n        }\n        \n        .error-message {\n          color: #d93025;\n          font-size: 0.85rem;\n          margin-top: 8px;\n          padding: 8px 12px;\n          background-color: #feeced;\n          border-radius: 6px;\n          display: none;\n        }\n        \n        .error-message:not(:empty) {\n          display: block;\n        }\n        \n        .form-actions {\n          margin-top: 32px;\n          display: flex;\n          flex-direction: column;\n          gap: 15px;\n        }\n        \n        .guest-notice {\n          font-size: 0.9rem;\n          padding: 12px;\n          background-color: #f8f9fa;\n          border-radius: 8px;\n          text-align: center;\n          margin: 0;\n        }\n        \n        .guest-notice a {\n          color: #0084ff;\n          font-weight: 600;\n          text-decoration: none;\n        }\n        \n        .guest-notice a:hover {\n          text-decoration: underline;\n        }\n        \n        /* ===== Responsive styles ===== */\n        @media (max-width: 768px) {\n          .add-story-page {\n            padding: 16px;\n          }\n          \n          .add-story-form {\n            padding: 20px 16px;\n            border-radius: 10px;\n          }\n          \n          .add-story-page h1 {\n            font-size: 1.5rem;\n            margin-bottom: 16px;\n          }\n          \n          .form-group {\n            margin-bottom: 20px;\n          }\n          \n          .media-options {\n            flex-direction: row;\n            flex-wrap: wrap;\n          }\n          \n          .media-option {\n            flex: 1 0 calc(50% - 5px);\n            min-width: 0;\n            padding: 8px 12px;\n            font-size: 0.9rem;\n          }\n          \n          .camera-controls {\n            flex-direction: row;\n            flex-wrap: wrap;\n          }\n          \n          .btn {\n            flex: 1 0 calc(50% - 5px);\n            min-width: 0;\n            padding: 10px 12px;\n            font-size: 0.9rem;\n          }\n          \n          #story-map {\n            height: 300px; \n            width: 100%;\n            margin: 0 auto;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n          }\n\n          /* Make sure map container is centered on all screen sizes */\n          .form-group div#story-map {\n            margin-left: auto;\n            margin-right: auto;\n            max-width: 100%;\n          }\n\n          /* Ensure the leaflet container is properly centered */\n          .leaflet-container {\n            width: 100%;\n            height: 100%;\n          }\n\n          @media (max-width: 768px) {\n            #story-map {\n              height: 250px !important;\n              max-width: 100%;\n              margin: 0 auto;\n            }\n          }\n\n          @media (max-width: 480px) {\n            #story-map {\n              height: 200px !important;\n              max-width: 100%;\n              margin: 0 auto;\n            }\n          }\n          \n          textarea {\n            padding: 10px;\n            font-size: 0.95rem;\n          }\n        }\n        \n        @media (max-width: 480px) {\n          .add-story-page {\n            padding: 12px;\n          }\n          \n          .back-button {\n            padding: 6px 12px;\n            font-size: 0.9rem;\n          }\n          \n          .add-story-form {\n            padding: 16px 12px;\n          }\n          \n          .form-group label {\n            font-size: 0.95rem;\n          }\n          \n          .media-option {\n            flex: 1 0 100%;\n            margin-right: 0;\n            margin-bottom: 8px;\n          }\n          \n          .camera-controls {\n            padding: 10px;\n          }\n          \n          .btn {\n            flex: 1 0 100%;\n            margin-bottom: 8px;\n            padding: 10px;\n          }\n          \n          #story-map {\n            height: 200px !important;\n          }\n          \n          .location-info {\n            padding: 10px;\n            font-size: 0.85rem;\n          }\n          \n          .file-input-button {\n            padding: 10px 16px;\n            font-size: 0.9rem;\n          }\n          \n          .helper-text {\n            font-size: 0.8rem;\n          }\n        }\n        \n        /* ===== View Transition styles ===== */\n        /* Default animations for all browsers */\n        @keyframes fade-in {\n          from { opacity: 0; transform: translateY(20px); }\n          to { opacity: 1; transform: translateY(0); }\n        }\n        \n        @keyframes slide-up {\n          from { transform: translateY(30px); opacity: 0; }\n          to { transform: translateY(0); opacity: 1; }\n        }\n        \n        @keyframes fade-out {\n          from { opacity: 1; }\n          to { opacity: 0; }\n        }\n        \n        @keyframes slide-left {\n          from { transform: translateX(0); opacity: 1; }\n          to { transform: translateX(-20px); opacity: 0; }\n        }\n        \n        @keyframes slide-from-left {\n          from { transform: translateX(-20px); opacity: 0; }\n          to { transform: translateX(0); opacity: 1; }\n        }\n        \n        @keyframes fade-up {\n          from { transform: translateY(0); opacity: 1; }\n          to { transform: translateY(-20px); opacity: 0; }\n        }\n        \n        @keyframes fade-from-up {\n          from { transform: translateY(-20px); opacity: 0; }\n          to { transform: translateY(0); opacity: 1; }\n        }\n        \n        /* Fallback animations for browsers without View Transitions API */\n        .add-story-page {\n          animation: fade-in 0.3s ease-out;\n        }\n        \n        .add-story-form {\n          animation: slide-up 0.4s ease-out;\n        }\n        \n        /* Animate form elements sequentially */\n        .form-group {\n          animation: slide-up 0.5s ease-out;\n          animation-fill-mode: backwards;\n        }\n        \n        .form-group:nth-child(1) { animation-delay: 0.1s; }\n        .form-group:nth-child(2) { animation-delay: 0.15s; }\n        .form-group:nth-child(3) { animation-delay: 0.2s; }\n        \n        .form-actions {\n          animation: slide-up 0.5s ease-out;\n          animation-delay: 0.25s;\n          animation-fill-mode: backwards;\n        }\n        \n        /* View Transitions API specific styles */\n        @supports (view-transition-name: none) {\n          /* Custom transitions for Add Story page elements */\n          .add-story-page {\n            view-transition-name: add-story-page;\n          }\n          \n          #back-to-home {\n            view-transition-name: back-button;\n          }\n          \n          .add-story-page h1 {\n            view-transition-name: page-title;\n          }\n          \n          .add-story-form {\n            view-transition-name: story-form;\n          }\n          \n          /* Specific transitions for form elements */\n          ::view-transition-group(description-group) {\n            animation-duration: 0.5s;\n            animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n          }\n          \n          ::view-transition-group(media-group) {\n            animation-duration: 0.6s;\n            animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n          }\n          \n          ::view-transition-group(location-group) {\n            animation-duration: 0.7s;\n            animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n          }\n          \n          ::view-transition-old(add-story-page) {\n            animation: 0.5s ease-out fade-out both;\n          }\n          \n          ::view-transition-new(add-story-page) {\n            animation: 0.5s ease-out fade-in both;\n          }\n          \n          ::view-transition-old(back-button) {\n            animation: 0.3s ease-out slide-left both;\n          }\n          \n          ::view-transition-new(back-button) {\n            animation: 0.4s ease-out slide-from-left both;\n            animation-delay: 0.1s;\n          }\n          \n          ::view-transition-old(page-title) {\n            animation: 0.3s ease-out fade-up both;\n          }\n          \n          ::view-transition-new(page-title) {\n            animation: 0.5s ease-out fade-from-up both;\n            animation-delay: 0.15s;\n          }\n          \n          ::view-transition-old(story-form) {\n            animation: 0.4s ease-out fade-out both;\n          }\n          \n          ::view-transition-new(story-form) {\n            animation: 0.5s ease-out fade-in both;\n            animation-delay: 0.2s;\n          }\n          \n          /* Transition between photo preview and camera view */\n          ::view-transition-group(camera-container) {\n            animation-duration: 0.4s;\n            animation-timing-function: ease-in-out;\n          }\n          \n          /* Smooth transitions for map interactions */\n          ::view-transition-group(story-map) {\n            animation-duration: 0.5s;\n            animation-timing-function: ease-in-out;\n          }\n          \n          /* Media options transitions */\n          ::view-transition-group(media-options) {\n            animation-duration: 0.3s;\n            animation-timing-function: ease-in-out;\n          }\n        }\n      </style>\n      \n      <section class="container add-story-page">\n        <a href="#/home" class="back-button" aria-label="Back to home page" id="back-to-home">\n          <i class="fas fa-arrow-left"></i> Back\n        </a>\n        \n        <h1>Add New Story</h1>\n        \n        <form id="add-story-form" class="add-story-form">\n          <div class="form-group" style="view-transition-name: description-group">\n            <label for="description">Story Description</label>\n            <textarea id="description" name="description" rows="4" required></textarea>\n          </div>\n          \n          <div class="form-group" style="view-transition-name: media-group">\n            <label>Story Media</label>\n            \n            <div class="media-options" style="view-transition-name: media-options">\n              <div id="option-camera" class="media-option active">\n                <i class="fas fa-camera"></i> Camera\n              </div>\n              <div id="option-upload" class="media-option">\n                <i class="fas fa-upload"></i> Upload Image\n              </div>\n            </div>\n            \n            <div id="camera-container" class="camera-container" style="view-transition-name: camera-container">\n              <video id="camera-preview" autoplay playsinline></video>\n              <img id="photo-preview" style="display: none;" alt="Captured photo preview">\n              \n              <div class="camera-controls" style="view-transition-name: camera-controls">\n                <button type="button" id="capture-button" class="btn btn-secondary">\n                  <i class="fas fa-camera"></i> Take Photo\n                </button>\n                <button type="button" id="switch-camera" class="btn btn-secondary">\n                  <i class="fas fa-sync"></i> Switch Camera\n                </button>\n              </div>\n            </div>\n            <div id="camera-error" class="error-message"></div>\n            \n            <div id="image-upload-container" class="image-upload-container" style="view-transition-name: upload-container">\n              <div class="file-input-wrapper">\n                <div class="file-input-button">\n                  <i class="fas fa-image"></i> Choose Image\n                </div>\n                <input type="file" id="image-upload" accept="image/*">\n              </div>\n              <div class="image-upload-info">\n                Supported formats: JPG, PNG, GIF. Max size: 5MB\n              </div>\n              <img id="image-preview" class="image-upload-preview" alt="Uploaded image preview">\n            </div>\n          </div>\n          \n          <div class="form-group" style="view-transition-name: location-group">\n            <label>Location (Optional)</label>\n            <p class="helper-text">Click on the map to select a location for your story.</p>\n            <div id="story-map" style="height: 300px; view-transition-name: story-map"></div>\n            \n            <div class="location-info" style="view-transition-name: location-info">\n              <p id="selected-location">No location selected</p>\n            </div>\n          </div>\n          \n          <div class="form-actions" style="view-transition-name: form-actions">\n            <button type="submit" id="submit-button" class="btn btn-primary" disabled style="view-transition-name: submit-button">\n              Share Story\n            </button>\n            '.concat(this._presenter.isLoggedIn()?"":'\n              <p class="guest-notice" style="view-transition-name: guest-notice">\n                You\'re posting as a guest. <a href="#/login">Login</a> to share with your account.\n              </p>\n            ',"\n          </div>\n        </form>\n      </section>\n    "));case 1:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=Rt(zt().mark((function t(){return zt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._presenter.init(),this._initMediaOptions(),this._initCamera(),this._initImageUpload(),this._initMap(),this._initForm(),this._initBackButton(),this._setupViewTransition(),document.title="Add Story - Story App";case 9:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"_setupViewTransition",value:function(){document.body.classList.add("add-story-view"),window.getComputedStyle(document.querySelector(".add-story-page")).opacity}},{key:"_initBackButton",value:function(){var t=document.getElementById("back-to-home");t&&(t.removeEventListener("click",this._handleBackButtonClick),t.addEventListener("click",this._handleBackButtonClick))}},{key:"_handleBackButtonClick",value:function(t){t.preventDefault(),this._camera&&(console.log("Stopping camera from back button click"),this._camera.stop(),this._camera.cleanUp(),this._camera=null),this.navigateToHome()}},{key:"_initMediaOptions",value:function(){var t=this,e=document.getElementById("option-camera"),n=document.getElementById("option-upload"),r=document.getElementById("camera-container"),o=document.getElementById("image-upload-container");e&&n&&r&&o?(e.addEventListener("click",(function(){document.startViewTransition?document.startViewTransition((function(){e.classList.add("active"),n.classList.remove("active"),r.style.display="block",o.style.display="none",t._initCamera(),t.updateSubmitButtonState()})):(e.classList.add("active"),n.classList.remove("active"),r.style.display="block",o.style.display="none",t._initCamera(),t.updateSubmitButtonState())})),n.addEventListener("click",(function(){document.startViewTransition?document.startViewTransition((function(){n.classList.add("active"),e.classList.remove("active"),o.style.display="block",r.style.display="none",t._camera&&t._camera.stop(),t.updateSubmitButtonState()})):(n.classList.add("active"),e.classList.remove("active"),o.style.display="block",r.style.display="none",t._camera&&t._camera.stop(),t.updateSubmitButtonState())}))):console.error("[AddStoryPage] Media option elements not found")}},{key:"_initCamera",value:function(){var t=this,e=document.getElementById("camera-preview"),n=document.getElementById("capture-button"),r=document.getElementById("switch-camera"),o=document.getElementById("photo-preview");e&&n&&r&&o?(this._camera=new Gt({videoElement:e,captureButton:n,switchCameraButton:r,photoOutput:o,errorCallback:function(t){var e=document.getElementById("camera-error");e&&(e.textContent=t)},photoTakenCallback:function(){document.startViewTransition&&o?document.startViewTransition((function(){o.style.display="block",e.style.display="none",t.updateSubmitButtonState()})):(o.style.display="block",e.style.display="none",t.updateSubmitButtonState())}}),this._camera.init().then((function(e){if(e)t.updateSubmitButtonState();else{var n=document.getElementById("camera-error");n&&(n.textContent="Could not access camera. Please ensure camera permissions are enabled.")}})),window.removeEventListener("hashchange",this._onHashChange),window.addEventListener("hashchange",this._onHashChange)):console.error("[AddStoryPage] Camera elements not found")}},{key:"_initImageUpload",value:function(){var t=this,e=document.getElementById("image-upload"),n=document.getElementById("image-preview");e&&n?e.addEventListener("change",(function(r){var o=r.target.files[0];if(o){if(o.size>5242880)return t.showAlert("Image size exceeds 5MB limit. Please choose a smaller image."),e.value="",t._presenter.setImageFile(null),n.style.display="none",void t.updateSubmitButtonState();var i=new FileReader;i.onload=function(e){document.startViewTransition?document.startViewTransition((function(){n.src=e.target.result,n.style.display="block",t._presenter.setImageFile(o),t.updateSubmitButtonState()})):(n.src=e.target.result,n.style.display="block",t._presenter.setImageFile(o),t.updateSubmitButtonState())},i.readAsDataURL(o)}else n.style.display="none",t._presenter.setImageFile(null),t.updateSubmitButtonState()})):console.error("[AddStoryPage] Image upload elements not found")}},{key:"_initMap",value:function(){var t=this,e=document.getElementById("story-map");e?(this._map=new Q({mapContainer:e}),this._map.init(),this._map.setLocationSelectedCallback((function(e){t._presenter.setSelectedLocation(e),document.startViewTransition?document.startViewTransition((function(){t._addMarkerToMap(e.latitude,e.longitude),t.updateSubmitButtonState()})):(t._addMarkerToMap(e.latitude,e.longitude),t.updateSubmitButtonState())}))):console.error("[AddStoryPage] Map container not found")}},{key:"_addMarkerToMap",value:function(t,e){this._marker&&this._map.removeMarker(this._marker),this._marker=this._map.addMarker(t,e,"",{color:"#28a745",draggable:!0})}},{key:"updateSelectedLocationText",value:function(t){var e=document.getElementById("selected-location");e?t?document.startViewTransition?document.startViewTransition((function(){e.innerHTML='\n            <i class="fas fa-map-marker-alt"></i> \n            Location selected: ('.concat(t.latitude.toFixed(6),", \n            ").concat(t.longitude.toFixed(6),")\n          ")})):e.innerHTML='\n          <i class="fas fa-map-marker-alt"></i> \n          Location selected: ('.concat(t.latitude.toFixed(6),", \n          ").concat(t.longitude.toFixed(6),")\n        "):e.textContent="No location selected":console.error("[AddStoryPage] Location text element not found")}},{key:"_initForm",value:function(){var t=this,e=document.getElementById("add-story-form"),n=document.getElementById("description"),r=document.getElementById("submit-button");e&&n&&r?(n.addEventListener("input",(function(){t.updateSubmitButtonState()})),e.addEventListener("submit",function(){var e=Rt(zt().mark((function e(n){var r,o,i,a,s,c,u;return zt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),r=document.getElementById("description"),o=document.getElementById("option-camera"),r&&o){e.next=6;break}return console.error("[AddStoryPage] Form elements not found"),e.abrupt("return");case 6:if(i=r.value,a=o.classList.contains("active"),!1,s=a?t._camera&&t._camera.hasPhoto():!!t._presenter.getImageFile(),t._presenter.validateForm(i,s)){e.next=12;break}return e.abrupt("return");case 12:return t.setSubmitButtonState(!0,"Saving..."),c=a&&t._camera?t._camera.getPhotoBlob():null,e.prev=14,e.next=17,t._presenter.submitStory(i,c,a);case 17:u=e.sent,!navigator.onLine&&u&&!u.error&&u.isPending&&t.showAlert("Story saved offline. It will be uploaded when you're back online."),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(14),console.error("Error submitting story:",e.t0),t.showAlert("An error occurred while sharing your story. Please try again."),t.setSubmitButtonState(!1,"Share Story");case 26:case"end":return e.stop()}}),e,null,[[14,21]])})));return function(t){return e.apply(this,arguments)}}())):console.error("[AddStoryPage] Form elements not found")}},{key:"updateSubmitButtonState",value:function(){var t=document.getElementById("description"),e=document.getElementById("submit-button"),n=document.getElementById("option-camera");if(t&&e&&n){var r,o=n.classList.contains("active"),i=""!==t.value.trim();r=o?this._camera&&this._camera.hasPhoto():!!this._presenter.getImageFile(),console.log("Description filled:",i),console.log("Has media:",r),console.log("Using camera:",o),e.disabled=!(i&&r)}else console.error("[AddStoryPage] Elements for submit button state update not found")}},{key:"setSubmitButtonState",value:function(t,e){var n=document.getElementById("submit-button");n&&(n.disabled=t,n.textContent=e||"Share Story")}},{key:"showAlert",value:function(t){alert(t)}},{key:"navigateToHome",value:function(){document.startViewTransition?document.startViewTransition((function(){window.location.hash="#/home"})):window.location.hash="#/home"}},{key:"destroy",value:function(){console.log("[AddStoryPage] Destroy called"),this._camera&&(this._camera.stop(),this._camera.cleanUp(),this._camera=null),window.removeEventListener("hashchange",this._onHashChange),document.body.classList.remove("add-story-view")}}],e&&Ut(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();var Wt=n(147);function qt(t){return qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qt(t)}function Jt(){Jt=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(j([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==qt(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(qt(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function Kt(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function Zt(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Kt(i,r,o,a,s,"next",t)}function s(t){Kt(i,r,o,a,s,"throw",t)}a(void 0)}))}}function Xt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,$t(r.key),r)}}function $t(t){var e=function(t){if("object"!=qt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=qt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==qt(e)?e:e+""}const Qt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._view=e,this._story=null,this._map=null,this._locationAddress=null,this._isBookmarked=!1},e=[{key:"init",value:(a=Zt(Jt().mark((function t(e){return Jt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._loadStoryDetail(e);case 2:return t.next=4,this._checkBookmarkStatus(e);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"_loadStoryDetail",value:(i=Zt(Jt().mark((function t(e){var n,r;return Jt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,console.log("[DetailStoryPresenter] Loading story with ID:",e),n=m.getAuth().token){t.next=7;break}return console.warn("[DetailStoryPresenter] No auth token found, redirecting to login"),window.location.hash="#/login",t.abrupt("return");case 7:return console.log("[DetailStoryPresenter] Fetching story details from API"),t.next=10,(0,f.getDetailStory)({id:e,token:n});case 10:if(r=t.sent,console.log("[DetailStoryPresenter] API response:",r),r.error){t.next=25;break}if(this._story=r.story,console.log("[DetailStoryPresenter] Story data loaded:",this._story),this._view.renderStoryDetail(this._story),console.log("[DetailStoryPresenter] Story detail rendered"),!this._story.lat||!this._story.lon){t.next=23;break}return console.log("[DetailStoryPresenter] Story has location data, preparing map"),this._view.showMapContainer(),t.next=22,this._getLocationAddress();case 22:this._view.initMapWithDelay(this._story.lat,this._story.lon);case 23:t.next=27;break;case 25:console.error("[DetailStoryPresenter] API error:",r.error),this._view.renderError("Failed to load story details.");case 27:t.next=33;break;case 29:t.prev=29,t.t0=t.catch(0),console.error("[DetailStoryPresenter] Error loading story detail:",t.t0),this._view.renderError("An error occurred while loading the story.");case 33:case"end":return t.stop()}}),t,this,[[0,29]])}))),function(t){return i.apply(this,arguments)})},{key:"_checkBookmarkStatus",value:(o=Zt(Jt().mark((function t(e){return Jt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Wt.A.isBookmarked(e);case 3:this._isBookmarked=t.sent,this._view.setupBookmarkButton(this._story,this._isBookmarked),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("[DetailStoryPresenter] Error checking bookmark status:",t.t0),this._view.setupBookmarkButton(this._story,!1);case 11:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(t){return o.apply(this,arguments)})},{key:"toggleBookmark",value:(r=Zt(Jt().mark((function t(e){return Jt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(this._view.setBookmarkLoading(!0),t.prev=3,!this._isBookmarked){t.next=12;break}return t.next=7,Wt.A.removeBookmark(e.id);case 7:this._isBookmarked=!1,this._view.updateBookmarkButton(!1),this._view.showToast("Bookmark removed","success"),t.next=17;break;case 12:return t.next=14,Wt.A.addBookmark(e);case 14:this._isBookmarked=!0,this._view.updateBookmarkButton(!0),this._view.showToast("Story bookmarked!","success");case 17:t.next=23;break;case 19:t.prev=19,t.t0=t.catch(3),console.error("[DetailStoryPresenter] Error toggling bookmark:",t.t0),this._view.showToast("Failed to update bookmark","error");case 23:return t.prev=23,this._view.setBookmarkLoading(!1),t.finish(23);case 26:case"end":return t.stop()}}),t,this,[[3,19,23,26]])}))),function(t){return r.apply(this,arguments)})},{key:"_getLocationAddress",value:(n=Zt(Jt().mark((function t(){var e,n;return Jt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._story&&this._story.lat&&this._story.lon){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,!this._story.location){t.next=8;break}return this._locationAddress=this._story.location,this._view.updateLocationAddressUI(this._locationAddress),this._map&&this._map._mapInitialized&&this._updateMapPopup(),t.abrupt("return");case 8:return this._view.showLoadingAddress(),e=new Q({mapContainer:this._view.createTemporaryMapContainer()}),t.prev=10,t.next=13,Promise.race([e.getAddressFromCoordinates(this._story.lat,this._story.lon),this._view.createTimeoutPromise(8e3,"Waktu pencarian lokasi habis")]);case 13:n=t.sent,this._locationAddress=n||"Alamat tidak ditemukan",t.next=21;break;case 17:t.prev=17,t.t0=t.catch(10),console.warn("Error fetching detailed address:",t.t0);try{this._locationAddress="".concat(this._story.lat.toFixed(4),", ").concat(this._story.lon.toFixed(4))}catch(t){this._locationAddress="Lokasi tidak diketahui"}case 21:this._view.updateLocationAddressUI(this._locationAddress),this._map&&this._map._mapInitialized&&this._updateMapPopup(),e.destroy(),t.next=31;break;case 26:t.prev=26,t.t1=t.catch(2),console.error("Error getting location address:",t.t1),this._locationAddress="Lokasi tidak diketahui",this._view.updateLocationAddressUI(this._locationAddress);case 31:case"end":return t.stop()}}),t,this,[[2,26],[10,17]])}))),function(){return n.apply(this,arguments)})},{key:"_updateMapPopup",value:function(){if(this._map&&this._map._markers&&0!==this._map._markers.length){var t=this._map._markers[0];if(t){var e={name:this._story.name,photoUrl:this._story.photoUrl,locationAddress:this._locationAddress||"Lokasi tidak diketahui"};this._view.updateMapPopup(t,e),this._view.openMarkerPopupAndAdjustView(t)}}}},{key:"setMap",value:function(t){this._map=t,this._locationAddress&&this._map&&this._map._markers&&this._map._markers.length>0&&this._updateMapPopup()}},{key:"getStoryData",value:function(){return this._story}},{key:"getLocationAddress",value:function(){return this._locationAddress}}],e&&Xt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o,i,a}();function te(t){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},te(t)}function ee(){ee=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(j([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==te(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(te(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function ne(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function re(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){ne(i,r,o,a,s,"next",t)}function s(t){ne(i,r,o,a,s,"throw",t)}a(void 0)}))}}function oe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ie(r.key),r)}}function ie(t){var e=function(t){if("object"!=te(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=te(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==te(e)?e:e+""}var ae=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._presenter=new Qt(this),this._mapContainer=null},e=[{key:"ensureMapLibrary",value:function(){return new Promise((function(t,e){if(window.L&&"function"==typeof window.L.map)return console.log("[DetailStoryPage] Leaflet already loaded"),void t(!0);if(console.log("[DetailStoryPage] Loading Leaflet library"),!document.getElementById("leaflet-css")){var n=document.createElement("link");n.id="leaflet-css",n.rel="stylesheet",n.href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css",n.integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==",n.crossOrigin="",document.head.appendChild(n)}if(!document.getElementById("leaflet-js")){var r=document.createElement("script");r.id="leaflet-js",r.src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js",r.integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==",r.crossOrigin="",r.onload=function(){console.log("[DetailStoryPage] Leaflet library loaded successfully"),t(!0)},r.onerror=function(t){console.error("[DetailStoryPage] Failed to load Leaflet:",t),e(t)},document.head.appendChild(r)}}))}},{key:"render",value:(o=re(ee().mark((function t(){return ee().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <section class="container detail-story-page">\n        <div class="page-header">\n          <a href="#/home" class="back-button" aria-label="Back to home page">\n            <i class="fas fa-arrow-left"></i> Back\n          </a>\n          \n          <div class="story-actions">\n            <button id="bookmark-btn" class="bookmark-btn" aria-label="Bookmark this story">\n              <i class="fas fa-bookmark"></i>\n              <span class="bookmark-text">Bookmark</span>\n            </button>\n          </div>\n        </div>\n        \n        <div id="story-container" class="story-detail">\n          <div class="loading-indicator">Loading story details...</div>\n        </div>\n        \n        <div id="map-container" class="map-container" style="display: none; background-color: #fff; border-radius: 10px; margin: 30px auto; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 20px; max-width: 100%; box-sizing: border-box;">\n          <h2 style="margin: 0 0 15px; font-size: 24px; font-weight: 600; color: #333;">Story Location</h2>\n          <div id="story-location-address" style="margin-bottom: 15px; display: flex; align-items: flex-start;">\n            <i class="fas fa-map-marker-alt" style="margin-right: 10px; color: #d9534f; font-size: 18px; margin-top: 3px;"></i> \n            <span id="location-address-text" style="font-size: 16px; color: #333;">Loading location details...</span>\n          </div>\n          <div id="story-map-wrapper" style="width: 100%; height: 400px; box-sizing: border-box; position: relative;">\n            <div id="story-map" style="height: 100%; width: 100%; border-radius: 8px; overflow: hidden; position: relative; background-color: #f5f5f5;"></div>\n          </div>\n        </div>\n      </section>\n    ');case 1:case"end":return t.stop()}}),t)}))),function(){return o.apply(this,arguments)})},{key:"afterRender",value:(r=re(ee().mark((function t(){var e,n,r=this;return ee().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=window.location.hash.slice(1),n=e.split("/")[2],console.log("[DetailStoryPage] Story ID from URL:",n),n){t.next=6;break}return this.renderError("Story ID not found."),t.abrupt("return");case 6:return this.addMapStyles(),this._addDetailPageStyles(),t.prev=8,t.next=11,this.ensureMapLibrary();case 11:console.log("[DetailStoryPage] Leaflet library loaded successfully"),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(8),console.error("[DetailStoryPage] Failed to load Leaflet library:",t.t0);case 17:setTimeout((function(){r._presenter.init(n)}),100);case 18:case"end":return t.stop()}}),t,this,[[8,14]])}))),function(){return r.apply(this,arguments)})},{key:"_addDetailPageStyles",value:function(){var t=document.createElement("style");t.id="detail-story-styles",t.textContent="\n      .page-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 30px;\n        padding-bottom: 20px;\n        border-bottom: 2px solid #f0f0f0;\n      }\n\n      .back-button {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        color: #4A6572;\n        text-decoration: none;\n        font-weight: 500;\n        transition: color 0.3s ease;\n      }\n\n      .back-button:hover {\n        color: #0084ff;\n      }\n\n      .story-actions {\n        display: flex;\n        gap: 10px;\n      }\n\n      .bookmark-btn {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        background: #fff;\n        border: 2px solid #4A6572;\n        color: #4A6572;\n        padding: 10px 16px;\n        border-radius: 8px;\n        cursor: pointer;\n        font-weight: 500;\n        transition: all 0.3s ease;\n      }\n\n      .bookmark-btn:hover {\n        background: #4A6572;\n        color: white;\n      }\n\n      .bookmark-btn.bookmarked {\n        background: #ffc107;\n        border-color: #ffc107;\n        color: #212529;\n      }\n\n      .bookmark-btn:disabled {\n        opacity: 0.6;\n        cursor: not-allowed;\n      }\n\n      .toast {\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        padding: 12px 20px;\n        border-radius: 6px;\n        color: white;\n        z-index: 10000;\n        opacity: 0;\n        transform: translateX(100%);\n        transition: all 0.3s ease;\n      }\n\n      .toast.show {\n        opacity: 1;\n        transform: translateX(0);\n      }\n\n      .toast-success {\n        background: #28a745;\n      }\n\n      .toast-error {\n        background: #dc3545;\n      }\n\n      @media (max-width: 768px) {\n        .page-header {\n          flex-direction: column;\n          align-items: flex-start;\n          gap: 15px;\n        }\n\n        .story-actions {\n          width: 100%;\n          justify-content: flex-end;\n        }\n      }\n    ",document.getElementById("detail-story-styles")||document.head.appendChild(t)}},{key:"addMapStyles",value:function(){var t=document.createElement("style");t.textContent="\n      .map-container {\n        display: block !important;\n        visibility: visible !important;\n        opacity: 1 !important;\n        max-width: 800px !important;\n        margin: 30px auto !important;\n        height: auto !important; \n        min-height: 450px !important;\n        overflow: visible !important;\n      }\n      #story-map {\n        height: 400px !important;\n        width: 100% !important;\n        position: relative !important;\n        z-index: 1 !important;\n        visibility: visible !important;\n        display: block !important;\n        overflow: hidden !important;\n      }\n      #story-map-wrapper {\n        height: 400px !important;\n        width: 100% !important;\n        position: relative !important;\n        overflow: visible !important;\n      }\n      .leaflet-container {\n        height: 100% !important;\n        width: 100% !important;\n        z-index: 1 !important;\n      }\n      .leaflet-pane {\n        z-index: 1 !important;\n      }\n      .leaflet-tile-pane {\n        z-index: 1 !important;\n      }\n      .leaflet-tile {\n        visibility: visible !important;\n      }\n      .leaflet-control-container {\n        z-index: 10 !important;\n      }\n      .container.detail-story-page {\n        overflow: visible !important;\n      }\n      .leaflet-popup-content-wrapper {\n        background: white !important;\n        color: #333 !important;\n        box-shadow: 0 3px 14px rgba(0,0,0,0.4) !important;\n        border-radius: 8px !important;\n        border: none !important;\n      }\n      .leaflet-popup-content {\n        margin: 0 !important;\n        padding: 0 !important;\n      }\n      .leaflet-popup-tip {\n        background: white !important;\n        box-shadow: 0 3px 14px rgba(0,0,0,0.4) !important;\n      }\n      .leaflet-popup {\n        z-index: 1000 !important;\n        position: absolute !important;\n      }\n      .leaflet-pane.leaflet-popup-pane {\n        z-index: 700 !important;\n      }\n      .leaflet-pane.leaflet-marker-pane {\n        z-index: 600 !important;\n      }\n    ",document.head.appendChild(t)}},{key:"renderStoryDetail",value:function(t){document.getElementById("story-container").innerHTML='\n      <article class="story-content" style="max-width: 100%; overflow: hidden;">\n        <h1 style="margin: 20px 0 10px; font-size: 28px; color: #333; line-height: 1.3;">'.concat(t.name,'\'s Story</h1>\n        <p class="story-date" style="margin: 0 0 20px; color: #666; font-size: 16px;">').concat(U(t.createdAt,h.A.DEFAULT_LANGUAGE),'</p>\n        \n        <figure class="story-image-container" style="margin: 0 0 25px; padding: 0; text-align: center;">\n          <div style="width: 100%; max-width: 800px; margin: 0 auto; overflow: hidden; position: relative; border-radius: 10px; background-color: #f5f5f5; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">\n            <img src="').concat(t.photoUrl,'" alt="').concat(t.name,'\'s story photo" class="story-image" style="width: 100%; height: auto; max-height: 600px; object-fit: contain; display: block; margin: 0 auto;">\n          </div>\n          <figcaption style="margin-top: 10px; font-size: 14px; color: #666; text-align: center;">Photo by ').concat(t.name,'</figcaption>\n        </figure>\n        \n        <div class="story-description" style="margin: 0 0 25px; line-height: 1.6; font-size: 16px; color: #333;">\n          <p>').concat(t.description,"</p>\n        </div>\n        \n        ").concat(t.lat&&t.lon?'\n          <div class="story-location-info" style="display: flex; align-items: flex-start; margin-bottom: 20px; padding: 12px 15px; background-color: #f9f9f9; border-radius: 8px; border-left: 4px solid #4CAF50;">\n            <i class="fas fa-map-marker-alt" style="margin-right: 10px; color: #4CAF50; font-size: 18px; margin-top: 2px;"></i> \n            <span style="flex: 1; font-size: 15px;">This story has location information.</span>\n          </div>\n        ':"","\n      </article>\n    ")}},{key:"updateBookmarkButton",value:function(t){var e=document.getElementById("bookmark-btn"),n=e.querySelector(".bookmark-text"),r=e.querySelector("i");t?(e.classList.add("bookmarked"),n.textContent="Bookmarked",r.className="fas fa-bookmark"):(e.classList.remove("bookmarked"),n.textContent="Bookmark",r.className="far fa-bookmark")}},{key:"setBookmarkLoading",value:function(t){var e=document.getElementById("bookmark-btn");e.disabled=t,t&&(e.querySelector(".bookmark-text").textContent="Loading...")}},{key:"showToast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",n=document.createElement("div");n.className="toast toast-".concat(e),n.textContent=t,document.body.appendChild(n),setTimeout((function(){n.classList.add("show")}),100),setTimeout((function(){n.classList.remove("show"),setTimeout((function(){n.remove()}),300)}),3e3)}},{key:"setupBookmarkButton",value:function(t,e){var n=this,r=document.getElementById("bookmark-btn");this.updateBookmarkButton(e),r.addEventListener("click",(function(){n._presenter.toggleBookmark(t)}))}},{key:"showMapContainer",value:function(){var t=document.getElementById("map-container");t&&(t.style.display="block",t.style.visibility="visible",t.style.opacity="1")}},{key:"updateLocationAddressUI",value:function(t){var e=document.getElementById("location-address-text");e&&(e.innerHTML=t&&"Lokasi tidak diketahui"!==t?'\n          <span style="color: #333; font-weight: 500;">'.concat(t,"</span>\n        "):'\n          <span style="color: #777;">Lokasi tidak diketahui</span>\n        ')}},{key:"showLoadingAddress",value:function(){var t=document.getElementById("location-address-text");t&&(t.innerHTML='<span style="display: inline-block; margin-right: 5px;">Sedang mencari lokasi...</span> <div class="spinner" style="display: inline-block; width: 12px; height: 12px; border: 2px solid rgba(0, 0, 0, 0.1); border-top-color: #d9534f; border-radius: 50%; animation: spin 1s linear infinite;"></div>');var e=document.createElement("style");e.textContent="\n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n    ",document.head.appendChild(e)}},{key:"getMapContainer",value:function(){return document.getElementById("story-map")}},{key:"renderError",value:function(t){document.getElementById("story-container").innerHTML='\n      <div class="error-state">\n        <h2>Error</h2>\n        <p>'.concat(t,'</p>\n        <a href="#/" class="btn btn-primary">Back to Home</a>\n      </div>\n    '),document.getElementById("map-container").style.display="none"}},{key:"configureMapContainer",value:function(){var t=this.getMapContainer();if(!t)return console.error("[DetailStoryPage] Map container element not found"),null;t.style.height="400px",t.style.width="100%",t.style.borderRadius="8px",t.style.overflow="hidden",t.style.position="relative",t.style.backgroundColor="#f5f5f5",t.style.boxShadow="0 2px 5px rgba(0,0,0,0.1)",t.style.display="block",t.style.visibility="visible",t.style.zIndex="1";var e="detail-story-map-"+Date.now();t.id=e;var n=document.getElementById("map-container");n&&(n.style.display="block",n.style.visibility="visible",n.style.opacity="1",n.style.height="auto",n.style.overflow="visible"),t.innerHTML="";var r=document.createElement("style");return r.textContent="\n      #".concat(e," {\n        z-index: 1;\n        position: relative !important;\n        display: block !important;\n        visibility: visible !important;\n        height: 400px !important;\n        width: 100% !important;\n      }\n      #").concat(e," .leaflet-tile-pane {\n        z-index: 5 !important;\n      }\n      #").concat(e," .leaflet-tile {\n        visibility: visible !important;\n      }\n      .leaflet-container {\n        background-color: #f5f5f5 !important;\n        z-index: 1 !important;\n        height: 100% !important;\n        width: 100% !important;\n      }\n      .leaflet-popup-content-wrapper, \n      .leaflet-popup-tip {\n        background: white !important;\n        box-shadow: 0 3px 14px rgba(0,0,0,0.4) !important;\n      }\n      .leaflet-popup {\n        z-index: 1000 !important;\n      }\n      .leaflet-popup-content {\n        margin: 0 !important;\n        width: auto !important;\n      }\n      .leaflet-control-container {\n        z-index: 10 !important;\n      }\n      #map-container {\n        overflow: visible !important;\n        height: auto !important;\n        min-height: 450px !important;\n      }\n      #story-map-wrapper {\n        position: relative !important;\n        overflow: visible !important;\n        z-index: 1;\n      }\n      .leaflet-pane.leaflet-popup-pane {\n        z-index: 700 !important;\n      }\n    "),document.head.appendChild(r),console.log("[DetailStoryPage] Map container configured with ID:",e),e}},{key:"prepareMapContainer",value:function(){var t=this.configureMapContainer(),e=document.getElementById(t);return e?(e.style.height="400px",e.style.width="100%",e.style.display="block",e.style.visibility="visible",e.style.position="relative",e.style.zIndex="1",e.innerHTML="",e):null}},{key:"createTemporaryMapContainer",value:function(){return document.createElement("div")}},{key:"createTimeoutPromise",value:function(t,e){return new Promise((function(n,r){return setTimeout((function(){return r(new Error(e))}),t)}))}},{key:"initMapWithDelay",value:function(t,e){var n=this;setTimeout(re(ee().mark((function r(){return ee().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n._initMap(t,e);case 2:case"end":return r.stop()}}),r)}))),800)}},{key:"_initMap",value:(n=re(ee().mark((function t(e,n){var r,o,i,a,s,c,u,l;return ee().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("[DetailStoryPage] Starting map initialization"),t.prev=1,t.next=4,this.ensureMapLibrary();case 4:if(r=this.prepareMapContainer()){t.next=9;break}return console.error("[DetailStoryPage] Map container not found after configuration"),this.showMapError(),t.abrupt("return",!1);case 9:return console.log("[DetailStoryPage] Map container found:",r),t.next=12,new Promise((function(t){return setTimeout(t,100)}));case 12:if(window.L){t.next=16;break}return console.error("[DetailStoryPage] Leaflet library not available"),this.showMapError(),t.abrupt("return",!1);case 16:return t.prev=16,console.log("[DetailStoryPage] Creating map with Leaflet"),console.log("[DetailStoryPage] Coordinates:",e,n),o={center:[e,n],zoom:15,zoomControl:!0},i={attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19},a={maxWidth:280,minWidth:250,className:"custom-map-popup",offset:[0,-5],autoPan:!0,autoPanPadding:[50,50]},s=this._presenter.getStoryData(),c=this._presenter.getLocationAddress()||"Mencari lokasi...",u={name:s.name,photoUrl:s.photoUrl,locationAddress:c},l=this.createMap(r,o,i,[e,n],u,a),this._presenter.setMap(l.map),console.log("[DetailStoryPage] Map initialized successfully"),t.abrupt("return",!0);case 31:return t.prev=31,t.t0=t.catch(16),console.error("[DetailStoryPage] Error creating Leaflet map:",t.t0),this.showMapError(),t.abrupt("return",!1);case 36:t.next=43;break;case 38:return t.prev=38,t.t1=t.catch(1),console.error("[DetailStoryPage] Error initializing map:",t.t1),this.showMapError(),t.abrupt("return",!1);case 43:case"end":return t.stop()}}),t,this,[[1,38],[16,31]])}))),function(t,e){return n.apply(this,arguments)})},{key:"createMap",value:function(t,e,n,r,o,i){console.log("[DetailStoryPage] Creating map with Leaflet");var a=L.map(t,e);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",n).addTo(a),this.addMapPopupStyles();var s=L.marker(r).addTo(a),c=this.createPopupContent(o);return s.bindPopup(c,i).openPopup(),this.refreshMapWithTimeout(a,r,s),{map:{_map:a,_markers:[s],_mapInitialized:!0,destroy:function(){a&&a.remove()}}}}},{key:"refreshMapWithTimeout",value:function(t,e,n){setTimeout((function(){t.invalidateSize(!0),t.setView(e,15),n.openPopup()}),300),[500,1e3,1500].forEach((function(e){setTimeout((function(){t&&(t.invalidateSize(!0),n.isPopupOpen()||n.openPopup())}),e)}))}},{key:"updateMapPopup",value:function(t,e){var n=this.createPopupContent(e);t.getPopup().setContent(n)}},{key:"openMarkerPopupAndAdjustView",value:function(t){var e=this;t.isPopupOpen()||(t.openPopup(),setTimeout((function(){e._presenter._map&&e._presenter._map._map&&e._presenter._map._map.panBy([0,-50],{duration:.1})}),100))}},{key:"createPopupContent",value:function(t){return'\n      <div class="map-popup">\n        <h3 style="margin: 0 0 8px; font-size: 16px; font-weight: 600; color: #333; line-height: 1.3;">'.concat(t.name,'</h3>\n        <img src="').concat(t.photoUrl,'" alt="').concat(t.name,'" style="width: 100%; max-height: 130px; object-fit: cover; margin: 8px 0; border-radius: 6px;">\n        <p style="margin: 8px 0 0; font-size: 14px; color: #333; display: flex; align-items: flex-start;">\n          <i class="fas fa-map-marker-alt" style="margin-right: 6px; color: #d9534f; font-size: 14px; margin-top: 2px;"></i>\n          <span style="flex: 1;">').concat(t.locationAddress,"</span>\n        </p>\n      </div>\n    ")}},{key:"addMapPopupStyles",value:function(){if(!document.getElementById("custom-leaflet-popup-styles")){var t=document.createElement("style");t.id="custom-leaflet-popup-styles",t.textContent="\n        .leaflet-popup {\n          z-index: 1000 !important;\n        }\n        .leaflet-popup-content-wrapper {\n          background: white;\n          box-shadow: 0 3px 14px rgba(0,0,0,0.4);\n          border-radius: 8px;\n          padding: 0;\n          overflow: hidden;\n        }\n        .leaflet-popup-content {\n          margin: 0;\n          padding: 0;\n          width: 100% !important;\n        }\n        .leaflet-popup-tip {\n          background: white;\n          box-shadow: 0 3px 14px rgba(0,0,0,0.4);\n        }\n        .map-popup {\n          padding: 12px;\n        }\n        .map-popup img {\n          display: block;\n          width: 100%;\n          max-height: 120px;\n          object-fit: cover;\n          margin: 8px 0;\n          border-radius: 4px;\n        }\n      ",document.head.appendChild(t)}}},{key:"showMapError",value:function(){var t=this.getMapContainer();t&&(t.innerHTML='<div style="padding: 20px; text-align: center; height: 100%; display: flex; align-items: center; justify-content: center; background-color: #f8f8f8;"><p style="color: #d9534f; font-size: 16px;"><i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>Failed to load the map. Please try again later.</p></div>')}},{key:"destroy",value:function(){var t=document.getElementById("detail-story-styles");t&&t.remove()}}],e&&oe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o}();const se=ae;function ce(t){return ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ce(t)}function ue(){ue=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(j([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==ce(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(ce(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function le(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function pe(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){le(i,r,o,a,s,"next",t)}function s(t){le(i,r,o,a,s,"throw",t)}a(void 0)}))}}function fe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,he(r.key),r)}}function he(t){var e=function(t){if("object"!=ce(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ce(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ce(e)?e:e+""}const de=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._view=e,this._bookmarks=[]},e=[{key:"init",value:(o=pe(ue().mark((function t(){return ue().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._loadBookmarks();case 2:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"_loadBookmarks",value:(r=pe(ue().mark((function t(){return ue().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this._view.showLoading(),t.next=4,Wt.A.getAllBookmarks();case 4:this._bookmarks=t.sent,this._view.renderBookmarks(this._bookmarks),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("Failed to load bookmarks:",t.t0),this._view.renderError();case 12:case"end":return t.stop()}}),t,this,[[0,8]])}))),function(){return r.apply(this,arguments)})},{key:"removeBookmark",value:(n=pe(ue().mark((function t(e){return ue().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Wt.A.removeBookmark(e);case 3:this._bookmarks=this._bookmarks.filter((function(t){return t.id!==e})),this._view.renderBookmarks(this._bookmarks),this._view.showToast("Bookmark removed successfully","success"),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("Failed to remove bookmark:",t.t0),this._view.showToast("Failed to remove bookmark","error");case 12:case"end":return t.stop()}}),t,this,[[0,8]])}))),function(t){return n.apply(this,arguments)})},{key:"getBookmarks",value:function(){return this._bookmarks}},{key:"destroy",value:function(){this._bookmarks=[]}}],e&&fe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r,o}();function me(t){return me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},me(t)}function ye(){ye=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(j([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==me(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(me(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function ve(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function ge(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){ve(i,r,o,a,s,"next",t)}function s(t){ve(i,r,o,a,s,"throw",t)}a(void 0)}))}}function be(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,we(r.key),r)}}function we(t){var e=function(t){if("object"!=me(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=me(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==me(e)?e:e+""}const xe=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._presenter=new de(this)},e=[{key:"render",value:(r=ge(ye().mark((function t(){return ye().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <section class="container bookmarks-page">\n        <div class="page-header">\n          <a href="#/home" class="back-button" aria-label="Back to home page">\n            <i class="fas fa-arrow-left"></i> Back\n          </a>\n          <h1><i class="fas fa-bookmark"></i> Bookmarked Stories</h1>\n        </div>\n        \n        <div id="bookmarks-container" class="bookmarks-container">\n          <div class="loading-indicator">Loading bookmarks...</div>\n        </div>\n      </section>\n    ');case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=ge(ye().mark((function t(){return ye().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._addStyles(),t.next=3,this._presenter.init();case 3:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"showLoading",value:function(){document.getElementById("bookmarks-container").innerHTML='\n      <div class="loading-indicator">Loading bookmarks...</div>\n    '}},{key:"renderBookmarks",value:function(t){var e=this,n=document.getElementById("bookmarks-container");if(0!==t.length){var r=t.sort((function(t,e){return new Date(e.bookmarkedAt)-new Date(t.bookmarkedAt)})).map((function(t){return e._createBookmarkHTML(t)})).join("");n.innerHTML='\n      <div class="bookmarks-grid">\n        '.concat(r,"\n      </div>\n    "),this._attachBookmarkEvents()}else this._renderEmptyState(n)}},{key:"renderError",value:function(){document.getElementById("bookmarks-container").innerHTML='\n      <div class="empty-bookmarks">\n        <i class="fas fa-exclamation-triangle"></i>\n        <h2>Error Loading Bookmarks</h2>\n        <p>Failed to load your bookmarks. Please try again.</p>\n        <button onclick="window.location.reload()" class="browse-stories-btn">\n          Retry\n        </button>\n      </div>\n    '}},{key:"_renderEmptyState",value:function(t){t.innerHTML='\n      <div class="empty-bookmarks">\n        <i class="fas fa-bookmark"></i>\n        <h2>No Bookmarks Yet</h2>\n        <p>Start exploring stories and bookmark the ones you love!</p>\n        <a href="#/home" class="browse-stories-btn">Browse Stories</a>\n      </div>\n    '}},{key:"_createBookmarkHTML",value:function(t){var e=t.lat&&t.lon;return'\n      <div class="bookmark-card" data-id="'.concat(t.id,'">\n        <div class="bookmark-image">\n          <img src="').concat(t.photoUrl,'" alt="').concat(t.name,'\'s story" \n               onerror="this.src=\'/favicon.png\'">\n        </div>\n        <div class="bookmark-content">\n          <h3 class="bookmark-title">').concat(t.name,'\'s Story</h3>\n          <p class="bookmark-date">\n            Bookmarked: ').concat(U(t.bookmarkedAt,h.A.DEFAULT_LANGUAGE),'\n          </p>\n          <p class="bookmark-description">\n            ').concat(t.description.length>150?t.description.substring(0,150)+"...":t.description,'\n          </p>\n          <div class="bookmark-meta">\n            ').concat(e?'<div class="bookmark-location">\n                   <i class="fas fa-map-marker-alt"></i>\n                   <span>Location available</span>\n                 </div>':"<div></div>",'\n            <button class="remove-bookmark-btn" data-id="').concat(t.id,'">\n              <i class="fas fa-trash"></i> Remove\n            </button>\n          </div>\n        </div>\n      </div>\n    ')}},{key:"_attachBookmarkEvents",value:function(){var t=this,e=document.querySelectorAll(".bookmark-card"),n=document.querySelectorAll(".remove-bookmark-btn");e.forEach((function(t){t.addEventListener("click",(function(e){if(!e.target.closest(".remove-bookmark-btn")){var n=t.dataset.id;window.location.hash="#/story/".concat(n)}}))})),n.forEach((function(e){e.addEventListener("click",function(){var n=ge(ye().mark((function n(r){var o;return ye().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.stopPropagation(),o=e.dataset.id,!confirm("Are you sure you want to remove this bookmark?")){n.next=5;break}return n.next=5,t._presenter.removeBookmark(o);case 5:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}())}))}},{key:"showToast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=document.createElement("div");n.className="toast toast-".concat(e),n.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: ".concat("success"===e?"#28a745":"#dc3545",";\n      color: white;\n      padding: 12px 20px;\n      border-radius: 6px;\n      z-index: 10000;\n      opacity: 0;\n      transform: translateX(100%);\n      transition: all 0.3s ease;\n    "),n.textContent=t,document.body.appendChild(n),setTimeout((function(){n.style.opacity="1",n.style.transform="translateX(0)"}),100),setTimeout((function(){n.style.opacity="0",n.style.transform="translateX(100%)",setTimeout((function(){return n.remove()}),300)}),3e3)}},{key:"_addStyles",value:function(){var t=document.createElement("style");t.id="bookmarks-page-styles",t.textContent="\n      .bookmarks-page {\n        padding: 20px;\n        max-width: 1200px;\n        margin: 0 auto;\n      }\n\n      .page-header {\n        display: flex;\n        align-items: center;\n        gap: 20px;\n        margin-bottom: 30px;\n        padding-bottom: 20px;\n        border-bottom: 2px solid #f0f0f0;\n      }\n\n      .page-header h1 {\n        margin: 0;\n        color: #333;\n        font-size: 2rem;\n      }\n\n      .back-button {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        color: #4A6572;\n        text-decoration: none;\n        font-weight: 500;\n        transition: color 0.3s ease;\n      }\n\n      .back-button:hover {\n        color: #0084ff;\n      }\n\n      .bookmarks-container {\n        min-height: 300px;\n      }\n\n      .bookmarks-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n        gap: 20px;\n        margin-top: 20px;\n      }\n\n      .bookmark-card {\n        background: white;\n        border-radius: 12px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.1);\n        overflow: hidden;\n        transition: transform 0.3s ease, box-shadow 0.3s ease;\n        cursor: pointer;\n      }\n\n      .bookmark-card:hover {\n        transform: translateY(-5px);\n        box-shadow: 0 8px 20px rgba(0,0,0,0.15);\n      }\n\n      .bookmark-image {\n        width: 100%;\n        height: 200px;\n        overflow: hidden;\n        position: relative;\n      }\n\n      .bookmark-image img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n        transition: transform 0.3s ease;\n      }\n\n      .bookmark-card:hover .bookmark-image img {\n        transform: scale(1.05);\n      }\n\n      .bookmark-content {\n        padding: 20px;\n      }\n\n      .bookmark-title {\n        margin: 0 0 10px;\n        font-size: 1.3rem;\n        font-weight: 600;\n        color: #333;\n      }\n\n      .bookmark-date {\n        font-size: 0.9rem;\n        color: #666;\n        margin-bottom: 10px;\n      }\n\n      .bookmark-description {\n        color: #555;\n        line-height: 1.5;\n        margin-bottom: 15px;\n      }\n\n      .bookmark-meta {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-top: 15px;\n        padding-top: 15px;\n        border-top: 1px solid #eee;\n      }\n\n      .bookmark-location {\n        display: flex;\n        align-items: center;\n        gap: 5px;\n        color: #666;\n        font-size: 0.9rem;\n      }\n\n      .remove-bookmark-btn {\n        background: #dc3545;\n        color: white;\n        border: none;\n        padding: 8px 12px;\n        border-radius: 6px;\n        cursor: pointer;\n        font-size: 0.9rem;\n        transition: background-color 0.3s ease;\n      }\n\n      .remove-bookmark-btn:hover {\n        background: #c82333;\n      }\n\n      .empty-bookmarks {\n        text-align: center;\n        padding: 60px 20px;\n        background: #f9f9f9;\n        border-radius: 12px;\n        margin-top: 20px;\n      }\n\n      .empty-bookmarks i {\n        font-size: 4rem;\n        color: #ccc;\n        margin-bottom: 20px;\n      }\n\n      .empty-bookmarks h2 {\n        color: #666;\n        margin-bottom: 10px;\n      }\n\n      .empty-bookmarks p {\n        color: #888;\n        margin-bottom: 20px;\n      }\n\n      .browse-stories-btn {\n        background: #4A6572;\n        color: white;\n        text-decoration: none;\n        padding: 12px 24px;\n        border-radius: 8px;\n        display: inline-block;\n        transition: background-color 0.3s ease;\n        border: none;\n        cursor: pointer;\n        font-size: 1rem;\n      }\n\n      .browse-stories-btn:hover {\n        background: #3a5260;\n        color: white;\n      }\n\n      .loading-indicator {\n        text-align: center;\n        padding: 40px;\n        color: #666;\n      }\n\n      @media (max-width: 768px) {\n        .bookmarks-grid {\n          grid-template-columns: 1fr;\n        }\n        \n        .page-header {\n          flex-direction: column;\n          align-items: flex-start;\n          gap: 10px;\n        }\n      }\n    ",document.getElementById("bookmarks-page-styles")||document.head.appendChild(t)}},{key:"destroy",value:function(){var t=document.getElementById("bookmarks-page-styles");t&&t.remove(),this._presenter&&this._presenter.destroy()}}],e&&be(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}();function ke(t){return ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ke(t)}function _e(){_e=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(j([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==ke(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(ke(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function Le(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function Ee(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Le(i,r,o,a,s,"next",t)}function s(t){Le(i,r,o,a,s,"throw",t)}a(void 0)}))}}function Se(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Pe(r.key),r)}}function Pe(t){var e=function(t){if("object"!=ke(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ke(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ke(e)?e:e+""}const Oe=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"render",value:(r=Ee(_e().mark((function t(){return _e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",'\n      <div class="not-found-container">\n        <div class="not-found-content">\n          <div class="not-found-icon">\n            <svg width="120" height="120" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="#6B7280"/>\n            </svg>\n          </div>\n          \n          <h1 class="not-found-title">404</h1>\n          <h2 class="not-found-subtitle">Halaman Tidak Ditemukan</h2>\n          \n          <p class="not-found-description">\n            Maaf, halaman yang Anda cari tidak dapat ditemukan. \n            Mungkin halaman telah dipindahkan atau tidak lagi tersedia.\n          </p>\n          \n          <div class="not-found-actions">\n            <a href="#/home" class="btn btn-primary not-found-btn">\n              <span class="btn-icon"></span>\n              Kembali ke Beranda\n            </a>\n            \n            <button id="go-back-btn" class="btn btn-secondary not-found-btn">\n              <span class="btn-icon"></span>\n              Kembali\n            </button>\n          </div>\n          \n          <div class="not-found-suggestions">\n            <h3>Mungkin Anda mencari:</h3>\n            <ul class="suggestions-list">\n              <li><a href="#/home"> Lihat Semua Stories</a></li>\n              <li><a href="#/add"> Tambah Story Baru</a></li>\n              <li><a href="#/bookmarks"> Bookmarks Saya</a></li>\n              <li><a href="#/about"> Tentang Story App</a></li>\n            </ul>\n          </div>\n        </div>\n      </div>\n      \n      <style>\n        .not-found-container {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          min-height: 70vh;\n          padding: 2rem;\n          text-align: center;\n        }\n        \n        .not-found-content {\n          max-width: 600px;\n          width: 100%;\n        }\n        \n        .not-found-icon {\n          margin-bottom: 2rem;\n          opacity: 0.7;\n        }\n        \n        .not-found-title {\n          font-size: 6rem;\n          font-weight: 800;\n          color: #4A6572;\n          margin: 0;\n          line-height: 1;\n        }\n        \n        .not-found-subtitle {\n          font-size: 1.5rem;\n          color: #374151;\n          margin: 1rem 0;\n          font-weight: 600;\n        }\n        \n        .not-found-description {\n          font-size: 1rem;\n          color: #6B7280;\n          margin: 1.5rem 0 2.5rem 0;\n          line-height: 1.6;\n        }\n        \n        .not-found-actions {\n          display: flex;\n          gap: 1rem;\n          justify-content: center;\n          margin-bottom: 3rem;\n          flex-wrap: wrap;\n        }\n        \n        .not-found-btn {\n          display: inline-flex;\n          align-items: center;\n          gap: 0.5rem;\n          padding: 0.75rem 1.5rem;\n          border-radius: 8px;\n          text-decoration: none;\n          font-weight: 500;\n          transition: all 0.2s ease;\n          border: none;\n          cursor: pointer;\n          font-size: 1rem;\n        }\n        \n        .btn-primary {\n          background: #4A6572;\n          color: white;\n        }\n        \n        .btn-primary:hover {\n          background: #3a525d;\n          transform: translateY(-1px);\n        }\n        \n        .btn-secondary {\n          background: #F3F4F6;\n          color: #374151;\n          border: 1px solid #D1D5DB;\n        }\n        \n        .btn-secondary:hover {\n          background: #E5E7EB;\n          transform: translateY(-1px);\n        }\n        \n        .not-found-suggestions {\n          background: #F9FAFB;\n          border-radius: 12px;\n          padding: 1.5rem;\n          border: 1px solid #E5E7EB;\n        }\n        \n        .not-found-suggestions h3 {\n          margin: 0 0 1rem 0;\n          color: #374151;\n          font-size: 1.1rem;\n        }\n        \n        .suggestions-list {\n          list-style: none;\n          padding: 0;\n          margin: 0;\n          display: grid;\n          gap: 0.75rem;\n        }\n        \n        .suggestions-list li {\n          text-align: left;\n        }\n        \n        .suggestions-list a {\n          display: flex;\n          align-items: center;\n          gap: 0.75rem;\n          padding: 0.75rem;\n          color: #4A6572;\n          text-decoration: none;\n          border-radius: 8px;\n          transition: background-color 0.2s ease;\n        }\n        \n        .suggestions-list a:hover {\n          background: white;\n          color: #374151;\n        }\n        \n        @media (max-width: 768px) {\n          .not-found-container {\n            padding: 1rem;\n            min-height: 60vh;\n          }\n          \n          .not-found-title {\n            font-size: 4rem;\n          }\n          \n          .not-found-subtitle {\n            font-size: 1.25rem;\n          }\n          \n          .not-found-actions {\n            flex-direction: column;\n            align-items: center;\n          }\n          \n          .not-found-btn {\n            width: 100%;\n            max-width: 280px;\n            justify-content: center;\n          }\n        }\n      </style>\n    ');case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})},{key:"afterRender",value:(n=Ee(_e().mark((function t(){return _e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this._setupEventListeners();case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"_setupEventListeners",value:function(){var t=document.getElementById("go-back-btn");t&&t.addEventListener("click",(function(){window.history.length>1?window.history.back():window.location.hash="#/home"}))}},{key:"destroy",value:function(){}}],e&&Se(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,r}(),Te={"/":{render:function(){return(new I).render()},afterRender:function(){return(new I).afterRender()},destroy:function(){}},"/home":{_presenter:null,_view:null,render:function(){return this._presenter=new Lt,this._view=this._presenter.init(),this._view.render()},afterRender:function(){return this._view.afterRender()},destroy:function(){this._view&&"function"==typeof this._view.destroy&&this._view.destroy(),this._presenter&&"function"==typeof this._presenter.destroy&&this._presenter.destroy(),this._view=null,this._presenter=null}},"/about":{render:function(){return(new p).render()},afterRender:function(){return(new p).afterRender()},destroy:function(){}},"/bookmarks":{_page:null,render:function(){return this._page=new xe,this._page.render()},afterRender:function(){return this._page.afterRender()},destroy:function(){this._page&&"function"==typeof this._page.destroy&&this._page.destroy(),this._page=null}},"/story/:id":{_page:null,render:function(){return this._page=new se,this._page.render()},afterRender:function(){return this._page.afterRender()},destroy:function(){this._page&&"function"==typeof this._page.destroy&&this._page.destroy(),this._page=null}},"/add":{_page:null,render:function(){return this._page=new Vt,this._page.render()},afterRender:function(){return this._page.afterRender()},destroy:function(){this._page&&"function"==typeof this._page.destroy&&this._page.destroy(),this._page=null}},"/login":{render:function(){return(new I).render()},afterRender:function(){return(new I).afterRender()},destroy:function(){}},"/register":{render:function(){return(new D).render()},afterRender:function(){return(new D).afterRender()},destroy:function(){}},"/logout":{render:function(){return m.logout(),'<div class="loading-indicator">Logging out...</div>'},afterRender:function(){},destroy:function(){}},"/404":{_page:null,render:function(){return this._page=new Oe,this._page.render()},afterRender:function(){return this._page.afterRender()},destroy:function(){this._page&&"function"==typeof this._page.destroy&&this._page.destroy(),this._page=null}}};function Ae(t){return Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ae(t)}function je(){je=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(j([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Ae(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(Ae(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function Ie(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function Be(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Ie(i,r,o,a,s,"next",t)}function s(t){Ie(i,r,o,a,s,"throw",t)}a(void 0)}))}}function Ne(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Ce(r.key),r)}}function Ce(t){var e=function(t){if("object"!=Ae(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ae(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ae(e)?e:e+""}const Fe=function(){return t=function t(e){var n=e.content,r=e.drawerButton,o=e.navigationDrawer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._content=n,this._drawerButton=r,this._navigationDrawer=o,this._currentPage=null,this._lastActiveRoute=null,this._initialAppShell(),window.appInstance=this},e=[{key:"_initialAppShell",value:function(){var t=this,e=!1;this._drawerButton.addEventListener("click",(function(n){n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),console.log("[App] Hamburger button clicked"),t._navigationDrawer.classList.toggle("open");var r=t._navigationDrawer.classList.contains("open");console.log("[App] Drawer is now:",r?"open":"closed"),r&&(e=!0,setTimeout((function(){e=!1}),100))})),this._setupSkipToContent(),document.addEventListener("click",(function(n){e?console.log("[App] Skipping close - drawer just opened"):!t._navigationDrawer.classList.contains("open")||t._navigationDrawer.contains(n.target)||t._drawerButton.contains(n.target)||(t._navigationDrawer.classList.remove("open"),console.log("[App] Drawer closed by outside click"))})),this._hideRedundantAddStoryButton(),this._initRouter(),m.updateAuthButton(),this._initServiceWorker(),this._addOfflineIndicator(),window.addEventListener("online",(function(){t._updateOfflineStatus(!1),t._syncPendingData()})),window.addEventListener("offline",(function(){t._updateOfflineStatus(!0)})),this._updateOfflineStatus(!navigator.onLine)}},{key:"_initServiceWorker",value:(a=Be(je().mark((function t(){var e=this;return je().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("serviceWorker"in navigator)){t.next=17;break}return t.prev=1,t.next=4,navigator.serviceWorker.register("/service-worker.js");case 4:return console.log("[App] Service Worker registered successfully"),navigator.serviceWorker.addEventListener("message",(function(t){if(console.log("[App] Message from service worker:",t.data),t.data&&"NOTIFICATION_CLICK"===t.data.type&&t.data.navigate){var n=t.data.storyId,r=t.data.targetUrl;if(console.log("[App] Handling notification click navigation"),console.log("[App] Story ID:",n),console.log("[App] Target URL:",r),n&&"undefined"!==n&&"null"!==n){var o="#/story/".concat(n);console.log("[App] Navigating to:",o),window.location.hash=o,setTimeout((function(){e.renderPage().catch((function(t){console.error("[App] Navigation failed:",t)}))}),100)}}})),t.next=8,st.init();case 8:return t.next=10,navigator.serviceWorker.ready;case 10:t.sent.update(),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(1),console.error("[App] Service Worker registration failed:",t.t0);case 17:case"end":return t.stop()}}),t,null,[[1,14]])}))),function(){return a.apply(this,arguments)})},{key:"_setupSkipToContent",value:function(){var t=Array.from(document.querySelectorAll(".skip-link"));t.length>1&&t.slice(1).forEach((function(t){return t.remove()}));var e=document.querySelector(".skip-link");if(e){var n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.setAttribute("href","javascript:void(0)"),n.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),n.blur();var e=document.querySelector("#main-content");e&&(e.setAttribute("tabindex","-1"),e.focus(),e.scrollIntoView({behavior:"smooth"}));var o=r();if(o){var i=window.location.pathname+window.location.search+"#"+o;window.location.href!==i&&(window.history.replaceState(null,document.title,i),sessionStorage.setItem("lastActiveRoute",o))}else{var a=window.location.pathname+window.location.search+"#/home";window.history.replaceState(null,document.title,a),sessionStorage.setItem("lastActiveRoute","home")}return!1}),{capture:!0})}}},{key:"_hideRedundantAddStoryButton",value:function(){var t=document.querySelector('a[href="#/add"]');t&&t.closest("nav")&&(t.style.display="none")}},{key:"_initRouter",value:function(){var t=this;window.addEventListener("DOMContentLoaded",(function(){window.location.hash&&"#/"!==window.location.hash&&"#"!==window.location.hash?(t._handleRouteRedirects(),t.renderPage()):window.location.hash="#/login"})),window.addEventListener("hashchange",(function(e){e.oldURL!==e.newURL&&(r()===t._lastActiveRoute&&(t._currentPage=null),t._handleRouteRedirects()||t.renderPage())}))}},{key:"_addOfflineIndicator",value:function(){if(!document.getElementById("offline-indicator")){var t=document.createElement("div");t.id="offline-indicator",t.className="offline-indicator",t.innerHTML="Anda sedang offline. Beberapa fitur mungkin terbatas.",t.style.display="none",document.body.insertBefore(t,document.body.firstChild)}}},{key:"_updateOfflineStatus",value:function(t){var e=document.getElementById("offline-indicator");e&&(e.style.display=t?"block":"none"),t?document.body.classList.add("offline-mode"):document.body.classList.remove("offline-mode")}},{key:"_syncPendingData",value:(i=Be(je().mark((function t(){var e,r,o,i;return je().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(navigator.onLine){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,Promise.resolve().then(n.bind(n,778));case 5:if(r=t.sent,o=r.syncPendingStories,!(i=(null===(e=m.getAuth())||void 0===e?void 0:e.token)||"")){t.next=11;break}return t.next=11,o(i);case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(2),console.error("Error syncing pending data:",t.t0);case 16:case"end":return t.stop()}}),t,null,[[2,13]])}))),function(){return i.apply(this,arguments)})},{key:"_handleRouteRedirects",value:function(){var t=window.location.hash;return"#/"===t||"#"===t?(window.location.hash="#/login",!0):"#/logout"===t?(m.clearAuth(),window.location.hash="#/login",!0):("#/home"===t||t.startsWith("#/add")||t.startsWith("#/story/")||t.startsWith("#/bookmarks"))&&!m.isUserSignedIn()?(console.log("[App] Redirect to login - protected route without auth"),window.location.hash="#/login",!0):!("#/login"!==t&&"#/register"!==t||!m.isUserSignedIn()||(window.location.hash="#/home",0))}},{key:"renderPage",value:(o=Be(je().mark((function t(){var e,n,o,i=this;return je().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"/"!==(e=r())&&""!==e){t.next=5;break}return window.location.hash="#/login",t.abrupt("return");case 5:if("/logout"!==e){t.next=9;break}return m.clearAuth(),window.location.hash="#/login",t.abrupt("return");case 9:if("/home"!==e&&"/add"!==e&&"/bookmarks"!==e&&!e.startsWith("/story/")||m.isUserSignedIn()){t.next=12;break}return window.location.hash="#/login",t.abrupt("return");case 12:if("/login"!==e&&"/register"!==e||!m.isUserSignedIn()){t.next=15;break}return window.location.hash="#/home",t.abrupt("return");case 15:if(!(n=Te[e])&&e.startsWith("/story/")&&(n=Te["/story/:id"]),n){t.next=29;break}if("/404"===e){t.next=24;break}return console.log("[App] Unknown route, redirecting to 404:",e),window.location.hash="#/404",t.abrupt("return");case 24:if(n=Te["/404"]){t.next=29;break}return console.error("[App] 404 route not found in routes config"),this._content.innerHTML='\n              <div style="text-align: center; padding: 4rem; max-width: 600px; margin: 0 auto;">\n                <h1 style="font-size: 3rem; color: #4A6572; margin-bottom: 1rem;">404</h1>\n                <h2 style="color: #374151; margin-bottom: 1rem;">Page Not Found</h2>\n                <p style="color: #6B7280; margin-bottom: 2rem;">The page you\'re looking for doesn\'t exist.</p>\n                <a href="#/home" style="display: inline-block; background: #4A6572; color: white; padding: 0.75rem 1.5rem; text-decoration: none; border-radius: 8px;">Go Home</a>\n              </div>\n            ',t.abrupt("return");case 29:return this._currentPage&&"function"==typeof this._currentPage.destroy&&this._currentPage.destroy(),this._currentPage=n,this._lastActiveRoute=e,this._content.classList.add("fade-out"),t.next=35,this._waitForTransition(100);case 35:if(!document.startViewTransition){t.next=39;break}document.startViewTransition(Be(je().mark((function t(){return je().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.render();case 2:return i._content.innerHTML=t.sent,i._content.classList.remove("fade-out"),t.next=6,n.afterRender();case 6:case"end":return t.stop()}}),t)})))),t.next=45;break;case 39:return t.next=41,n.render();case 41:return this._content.innerHTML=t.sent,this._content.classList.remove("fade-out"),t.next=45,n.afterRender();case 45:this._navigationDrawer.classList.remove("open"),window.scrollTo(0,0),this._setupSkipToContent(),m.updateAuthButton(),o=m.isUserSignedIn(),this._updateAuthElements(o),t.next=57;break;case 53:t.prev=53,t.t0=t.catch(0),console.error("[App] Error rendering page:",t.t0),this._content.innerHTML='\n        <div style="text-align: center; padding: 4rem;">\n          <h2 style="color: #dc2626;">Something went wrong</h2>\n          <p style="margin: 1rem 0;">Please try again later.</p>\n          <button onclick="window.location.reload()" style="background: #4A6572; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; cursor: pointer;">\n            Reload Page\n          </button>\n        </div>\n      ';case 57:case"end":return t.stop()}}),t,this,[[0,53]])}))),function(){return o.apply(this,arguments)})},{key:"_updateAuthElements",value:function(t){var e=this,n=document.getElementById("login-nav-item"),r=document.getElementById("profile-nav-item"),o=document.getElementById("subscribe-nav-item");t?(n&&(n.style.display="none"),r&&(r.style.display="block"),o&&(o.style.display="block"),setTimeout(Be(je().mark((function t(){var n;return je().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,n=0;case 2:if(!(n<10)){t.next=17;break}if(!document.getElementById("subscribe-notification-btn")){t.next=11;break}return console.log("[App] Subscribe button found, initializing..."),t.next=8,st.init();case 8:return st.updateUI(),e._setupNotificationToggle(),t.abrupt("break",17);case 11:return console.log("[App] Subscribe button not found, retry ".concat(n+1,"/10")),t.next=14,new Promise((function(t){return setTimeout(t,200)}));case 14:n++,t.next=2;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(0),console.error("[App] Error initializing notifications:",t.t0);case 22:case"end":return t.stop()}}),t,null,[[0,19]])}))),100)):(n&&(n.style.display="block"),r&&(r.style.display="none"),o&&(o.style.display="none"))}},{key:"_setupNotificationToggle",value:function(){var t=document.getElementById("subscribe-notification-btn");if(t){console.log("[App] Setting up notification toggle for button:",t);var e=t._notificationHandler;e&&(t.removeEventListener("click",e),console.log("[App] Removed existing notification handler"));var n=function(){var e=Be(je().mark((function e(n){var r,o;return je().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),n.stopPropagation(),console.log("[App] Subscribe button clicked - starting process"),r=t.innerHTML,t.innerHTML='<i class="fas fa-spinner fa-spin"></i> Loading...',t.disabled=!0,e.prev=6,"Notification"in window){e.next=9;break}throw new Error("Browser tidak mendukung notifikasi");case 9:if(console.log("[App] Current notification permission:",Notification.permission),"default"!==Notification.permission){e.next=19;break}return console.log("[App] Requesting notification permission..."),e.next=14,Notification.requestPermission();case 14:if(o=e.sent,console.log("[App] Permission result:",o),"granted"===o){e.next=19;break}return alert("Permission notifikasi diperlukan untuk fitur ini"),e.abrupt("return");case 19:if("denied"!==Notification.permission){e.next=22;break}return alert("Permission notifikasi ditolak. Silakan aktifkan di pengaturan browser."),e.abrupt("return");case 22:if(console.log("[App] Permission granted, proceeding with toggle subscription"),st.swRegistration){e.next=30;break}return console.log("[App] Service worker not ready, initializing..."),e.next=27,st.init();case 27:if(e.sent){e.next=30;break}throw new Error("Failed to initialize service worker");case 30:return e.next=32,st.toggleSubscription();case 32:console.log("[App] Toggle subscription completed successfully"),e.next=39;break;case 35:e.prev=35,e.t0=e.catch(6),console.error("[App] Error toggling notification subscription:",e.t0),"NotAllowedError"===e.t0.name?alert("Permission notifikasi ditolak. Silakan aktifkan di pengaturan browser."):"NotSupportedError"===e.t0.name?alert("Browser Anda tidak mendukung push notification."):alert("Terjadi kesalahan: "+e.t0.message);case 39:return e.prev=39,t.disabled=!1,t.innerHTML.includes("Loading")&&(t.innerHTML=r),console.log("[App] Notification toggle process finished"),e.finish(39);case 44:case"end":return e.stop()}}),e,null,[[6,35,39,44]])})));return function(t){return e.apply(this,arguments)}}();t._notificationHandler=n,t.addEventListener("click",n),console.log("[App] Notification toggle event listener attached successfully")}else console.warn("[App] Subscribe button not found in _setupNotificationToggle")}},{key:"_waitForTransition",value:function(t){return new Promise((function(e){return setTimeout(e,t)}))}}],e&&Ne(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,o,i,a}();function Me(t){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Me(t)}function Ge(){Ge=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,a=Object.create(i.prototype),s=new A(r||[]);return o(a,"_invoke",{value:S(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",d="executing",m="completed",y={};function v(){}function g(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(j([])));k&&k!==n&&r.call(k,a)&&(w=k);var _=b.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==Me(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function S(e,n,r){var o=f;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=P(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=d;var u=p(e,n,r);if("normal"===u.type){if(o=r.done?m:h,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var i=p(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function j(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(Me(e)+" is not iterable")}return g.prototype=b,o(_,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(_),t},e.awrap=function(t){return{__await:t}},L(E.prototype),u(E.prototype,s,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(_),u(_,c,"Generator"),u(_,a,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;T(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:j(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}function De(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function ze(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){De(i,r,o,a,s,"next",t)}function s(t){De(i,r,o,a,s,"throw",t)}a(void 0)}))}}document.addEventListener("DOMContentLoaded",ze(Ge().mark((function t(){var e;return Ge().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return m.clearAuthOnStartup(),e=new Fe({content:document.querySelector("#main-content"),drawerButton:document.querySelector("#drawer-button"),navigationDrawer:document.querySelector("#navigation-drawer")}),t.next=4,e.renderPage();case 4:window.addEventListener("hashchange",ze(Ge().mark((function t(){return Ge().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.renderPage();case 2:case"end":return t.stop()}}),t)}))));case 5:case"end":return t.stop()}}),t)}))))})();