/*! For license information please see service-worker.js.LICENSE.txt */
(()=>{function t(){"use strict";t=function(){return o};var e,o={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(t,e,o){t[e]=o.value},c="function"==typeof Symbol?Symbol:{},s=c.iterator||"@@iterator",l=c.asyncIterator||"@@asyncIterator",u=c.toStringTag||"@@toStringTag";function f(t,e,o){return Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(e){f=function(t,e,o){return t[e]=o}}function h(t,e,o,n){var r=e&&e.prototype instanceof w?e:w,i=Object.create(r.prototype),c=new R(n||[]);return a(i,"_invoke",{value:N(t,o,c)}),i}function g(t,e,o){try{return{type:"normal",arg:t.call(e,o)}}catch(t){return{type:"throw",arg:t}}}o.wrap=h;var p="suspendedStart",d="suspendedYield",y="executing",m="completed",v={};function w(){}function b(){}function x(){}var S={};f(S,s,(function(){return this}));var k=Object.getPrototypeOf,E=k&&k(k(O([])));E&&E!==n&&i.call(E,s)&&(S=E);var W=x.prototype=w.prototype=Object.create(S);function L(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function I(t,e){function o(n,a,c,s){var l=g(t[n],t,a);if("throw"!==l.type){var u=l.arg,f=u.value;return f&&"object"==r(f)&&i.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,c,s)}),(function(t){o("throw",t,c,s)})):e.resolve(f).then((function(t){u.value=t,c(u)}),(function(t){return o("throw",t,c,s)}))}s(l.arg)}var n;a(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,n){o(t,r,e,n)}))}return n=n?n.then(i,i):i()}})}function N(t,o,n){var r=p;return function(i,a){if(r===y)throw Error("Generator is already running");if(r===m){if("throw"===i)throw a;return{value:e,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=A(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===p)throw r=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=y;var l=g(t,o,n);if("normal"===l.type){if(r=n.done?m:d,l.arg===v)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=m,n.method="throw",n.arg=l.arg)}}}function A(t,o){var n=o.method,r=t.iterator[n];if(r===e)return o.delegate=null,"throw"===n&&t.iterator.return&&(o.method="return",o.arg=e,A(t,o),"throw"===o.method)||"return"!==n&&(o.method="throw",o.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=g(r,t.iterator,o.arg);if("throw"===i.type)return o.method="throw",o.arg=i.arg,o.delegate=null,v;var a=i.arg;return a?a.done?(o[t.resultName]=a.value,o.next=t.nextLoc,"return"!==o.method&&(o.method="next",o.arg=e),o.delegate=null,v):a:(o.method="throw",o.arg=new TypeError("iterator result is not an object"),o.delegate=null,v)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function O(t){if(t||""===t){var o=t[s];if(o)return o.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function o(){for(;++n<t.length;)if(i.call(t,n))return o.value=t[n],o.done=!1,o;return o.value=e,o.done=!0,o};return a.next=a}}throw new TypeError(r(t)+" is not iterable")}return b.prototype=x,a(W,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:b,configurable:!0}),b.displayName=f(x,u,"GeneratorFunction"),o.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},o.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,u,"GeneratorFunction")),t.prototype=Object.create(W),t},o.awrap=function(t){return{__await:t}},L(I.prototype),f(I.prototype,l,(function(){return this})),o.AsyncIterator=I,o.async=function(t,e,n,r,i){void 0===i&&(i=Promise);var a=new I(h(t,e,n,r),i);return o.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},L(W),f(W,u,"Generator"),f(W,s,(function(){return this})),f(W,"toString",(function(){return"[object Generator]"})),o.keys=function(t){var e=Object(t),o=[];for(var n in e)o.push(n);return o.reverse(),function t(){for(;o.length;){var n=o.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},o.values=O,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var o in this)"t"===o.charAt(0)&&i.call(this,o)&&!isNaN(+o.slice(1))&&(this[o]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var o=this;function n(n,r){return c.type="throw",c.arg=t,o.next=n,r&&(o.method="next",o.arg=e),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(s&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var o=this.tryEntries.length-1;o>=0;--o){var n=this.tryEntries[o];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),P(o),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.tryLoc===t){var n=o.completion;if("throw"===n.type){var r=n.arg;P(o)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,o,n){return this.delegate={iterator:O(t),resultName:o,nextLoc:n},"next"===this.method&&(this.arg=e),v}},o}function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return o(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){s=!0,a=t},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw a}}}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=Array(e);o<e;o++)n[o]=t[o];return n}function n(t,e,o,n,r,i,a){try{var c=t[i](a),s=c.value}catch(t){return void o(t)}c.done?e(s):Promise.resolve(s).then(n,r)}function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}var i="localhost"===location.hostname||"127.0.0.1"===location.hostname;if(!i)try{importScripts("https://storage.googleapis.com/workbox-cdn/releases/6.5.4/workbox-sw.js")}catch(t){console.log("[SW] Failed to load Workbox, using fallback caching")}if(!i&&"undefined"!=typeof workbox&&workbox)console.log("[SW] Workbox loaded successfully"),workbox.setConfig({debug:!1}),workbox.precaching.precacheAndRoute([{'revision':'c2f893d2db53be61e0d03405bcf27cab','url':'app.bundle.js'},{'revision':'21a0a0a9b1fdb78eae4c9d97f7e90078','url':'favicon.png'},{'revision':'ac73f380ba0147f4fa5951dfaba2a665','url':'images/logo.png'},{'revision':'5e8542e00a04c7834db9b452eafa5710','url':'images/screenshot-dekstop.png'},{'revision':'21acee9166b583adff17d2970edafa80','url':'images/screenshot-mobile.png'},{'revision':'ea543ca7709c30ae9a0622f539aa9ef8','url':'index.html'},{'revision':'6c9ca2e89625e178e2d60486d443f9da','url':'styles.css'}]||[]),workbox.precaching.cleanupOutdatedCaches(),workbox.routing.registerNavigationRoute(workbox.precaching.getCacheKeyForURL("/index.html"),{denylist:[/^\/_/,/\/[^/?]+\.[^/]+$/]}),workbox.routing.registerRoute(/^https:\/\/cdnjs\.cloudflare\.com/,new workbox.strategies.CacheFirst({cacheName:"external-libraries",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:50,maxAgeSeconds:31536e3})]})),workbox.routing.registerRoute(/^https:\/\/unpkg\.com/,new workbox.strategies.CacheFirst({cacheName:"unpkg-cache",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:50,maxAgeSeconds:31536e3})]})),workbox.routing.registerRoute(/^https:\/\/fonts\.googleapis\.com/,new workbox.strategies.StaleWhileRevalidate({cacheName:"google-fonts-stylesheets"})),workbox.routing.registerRoute(/^https:\/\/fonts\.gstatic\.com/,new workbox.strategies.CacheFirst({cacheName:"google-fonts-webfonts",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:30,maxAgeSeconds:31536e3})]})),workbox.routing.registerRoute(/^https:\/\/api\.mapbox\.com/,new workbox.strategies.CacheFirst({cacheName:"mapbox-cache",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:50,maxAgeSeconds:31536e3})]})),workbox.routing.registerRoute(/\.(?:png|gif|jpg|jpeg|svg|webp)$/i,new workbox.strategies.CacheFirst({cacheName:"images",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:200,maxAgeSeconds:7776e3}),new workbox.cacheableResponse.CacheableResponsePlugin({statuses:[0,200]})]})),workbox.routing.registerRoute((function(t){return"image"===t.request.destination}),new workbox.strategies.CacheFirst({cacheName:"all-images",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:300,maxAgeSeconds:7776e3}),new workbox.cacheableResponse.CacheableResponsePlugin({statuses:[0,200]})]})),workbox.routing.registerRoute((function(t){var e=t.url;return e.pathname.includes("/photo")||e.pathname.includes("/image")||e.pathname.includes("/avatar")||e.pathname.includes("/story")||e.searchParams.has("photo")||e.searchParams.has("image")}),new workbox.strategies.CacheFirst({cacheName:"api-images",plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:500,maxAgeSeconds:15552e3}),new workbox.cacheableResponse.CacheableResponsePlugin({statuses:[0,200]})]})),workbox.routing.registerRoute(/\/api\//,new workbox.strategies.NetworkFirst({cacheName:"api-cache",networkTimeoutSeconds:10,plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:50,maxAgeSeconds:86400}),new workbox.cacheableResponse.CacheableResponsePlugin({statuses:[0,200]})]})),workbox.routing.registerRoute(/\.css$/,new workbox.strategies.StaleWhileRevalidate({cacheName:"stylesheets"})),console.log("[SW] Workbox caching strategies registered");else{console.log("[SW] Using basic caching (development mode or Workbox unavailable)");var a=i?"story-app-dev-v1":"story-app-fallback-v1",c=["/","/index.html","/app.bundle.js","/styles.css","/favicon.png","/app.webmanifest"];self.addEventListener("install",(function(t){console.log("[SW] Installing service worker"),t.waitUntil(caches.open(a).then((function(t){return console.log("[SW] Opened cache"),t.addAll(c).catch((function(e){return console.log("[SW] Cache addAll failed, trying individual adds"),Promise.all(c.map((function(e){return t.add(e).catch((function(t){console.log("[SW] Failed to cache ".concat(e,":"),t)}))})))}))})).then((function(){return console.log("[SW] Cache populated"),self.skipWaiting()})).catch((function(t){console.error("[SW] Install failed:",t)})))})),self.addEventListener("activate",(function(t){console.log("[SW] Activating service worker"),t.waitUntil(caches.keys().then((function(t){return Promise.all(t.map((function(t){if(t!==a)return console.log("[SW] Deleting old cache:",t),caches.delete(t)})))})).then((function(){return console.log("[SW] Activation complete"),self.clients.claim()})))})),self.addEventListener("fetch",(function(t){t.request.url.startsWith("http")&&t.respondWith(caches.match(t.request).then((function(e){return e?(console.log("[SW] Found in cache:",t.request.url),e):fetch(t.request).then((function(e){if(!e||200!==e.status||"basic"!==e.type)return e;var o=e.clone();return caches.open(a).then((function(e){e.put(t.request,o)})),e})).catch((function(){return"image"===t.request.destination?new Response('<svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">\n                  <defs>\n                    <linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%">\n                      <stop offset="0%" style="stop-color:#f5f5f5"/>\n                      <stop offset="100%" style="stop-color:#e0e0e0"/>\n                    </linearGradient>\n                  </defs>\n                  <rect width="100%" height="100%" fill="url(#bg)"/>\n                  <text x="50%" y="40%" dominant-baseline="middle" text-anchor="middle" fill="#666" font-family="Arial, sans-serif" font-size="32">\n                    📷\n                  </text>\n                  <text x="50%" y="65%" dominant-baseline="middle" text-anchor="middle" fill="#999" font-family="Arial, sans-serif" font-size="14">\n                    Image not available offline\n                  </text>\n                </svg>',{headers:{"Content-Type":"image/svg+xml","Cache-Control":"no-cache"}}):"navigate"===t.request.mode?caches.match("/index.html"):void 0}))})))}))}self.addEventListener("push",(function(t){console.log("[SW] ===== PUSH EVENT RECEIVED ====="),console.log("[SW] Push event:",t),console.log("[SW] Has data:",!!t.data),t.data&&(console.log("[SW] Raw push data:",t.data),console.log("[SW] Push data text:",t.data.text()));var e="Story App",o="Ada story baru yang ditambahkan!",n=null,r=null,i=null,a=null;if(t.data)try{var c,s=t.data.text();console.log("[SW] Push data text:",s);try{c=JSON.parse(s),console.log("[SW] Push data parsed as JSON:",c)}catch(t){console.log("[SW] Push data is not JSON, treating as text"),o=s.length>100?s.substring(0,100)+"...":s}if(c){if(c.notification){var l=c.notification;e=l.title||"Story Baru!",n=l.storyId,i=l.name||l.author,r=l.body||l.description,a=l.photoUrl||l.image}else e=c.title||"Story Baru!",n=c.storyId||c.id,i=c.author||c.name,r=c.description||c.body,a=c.photoUrl||c.image;r&&(o=r.length>100?r.substring(0,100)+"...":r),i&&o!==r&&(o="".concat(i,": ").concat(o)),console.log("[SW] Notification will show with:",{title:e,body:o,storyId:n,author:i})}}catch(t){console.error("[SW] Error processing push data:",t),o="Ada notifikasi baru"}var u={body:o,icon:"/favicon.png",badge:"/favicon.png",image:a||void 0,tag:"story-notification-"+(n||Date.now()),data:{storyId:n,type:"PUSH_NOTIFICATION",timestamp:Date.now()},renotify:!0,requireInteraction:!0,actions:[{action:"view",title:"Lihat Story",icon:"/favicon.png"},{action:"close",title:"Tutup"}],vibrate:[200,100,200]};console.log("[SW] Showing notification with options:",u),t.waitUntil(self.registration.showNotification(e,u).then((function(){return console.log("[SW] Notification shown successfully")})).catch((function(t){return console.error("[SW] Failed to show notification:",t)})))})),self.addEventListener("notificationclick",(function(o){if(console.log("[SW] ===== NOTIFICATION CLICKED ====="),console.log("[SW] event.notification.data:",o.notification.data),console.log("[SW] event.action:",o.action),o.notification.close(),"close"!==o.action){var i=(o.notification.data||{}).storyId;console.log("[SW] StoryId from notification:",i),console.log("[SW] StoryId type:",r(i));var a,c,s=self.location.origin;a=i&&"undefined"!==i&&"null"!==i?"".concat(s,"/#/story/").concat(i):"".concat(s,"/#/home"),console.log("[SW] Target URL:",a),o.waitUntil((c=t().mark((function o(){var n,r,c,l,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,self.clients.matchAll({type:"window",includeUncontrolled:!0});case 3:if(n=t.sent,console.log("[SW] Found clients:",n.length),!(n.length>0)){t.next=38;break}n.sort((function(t,e){var o=t.focused?1:0;return(e.focused?1:0)-o})),r=e(n),t.prev=8,r.s();case 10:if((c=r.n()).done){t.next=30;break}if(l=c.value,u=new URL(l.url),console.log("[SW] Checking client:",l.url,"focused:",l.focused),u.origin!==s){t.next=28;break}return console.log("[SW] Found matching app client"),t.prev=16,t.next=19,l.focus();case 19:return console.log("[SW] Client focused successfully"),l.postMessage({type:"NOTIFICATION_CLICKED",storyId:i,targetUrl:a,navigate:!0}),console.log("[SW] Navigation message sent to client"),t.abrupt("return");case 25:t.prev=25,t.t0=t.catch(16),console.log("[SW] Could not focus client:",t.t0);case 28:t.next=10;break;case 30:t.next=35;break;case 32:t.prev=32,t.t1=t.catch(8),r.e(t.t1);case 35:return t.prev=35,r.f(),t.finish(35);case 38:return console.log("[SW] No suitable client found, trying to open new window"),t.next=41,self.clients.openWindow(a);case 41:console.log("[SW] New window opened successfully"),t.next=47;break;case 44:t.prev=44,t.t2=t.catch(0),console.error("[SW] All navigation attempts failed:",t.t2);case 47:case"end":return t.stop()}}),o,null,[[0,44],[8,32,35,38],[16,25]])})),function(){var t=this,e=arguments;return new Promise((function(o,r){var i=c.apply(t,e);function a(t){n(i,o,r,a,s,"next",t)}function s(t){n(i,o,r,a,s,"throw",t)}a(void 0)}))})())}else console.log("[SW] Close action clicked")})),self.addEventListener("message",(function(t){if(console.log("[SW] ===== MESSAGE RECEIVED ====="),console.log("[SW] event.data:",t.data),t.data&&"SIMULATE_PUSH"===t.data.type){var e=t.data.data||{};console.log("[SW] Simulating push with data:",e);var o=e.title||"Story App",n=e.body||"Ada story baru!",i=e.storyId,a=e.description,c=e.author||e.name,s=e.photoUrl;console.log("[SW] StoryId from simulate message:",i,r(i)),a&&(n=a.length>100?a.substring(0,100)+"...":a),c&&n!==a&&(n="".concat(c,": ").concat(n));var l={body:n,icon:"/favicon.png",badge:"/favicon.png",image:s||void 0,tag:"story-notification-"+(i||Date.now()),data:{storyId:i,timestamp:Date.now()},renotify:!0,requireInteraction:!1,actions:[{action:"view",title:"Lihat Story",icon:"/favicon.png"},{action:"close",title:"Tutup"}],vibrate:[200,100,200]};console.log("[SW] Showing simulated notification with data.storyId:",l.data.storyId),self.registration.showNotification(o,l).then((function(){console.log("[SW] Simulated notification shown successfully")})).catch((function(t){console.error("[SW] Failed to show simulated notification:",t)}))}}))})();